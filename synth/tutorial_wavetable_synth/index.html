<!doctype html>
<html lang="ja" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-synth/tutorial_wavetable_synth" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">ウェーブテーブル・シンセシス | JUCE日本語版チュートリアル</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://m1m0zzz.github.io/juce-tutorial-ja/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://m1m0zzz.github.io/juce-tutorial-ja/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://m1m0zzz.github.io/juce-tutorial-ja/synth/tutorial_wavetable_synth/"><meta data-rh="true" property="og:locale" content="ja"><meta data-rh="true" name="docusaurus_locale" content="ja"><meta data-rh="true" name="docsearch:language" content="ja"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="ウェーブテーブル・シンセシス | JUCE日本語版チュートリアル"><meta data-rh="true" name="description" content="シンセサイザーのオシレーターを最適化するためにウェーブテーブルを組み込みます。ウェーブテーブルを使ってサイン波オシレーターの状態を管理し、オーディオ出力にデータを書き込もう。"><meta data-rh="true" property="og:description" content="シンセサイザーのオシレーターを最適化するためにウェーブテーブルを組み込みます。ウェーブテーブルを使ってサイン波オシレーターの状態を管理し、オーディオ出力にデータを書き込もう。"><link data-rh="true" rel="icon" href="/juce-tutorial-ja/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://m1m0zzz.github.io/juce-tutorial-ja/synth/tutorial_wavetable_synth/"><link data-rh="true" rel="alternate" href="https://m1m0zzz.github.io/juce-tutorial-ja/synth/tutorial_wavetable_synth/" hreflang="ja"><link data-rh="true" rel="alternate" href="https://m1m0zzz.github.io/juce-tutorial-ja/synth/tutorial_wavetable_synth/" hreflang="x-default"><link rel="stylesheet" href="/juce-tutorial-ja/assets/css/styles.ee4ac6b4.css">
<script src="/juce-tutorial-ja/assets/js/runtime~main.5add7671.js" defer="defer"></script>
<script src="/juce-tutorial-ja/assets/js/main.cf826c6e.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="メインコンテンツまでスキップ"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">メインコンテンツまでスキップ</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/juce-tutorial-ja/"><div class="navbar__logo"><img src="/juce-tutorial-ja/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/juce-tutorial-ja/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">JUCE日本語版チュートリアル</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/juce-tutorial-ja/">Tutorial</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/m1m0zzz/juce-tutorial-ja" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="ダークモードを切り替える(現在はライトモード)" aria-label="ダークモードを切り替える(現在はライトモード)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="先頭へ戻る" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/juce-tutorial-ja/">About / このサイトについて</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/juce-tutorial-ja/category/getting-started/">Getting Started</a><button aria-label="Expand sidebar category &#x27;Getting Started&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/juce-tutorial-ja/category/audio/">Audio</a><button aria-label="Expand sidebar category &#x27;Audio&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/juce-tutorial-ja/category/synth/">Synth</a><button aria-label="Collapse sidebar category &#x27;Synth&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/juce-tutorial-ja/synth/tutorial_simple_synth_noise/">ホワイトノイズ発生器を作る</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/juce-tutorial-ja/synth/tutorial_synth_level_control/">オーディオレベルのコントロール</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/juce-tutorial-ja/synth/tutorial_synth_db_level_control/">デシベルでオーディオレベルをコントロール</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/juce-tutorial-ja/synth/tutorial_sine_synth/">サイン波シンセサイザーを作る</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/juce-tutorial-ja/synth/tutorial_synth_using_midi_input/">MIDIシンセサイザーを作る</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/juce-tutorial-ja/synth/tutorial_wavetable_synth/">ウェーブテーブル・シンセシス</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/juce-tutorial-ja/category/midi/">MIDI</a><button aria-label="Expand sidebar category &#x27;MIDI&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/juce-tutorial-ja/category/plugins/">Plugins</a><button aria-label="Expand sidebar category &#x27;Plugins&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/juce-tutorial-ja/category/dsp/">DSP</a><button aria-label="Expand sidebar category &#x27;DSP&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/juce-tutorial-ja/category/graphics/">Graphics</a><button aria-label="Expand sidebar category &#x27;Graphics&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/juce-tutorial-ja/category/interface-design/">Interface Design</a><button aria-label="Expand sidebar category &#x27;Interface Design&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/juce-tutorial-ja/category/mobile/">Mobile</a><button aria-label="Expand sidebar category &#x27;Mobile&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/juce-tutorial-ja/category/utility-classes/">Utility Classes</a><button aria-label="Expand sidebar category &#x27;Utility Classes&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="パンくずリストのナビゲーション"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="ホームページ" class="breadcrumbs__link" href="/juce-tutorial-ja/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/juce-tutorial-ja/category/synth/"><span itemprop="name">Synth</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">ウェーブテーブル・シンセシス</span><meta itemprop="position" content="2"></li></ul></nav><div class="theme-doc-markdown markdown"><h1>チュートリアルウェーブテーブルシンセシス</h1>
<p>シンセサイザーのオシレーターを最適化するためにウェーブテーブルを組み込みます。ウェーブテーブルを使ってサイン波オシレーターの状態を管理し、オーディオ出力にデータを書き込もう。</p>
<p>レベル Intermediate</p>
<p>プラットフォーム Windows, macOS, Linux</p>
<p>クラス： <a href="https://docs.juce.com/master/classAudioBuffer" target="_blank" rel="noopener noreferrer" title="A multi-channel buffer containing floating point audio samples.">オーディオバッファ</a>, <a href="https://docs.juce.com/master/classAudioAppComponent" target="_blank" rel="noopener noreferrer" title="A base class for writing audio apps that stream from the audio i/o devices.">オーディオコンポーネント</a>, <a href="https://docs.juce.com/master/classRandom" target="_blank" rel="noopener noreferrer" title="A random number generator.">ランダム</a>, <a href="https://docs.juce.com/master/structMathConstants" target="_blank" rel="noopener noreferrer" title="Commonly used mathematical constants.">数学定数</a></p>
<h1>Getting started</h1>
<p>Download the demo project for this tutorial here: <a href="/juce-tutorial-ja/tutorials/PIPs/WavetableSynthTutorial.zip/">ピップ</a> | <a href="/juce-tutorial-ja/tutorials/ZIPs/WavetableSynthTutorial.zip/">ジップ</a>. Unzip the project and open the first header file in the Projucer.</p>
<p>If you need help with this step, see <a href="/juce-tutorial-ja/synth/tutorial_new_projucer_project/">チュートリアルProjucerパート1：Projucerを始める</a>.</p>
<h1>The demo project</h1>
<p>このデモ・プロジェクトは、  ランダムなサイン波高調波のスタックを生成し、ステレオ出力で出力するだけです。ユーザー・インターフェースでは、従来のオシレーターの実装とウェーブテーブルを利用した実装を比較することで、CPU使用率をモニターすることができる。</p>
<p>In order to properly evaluate and compare the CPU usage of our different implementations, we are going to run our application in the <strong>リリース</strong> configuration instead of the regular <strong>デバッグ</strong> configuration used during testing and development. By building the project in <strong>リリース</strong> mode the compiler will be able to optimise the code as much as possible by removing assertions and comments from the code and inlining functions for example.</p>
<p>To change the build configuration in Xcode, first click on the deployment targets in the top left corner of the interface and navigate to <strong>編集スキーム...</strong> as shown below:</p>
<figure><img src="https://docs.juce.com/master/tutorial_wavetable_synth_screenshot1.png" alt="Editing the scheme"><figcaption><b>Editing the scheme</b></figcaption></figure>
<p>In the pop-up window, select <strong>リリース</strong> in the <strong>ビルド構成</strong> combo box as shown in the screenshot:</p>
<figure><img src="https://docs.juce.com/master/tutorial_wavetable_synth_screenshot2.png" alt="Changing the build configuration"><figcaption><b>Changing the build configuration</b></figcaption></figure>
<p>あなたのアプリケーションは、コンパイラによる最適化後に実行され、CPU使用率は大幅に減少するはずです。</p>
<h1>Wavetables</h1>
<p>ウェーブテーブル・シンセシスとは、あらかじめ周期波形を埋め込んだルックアップテーブルを使用し、計算されたサンプルごとに同じ波形を生成することなくオシレーターを生成するシンセシス手法です。ウェーブテーブルは任意 の周期波形で初期化され、これらの波形の分解能を指定することができます。出力する正しいサンプル値を取得する際、テーブル内のサンプル数とオーディオ・バッファ・ブロック内のサンプル数、および対応する要求周波数が一致しない場合は、2つのウェーブテーブル・サンプル間を補間して値を見つけます。</p>
<p>例として、ウェーブテーブルからサイン波を検索したいとします。まず、例えば128サンプル・ポイントの分解能で、サイン波の1サイクル分のウェーブテーブルを作成します。バッファ・ブロックの各サンプルについて、サンプル・レート、再生要求周波数、ウェーブテーブルの解像度、波形の現在の位相または角度の組み合わせを使って、正しい補間サンプルを計算することで、正弦波のサンプル値を要求することができます。</p>
<p>ウェーブテーブルに入る前に、簡単なサイン波オシレーターの実装から始めよう。</p>
<h1>Sine Wave Oscillator</h1>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>注記</div><div class="admonitionContent_BuS1"><p>This section is covered in more detail in <a href="/juce-tutorial-ja/synth/tutorial_sine_synth/">チュートリアルサイン波シンセサイザーを作る</a> and if you need help with these steps please refer to that tutorial first.</p></div></div>
<p>In the <code>サインオシレーター</code> class, we keep track of two member variables that store the current angle or phase in the waveform cycle and the angle delta to increment between every cycle depending on the frequency and the sample rate:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">クラス SineOscillator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SineOscillator() {}.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">private：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float currentAngle = 0.0f, angleDelta = 0.0f；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <code>setFrequency()</code> function allows us to calculate the angle delta by first dividing the frequency by the sample rate and multiplying the result by 2pi, the length of a cycle in radians:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    void setFrequency (float frequency, float sampleRate)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auto cyclesPerSample = frequency / sampleRate;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        angleDelta = cyclesPerSample * juce::MathConstants::twoPi；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <code>getNextSample()</code> function gets called by the <code>getNextAudioBlock()</code> function of the <a href="https://docs.juce.com/master/classAudioSource" target="_blank" rel="noopener noreferrer" title="Base class for objects that can produce a continuous stream of audio.">オーディオソース</a> on every sample in the buffer to retrieve the sample value from the oscillator. Here we calculate the sample value using the <code>標準値::sin()</code> function by passing the current angle as an argument and updating the current angle by calling the helper function <code>updateAngle()</code> defined after:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">強制インライン float getNextSample() noexcept</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auto currentSample = std::sin (currentAngle)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        updateAngle()；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        currentSample を返します；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>角度は、周波数を設定する際に以前に計算された角度デルタで現在の角度をインクリメントし、角度が2piを超えたときに値を折り返すことによって更新される：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    forcedinline void updateAngle() noexcept</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        currentAngle += angleDelta;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (currentAngle &gt;= juce::MathConstants::twoPi)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            currentAngle -= juce::MathConstants::twoPi；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now let&#x27;s switch to the implementation of our <code>メインコンテンツコンポーネント</code> class.</p>
<p>ここに示すように、出力全体のレベルとオシレーターの配列をプライベート・メンバー変数として管理している：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class MainContentComponent   : public juce::AudioAppComponent,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                               public juce::Timer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">private:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float level = 0.0f;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    juce::OwnedArrayオシレーター</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the <code>prepareToPlay()</code> function, we have to initialise the oscillators and set their frequencies to play based on the sample rate as follows:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">void prepareToPlay (int, double sampleRate) override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auto numberOfOscillators = 200; // [1].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (auto i = 0; i &lt; numberOfOscillators; ++i)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            auto* oscillator = new SineOscillator(); // [2].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            auto midiNote = juce::Random::getSystemRandom().nextDouble() * 36.0 + 48.0; // [3].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            auto frequency = 440.0 * pow (2.0, (midiNote - 69.0) / 12.0); // [4].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            oscillator-&gt;setFrequency ((float) frequency, (float) sampleRate); // [5].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            oscillators.add (oscillator)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        level = 0.25f / (float) numberOfOscillators; // [6].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>[1]: First we define a large number of oscillators to evaluate the CPU load of such a number.</li>
<li>[2]: For each oscillator, we instantiate a new <code>サインオシレーター</code> object that generates a single sine wave voice.</li>
<li>[3]: We also select a random midi note using the <a href="https://docs.juce.com/master/classRandom" target="_blank" rel="noopener noreferrer" title="A random number generator.">ランダム</a> class by shifting the lowest possible note by 4 octaves and defining a range of 3 octaves starting from that lowest note.</li>
<li>[4]: In order to calculate the frequency of that midi note, we use a simple mathematical formula to retrieve the scalar to multiply the frequency of A440 with. Since we know that the midi note number of A440 is 69, by subtracting the midi note by 69 we get the semitone distance from A440 that we can then plug into the following formula: 440 * 2 ^ (d / 12)</li>
<li>[5]: Then, we set the frequency of the oscillator by passing the frequency and sample rate as arguments to the <code>setFrequency()</code> function. We also add the oscillator to the array of oscillators.</li>
<li>[6]: Finally, we define the output level by dividing a quiet gain level by the number of oscillators to prevent clipping of the signal by summing such a large number of oscillator samples.</li>
</ul>
<p>In the <code>getNextAudioBlock()</code> function we simply sum all the oscillator samples and write the result to the output buffers as shown below:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">void getNextAudioBlock (const juce::AudioSourceChannelInfo&amp; bufferToFill) override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auto* leftBuffer = bufferToFill.buffer-&gt;getWritePointer (0, bufferToFill.startSample); // [7].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auto* rightBuffer = bufferToFill.buffer-&gt;getWritePointer (1, bufferToFill.startSample)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        bufferToFill.clearActiveBufferRegion()；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (auto oscillatorIndex = 0; oscillatorIndex &lt; oscillators.size(); ++oscillatorIndex)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            auto* oscillator = oscillators.getUnchecked (oscillatorIndex); // [8].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            for (auto sample = 0; sample &lt; bufferToFill.numSamples; ++sample)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                auto levelSample = oscillator-&gt;getNextSample() * level; // [9].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                leftBuffer[sample] += levelSample; // [10].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                rightBuffer[sample] += levelSample；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>[7]: First, we retrieve the left and right channel pointers to write to the output buffers.</li>
<li>[8]: For each oscillator in the array we retrieve a pointer to the oscillator instance.</li>
<li>[9]: Then for each sample in the audio sample buffer we get the sine wave sample and trim the gain with the level variable.</li>
<li>[10]: Finally we can add that sample value to the left and right channel samples and sum the signal with the other oscillators.</li>
</ul>
<p>今、アプリケーションを実行すると、正弦波を積み重ねたランダムなノイズが聞こえるはずだ。</p>
<p>ランダムなMIDIノートを生成する代わりに、あるコードのMIDIノートを見つけ、そのコードからランダムなノートを生成する。</p>
<h1>Wavetable Oscillator</h1>
<p>オシレーターの実装をウェーブテーブル・シンセシス方式に変えてみよう。</p>
<p>In the <code>メインコンテンツコンポーネント</code> class, add an AudioSampleBuffer as a member variable that will hold the wavetable values of our single sine wave cycle [1]. We also define the wavetable resolution as a constant of 128 samples using the bit shift operator [2]:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">private:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    juce::Label cpuUsageLabel;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    juce::Label cpuUsageText;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const unsigned int tableSize = 1 &lt;&lt; 7;      // [2]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float level = 0.0f;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    juce::AudioSampleBuffer sineTable;          // [1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    juce::OwnedArray発振器；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    JUCE_DECLARE_NON_COPYABLE_WITH_LEAK_DETECTOR (MainContentComponent)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Define a new function called <code>createWavetable()</code> that will be called in the <code>メインコンテンツコンポーネント</code> constructor before we start the audio processing.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    void createWavetable()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sineTable.setSize (1, (int) tableSize);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auto* samples = sineTable.getWritePointer (0);                                   // [3]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auto angleDelta = juce::MathConstants::twoPi / (double) (tableSize - 1); // [4].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auto currentAngle = 0.0；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (unsigned int i = 0; i &lt; tableSize; ++i)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            auto sample = std::sin (currentAngle); // [5].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            samples[i] = (float) sample；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            currentAngle += angleDelta；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>[3]: In this function, initialise the AudioSampleBuffer by calling the <code>setSize()</code> method by specifying that we only need one channel and the number of samples equal to the table size, in our case a resolution of 128. Then retrieve the write pointer for that single channel buffer.</li>
<li>[4]: Next, calculate the angle delta similarly to the previous section but this time using the table size and thus dividing the full 2pi cycle by 127.</li>
<li>[5]: Now for each point in our wavetable, retrieve the sine wave value using the <code>標準値::sin()</code> function, assign the value to the buffer sample and increment the current angle by the delta value.</li>
</ul>
<p>Add this function call in the <code>メインコンテンツコンポーネント</code> constructor as follows:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">MainContentComponent()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cpuUsageLabel.setText (&quot;CPU Usage&quot;, juce::dontSendNotification)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cpuUsageText.setJustificationType (juce::Justification::right)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        addAndMakeVisible (cpuUsageLabel)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        addAndMakeVisible (cpuUsageText)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        createWavetable()；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        setSize (400, 200)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        setAudioChannels (0, 2); // 入力なし、出力2つ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        startTimer (50)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>これでウェーブテーブルは、正弦波の全サイクルの128サンプルを含むようになります。</p>
<p>In the for() loop of the <code>prepareToPlay()</code> function, change the below line to instantiate a <code>ウェーブテーブルオシレーター</code> object instead of a <code>サインオシレーター</code> object:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">for (auto i = 0; i &lt; 発振器数; ++i)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            auto* oscillator = new WavetableOscillator (sineTable)；</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This constructor takes as an argument the wavetable to use for the sound generation and therefore, create a corresponding new <code>ウェーブテーブルオシレーター</code> class as shown below:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">クラス WavetableOscillator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    WavetableOscillator (const juce::AudioSampleBuffer&amp; wavetableToUse)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        : wavetable (wavetableToUse)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        jassert (wavetable.getNumChannels() == 1)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">private：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const juce::AudioSampleBuffer&amp; wavetable；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float currentIndex = 0.0f, tableDelta = 0.0f；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>現在の角度と波形サイクルの角度デルタを記録する代わりに、現在のウェーブテーブル・インデックスとウェーブテーブルの角度デルタを格納する2つのメンバ変数を定義する。また、AudioSampleBuffer変 数を定義して、使用するウェーブテーブルへの参照を保持する。</p>
<p>The <code>setFrequency()</code> function of the <code>ウェーブテーブルオシレーター</code> class is fairly similar to the one implemented previously except that the angle delta is calculated using the size of the wavetable instead of the full cycle in radians of 2pi as follows:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">void setFrequency (float frequency, float sampleRate)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auto tableSizeOverSampleRate = (float) wavetable.getNumSamples() / sampleRate；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        tableDelta = frequency * tableSizeOverSampleRate；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <code>getNextSample()</code> function is where the interpolation between the wavetable values occur in order to get the correct sample value.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">強制インライン float getNextSample() noexcept</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auto tableSize = (unsigned int) wavetable.getNumSamples()；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auto index0 = (unsigned int) currentIndex; // [6].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auto index1 = index0 == (tableSize - 1) ?(unsigned int) 0 : index0 + 1；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auto frac = currentIndex - (float) index0; // [7].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auto* table = wavetable.getReadPointer (0); // [8].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auto value0 = table[index0]；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auto value1 = table[index1]；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auto currentSample = value0 + frac * (value1 - value0); // [9].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if ((currentIndex += tableDelta) &gt; (float) tableSize)   // [10]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            currentIndex -= (float) tableSize；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        currentSample を返す；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>[6]: First, temporarily store the two indices of the wavetable that surround the sample value that we are trying to retrieve. If the higher index goes beyond the size of the wavetable then we wrap the value to the start of the table.</li>
<li>[7]: Next, calculate the interpolation value as a fraction between the two indices by subtracting the actual current sample by the truncated lower index. This should give us a value between 0 .. 1 that defines the fraction.</li>
<li>[8]: Then get a pointer to the AudioSampleBuffer and read the values at the two indices and store these values temporarily.</li>
<li>[9]: The interpolated sample value can then be retrieved by using the standard interpolation formula and the fraction value calculated previously.</li>
<li>[10]: Finally, increment the angle delta of the table and wrap the value around if the value exceeds the table size.</li>
</ul>
<p>この実装では、アプリケーションの実行時に同じ出力音が得られるはずだ。</p>
<p>発振器の数を変更し、CPU使用率の変化を観察する。</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>注記</div><div class="admonitionContent_BuS1"><p>The source code for this modified version of the code can be found in the <code>WavetableSynthTutorial_02.h</code> file of the demo project.</p></div></div>
<h1>Wrapping the Wavetable</h1>
<p>先ほどのコードを注意深く見ていたら、ウェーブテーブルの値が1つ足りないことに気づいたかもしれない。最後の値がスキップされ、たまたま同じ値だった最初の値に折り返しているのだ。</p>
<p>In the <code>ウェーブテーブルオシレーター</code> constructor, assign the table size variable to hold the resolution of the wave table minus one and define that member variable appropriately as follows:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">クラス WavetableOscillator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    WavetableOscillator (const juce::AudioSampleBuffer&amp; wavetableToUse)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        : wavetable (wavetableToUse)、</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          tableSize (wavetable.getNumSamples() - 1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        jassert (wavetable.getNumChannels() == 1)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">private：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const juce::AudioSampleBuffer&amp; wavetable；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const int tableSize；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float currentIndex = 0.0f, tableDelta = 0.0f；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <code>setFrequency()</code> function needs to be updated using this variable and notice that the angle delta of the table will be slightly smaller:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">void setFrequency (float frequency, float sampleRate)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auto tableSizeOverSampleRate = (float) tableSize / sampleRate；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        tableDelta = frequency * tableSizeOverSampleRate；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <code>getNextSample()</code> function remains fairly similar except that we don&#x27;t need to wrap the higher index anymore because we will increase the size of the table in the next step:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">強制インライン float getNextSample() noexcept</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auto index0 = (unsigned int) currentIndex；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auto index1 = index0 + 1；</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>ここでは、以前とは異なり、解像度を定義された値の1つ上に設定し、最後のサンプルを最初のサンプルと同じに設定している：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">void createWavetable()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sineTable.setSize (1, (int) tableSize + 1)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auto* samples = sineTable.getWritePointer (0)；</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">samples[tableSize] = samples[0]；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This allows us to reduce the wrapping condition in the processing call and transfering the load to the <code>createWavetable()</code> function that only gets called once at the start of the application.</p>
<p>結果は前のセクションと同じに聞こえるはずだが、CPU使用率がわずかに減少していることに注目してほしい。</p>
<p>このコードをさらに最適化する方法はありますか？DSPではすべての算術演算が性能にカウントされるので、できるだけ多くの演算を省くようにすべきです。</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>注記</div><div class="admonitionContent_BuS1"><p>The source code for this modified version of the code can be found in the <code>WavetableSynthTutorial_03.h</code> file of the demo project.</p></div></div>
<h1>Selecting the Harmonics</h1>
<p>ランダムなサイン波サウンドを出力する代わりに、ハーモニクスを明示的に設定することで、調和のとれたサイン波を作成してみよう。</p>
<p>Modify the <code>createWavetable()</code> function to incorporate the harmonics in the wavetable samples of the sine wave as follows:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    void createWavetable()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sineTable.setSize (1, (int) tableSize + 1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sineTable.clear();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auto* samples = sineTable.getWritePointer (0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int harmonics[] = { 1, 3, 5, 6, 7, 9, 13, 15 };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        float harmonicWeights[] = { 0.5f, 0.1f, 0.05f, 0.125f, 0.09f, 0.005f, 0.002f, 0.001f };     // [1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        jassert (juce::numElementsInArray (harmonics) == juce::numElementsInArray (harmonicWeights));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (auto harmonic = 0; harmonic &lt; juce::numElementsInArray (harmonics); ++harmonic)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            auto angleDelta = juce::MathConstants::twoPi / (double) (tableSize - 1) * harmonics[harmonic]; // [2].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            auto currentAngle = 0.0；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            for (unsigned int i = 0; i &lt; tableSize; ++i)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                auto sample = std::sin (currentAngle)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                samples[i] += (float) sample * harmonicWeights[harmonic]; // [3].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                currentAngle += angleDelta；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        samples[tableSize] = samples[0]；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>[1]: Define two arrays that respectively describe the indices of the odd harmonics and its corresponding weights.</li>
<li>[2]: For each harmonic, calculate the angle delta by multiplying the full 2pi cycle by the harmonic order and dividing by the table size. This essentially multiplies the frequency generated by the harmonic order.</li>
<li>[3]: For each sample in the table, retrieve the sine value from the current angle, add the value to the existing buffer sample by trimming the gain with the corresponding harmonic weight and increment the current angle by the delta value.</li>
</ul>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">void prepareToPlay (int, double sampleRate) override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auto numberOfOscillators = 10；</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Finally, reduce the number of oscillators to 10 in the <code>prepareToPlay()</code> function and listen to the result by running the application.</p>
<p>倍音を偶数系列に変更して、発生する音の音色の変化に注目してください。奇数系列と偶数系列はどうでしょう？</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>警告</div><div class="admonitionContent_BuS1"><p>オーディオ信号に高い周波数成分を加えるので、エイリアシング効果に注意する必要があります！このチュートリアルの範囲外ですが、ナイキスト・シャノンのサンプリング定理とアップサンプリン グについて読むとよいでしょう。</p><div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>注記</div><div class="admonitionContent_BuS1"><p>The source code for this modified version of the code can be found in the <code>WavetableSynthTutorial_04.h</code> file of the demo project.</p></div></div></div></div>
<h1>Notes</h1>
<p>このチュートリアルでは、サイン波からウェーブテーブルを作成する方法について説明しましたが、最初のサンプルが最後のサンプルと一致していれば、基本的にどのような種類の周期波形でも保存することができます。</p>
<p>Modify the <code>createWavetable()</code> function to generate and store different types of waveforms such as square, triangle or sawtooth waves.</p>
<h1>Summary</h1>
<p>このチュートリアルでは、ウェーブテーブル・シンセサイザーの実装方法を学びました。特に</p>
<ul>
<li>正弦波オシレーターをウェーブテーブル・オシレーターに変換。</li>
<li>数百の発振器でCPU使用率を最適化。</li>
<li>同じ発振器のランダムな倍音をオーディオ出力に書き込む。</li>
<li>ハーモニクスとそのウェイトを選択することで、調和のとれたサウンドを作り出した。</li>
</ul>
<h1>See also</h1>
<ul>
<li><a href="/juce-tutorial-ja/synth/tutorial_simple_synth_noise/">チュートリアルホワイトノイズ・ジェネレーターを作る</a></li>
<li><a href="/juce-tutorial-ja/synth/tutorial_sine_synth/">チュートリアルサイン波シンセサイザーを作る</a></li>
<li><a href="/juce-tutorial-ja/synth/tutorial_synth_db_level_control/">チュートリアルデシベルを使ってオーディオレベルをコントロールする</a></li>
<li><a href="/juce-tutorial-ja/synth/tutorial_synth_level_control/">チュートリアルオーディオレベルのコントロール</a></li>
<li><a href="/juce-tutorial-ja/synth/tutorial_synth_using_midi_input/">チュートリアルMIDIシンセサイザーを作る</a></li>
<li><a href="/juce-tutorial-ja/synth/tutorial_looping_audio_sample_buffer/">チュートリアルAudioSampleBufferクラスを使ったオーディオのループ再生</a></li>
<li><a href="/juce-tutorial-ja/synth/tutorial_looping_audio_sample_buffer_advanced/">チュートリアルAudioSampleBufferクラスを使ったオーディオのループ（上級者向け）</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/m1m0zzz/juce-tutorial-ja/tree/main/docs/synth/tutorial_wavetable_synth.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>このページを編集</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="ドキュメントページ"><a class="pagination-nav__link pagination-nav__link--prev" href="/juce-tutorial-ja/synth/tutorial_synth_using_midi_input/"><div class="pagination-nav__sublabel">前へ</div><div class="pagination-nav__label">MIDIシンセサイザーを作る</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/juce-tutorial-ja/category/midi/"><div class="pagination-nav__sublabel">次へ</div><div class="pagination-nav__label">MIDI</div></a></nav></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Tutorial</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/juce-tutorial-ja/category/getting-started/">Getting Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">JUCE</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://juce.com/learn/tutorials/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Tutorials<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://juce.com/learn/documentation/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Documentation<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://forum.juce.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/m1m0zzz/juce-tutorial-ja" target="_blank" rel="noopener noreferrer" class="footer__link-item">repo<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/juce-framework/JUCE" target="_blank" rel="noopener noreferrer" class="footer__link-item">JUCE GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">© 2024 Raw Material Software Limited. translation: mimoz</div></div></div></footer></div>
</body>
</html>