---
title: Slider クラス
sidebar_position: 8
tags: [初級]
---

# チュートリアル：Slider クラス

<SourcePageLink path="tutorial_slider_values" />

このチュートリアルでは、[Slider](https://docs.juce.com/master/classSlider.html "A slider control for changing a value.")クラスを紹介し、スライダーの動きに応答する方法と、スライダーから値を取得する方法を示します。また、スライダーで値を表示するための基本的なカスタマイズ技術も紹介します。

**レベル:** 初級<br/>
**プラットフォーム:** Windows, macOS, Linux, iOS, Android<br/>
**クラス:** [Slider](https://docs.juce.com/master/classSlider.html "A slider control for changing a value."), [Slider::Listener](https://docs.juce.com/master/classSlider.html#a1977aeac9b4363e8ed0cac0ac103055a), [Label](https://docs.juce.com/master/classLabel.html "A component that displays a text string, and can optionally become a text editor when clicked.")

## はじめに

:::tip
このチュートリアルは[チュートリアル：リスナーとブロードキャスター](../tutorial_listeners_and_broadcasters/)から続いており、最初にそれを読んで理解しておく必要があります。
:::

このチュートリアルのデモプロジェクトをこちらからダウンロードしてください：[PIP](https://docs.juce.com/tutorials/PIPs/SliderValuesTutorial.zip) \| [ZIP](https://docs.juce.com/tutorials/ZIPs/SliderValuesTutorial.zip)。プロジェクトを解凍し、最初のヘッダファイルを Projucer で開いてください。

この手順でサポートが必要な場合は、[チュートリアル：Projucer Part 1: Projucer を始めよう](../../getting-started/tutorial_new_projucer_project/)を参照してください。

## デモプロジェクト

デモプロジェクトは 2 つの水平線形スライダーを表示します。1 つのスライダーには**Frequency**というラベルが付けられ、もう 1 つには**Duration**というラベルが付けられています。以下のスクリーンショットに示されています：

<CaptionImage
  src="/_images/tutorial_slider_values_screenshot1.png"
  caption="2つのスライダーとその値を示すデモプロジェクトのユーザーインターフェース"
/>

両方のスライダーは、周波数（_f_）が持続時間（_d_）の逆数であるため、本質的に同じ基礎値を表示するという考えです：

_f_ = <sup>1</sup>／<sub>d</sub>

どちらかのスライダーが動かされると、もう一方が変更を反映して更新されます。

## JUCE Slider クラス

このチュートリアルでは、スライダーの作成、範囲の設定、値の変更のリッスン、およびプログラム的にスライダーの値を更新する方法を示します。デモアプリケーションの実行時に、両方のスライダーにテキストボックスが含まれていることに気づくでしょう。このテキストボックスには、周波数の単位（**Hz**、ヘルツ）と持続時間の単位（**s**、秒）も含まれています。

### スライダーの追加

スライダーは`MainContentComponent`クラスのプライベートメンバーとして追加されています：

```cpp
private:
    juce::Slider frequencySlider;
    juce::Label frequencyLabel;
    juce::Slider durationSlider;
    juce::Label durationLabel;

    JUCE_DECLARE_NON_COPYABLE_WITH_LEAK_DETECTOR (MainContentComponent)
};
```

各[Slider](https://docs.juce.com/master/classSlider.html "A slider control for changing a value.")オブジェクトに対して[Label](https://docs.juce.com/master/classLabel.html "A component that displays a text string, and can optionally become a text editor when clicked.")オブジェクトも追加していることに注意してください。これらは、スライダーの左側に**Frequency**と**Duration**というテキストを表示するためのものです。現在のスライダー値を表示するスライダーコントロールのすぐ左側のボックスは、実際には[Slider](https://docs.juce.com/master/classSlider.html "A slider control for changing a value.")オブジェクトの一部です。

また、スライダーの変更を受信するためにクラスを登録できるよう、[Slider::Listener](https://docs.juce.com/master/classSlider.html#a1977aeac9b4363e8ed0cac0ac103055a)クラスを基底クラスとして追加しています：

```cpp
class MainContentComponent : public juce::Component,
                             public juce::Slider::Listener
{
public:
```

`MainContentComponent`コンストラクタでは、スライダーを子コンポーネントとして追加し（[チュートリアル：親コンポーネントと子コンポーネント](../tutorial_component_parents_children/)を参照）、可視化して、スライダーが表す値の範囲を設定します。まず、`frequencySlider`メンバーを設定します：

```cpp
MainContentComponent()
{
    addAndMakeVisible (frequencySlider);
    frequencySlider.setRange (50, 5000.0); // [1]
    frequencySlider.setTextValueSuffix (" Hz"); // [2]
    frequencySlider.addListener (this); // [3]
```

- [1]：スライダーの範囲は[Slider::setRange()](https://docs.juce.com/master/classSlider.html#a9fbc23e67deb4a18d172c357a7cff14c "Sets the limits that the slider's value can take.")関数を使用して設定します。
- [2]：スライダーのテキストボックスのテキスト表示に接尾辞を追加して、値の単位を表示します。
- [3]：`MainContentComponent`オブジェクトをスライダーのリスナーとして追加します。

対応するラベルは以下のように設定されます：

```cpp
addAndMakeVisible (frequencyLabel);
frequencyLabel.setText ("Frequency", juce::dontSendNotification);
frequencyLabel.attachToComponent (&frequencySlider, true); // [4]
```

[Label::attachToComponent()](https://docs.juce.com/master/classLabel.html#a3c2397c0da1249f9e27e2279e0f2d4eb)関数[4]は、別のコンポーネントの隣にラベルを配置するのに非常に便利です。2 番目の引数`true`は、ラベルを他のコンポーネントの左側に配置します（`false`は上に配置します）。後で見るように、これにより`MainContentComponent::resized()`関数でラベルを手動で配置する必要がなくなります。

`durationSlider`と`durationLabel`メンバーも同様に設定されますが、このスライダーの範囲は`frequencySlider`メンバーの範囲の逆数に設定されます：

```cpp
addAndMakeVisible (durationSlider);
durationSlider.setRange (1.0 / frequencySlider.getMaximum(),
    1.0 / frequencySlider.getMinimum());
durationSlider.setTextValueSuffix (" s");
durationSlider.addListener (this);

addAndMakeVisible (durationLabel);
durationLabel.setText ("Duration", juce::dontSendNotification);
durationLabel.attachToComponent (&durationSlider, true);
```

### スライダーの配置

スライダーは`MainContentComponent::resized()`関数で配置されます。[Label::attachToComponent()](https://docs.juce.com/master/classLabel.html#a3c2397c0da1249f9e27e2279e0f2d4eb)関数を使用してラベルをスライダーにアタッチしたため、これらはスライダーの左側に自動的に配置されます。

```cpp
void resized() override
{
    auto sliderLeft = 120;
    frequencySlider.setBounds (sliderLeft, 20, getWidth() - sliderLeft - 10, 20);
    durationSlider.setBounds (sliderLeft, 50, getWidth() - sliderLeft - 10, 20);
}
```

### スライダーの変更への応答

以下のコードは、スライダーのリスナーがスライダーの値の変更に反応するようにします。

```cpp
void sliderValueChanged (juce::Slider* slider) override
{
    if (slider == &frequencySlider)
        durationSlider.setValue (1.0 / frequencySlider.getValue(), juce::dontSendNotification);
    else if (slider == &durationSlider)
        frequencySlider.setValue (1.0 / durationSlider.getValue(), juce::dontSendNotification);
}
```

これは、[Slider::Listener](https://docs.juce.com/master/classSlider.html#a1977aeac9b4363e8ed0cac0ac103055a)を基底クラスとして追加した場合にオーバーライドする必要がある[Slider::Listener::sliderValueChanged()](https://docs.juce.com/master/classSliderListener.html#aa43e257ace7dd4a61399b30cb3285e75 "Called when the slider's value is changed.")関数です。ここでは、[Slider::setValue()](https://docs.juce.com/master/classSlider.html#a430a5c4e56b39dd622f5800f787e0822 "Changes the slider's current value.")関数を呼び出すことで、スライダーの逆数を他のスライダーに渡すだけです。また、スライダーにその変更をブロードキャストしないように伝えます。これは、2 つのスライダーが互いに依存しているこのような場合に、無限のフィードバックループが発生する可能性があるためです。[dontSendNotification](#)の値はこの潜在的なループを中断します。算術が正確で、両方向の変換が同一の結果を生成すると仮定すると、これは必要ないはずです。これは、値が実際に変更された場合にのみスライダーがリスナーにブロードキャストするためです。（このような状況で変換にわずかな丸め誤差がある場合に問題が発生する可能性があります。）[dontSendNotification](#)の値を省略してみることができます。これにより、スライダーが変更をブロードキャスト*する*デフォルトの動作が発生します。独自のアプリケーションの特定のユースケースで[dontSendNotification](#)を使用するかどうかを慎重に検討する必要があります。

### 初期値の設定

コンストラクタで`frequencySlider`スライダーは 500 の値に設定されます。これにより、今回は[dontSendNotification](#)の値を省略するため、`durationSlider`スライダーが更新されます：

```cpp
frequencySlider.setValue (500.0); // [5]
```

## いくつかのカスタマイズ

インターフェースをより効果的にするために、いくつかのシンプルなカスタマイズを追加できます。

### テキストボックスを広くする

特に`durationSlider`スライダーのテキストボックスは、値を満足に表示するために多くの桁が必要です。これを行うには、[Slider::setTextBoxStyle()](https://docs.juce.com/master/classSlider.html#a5bc748a21e72fe14153bc9fe5ac03e77 "Changes the location and properties of the text-entry box.")関数を使用できます。`MainContentComponent`コンストラクタに以下の 2 行のコードを追加します：

```cpp
frequencySlider.setTextBoxStyle (juce::Slider::TextBoxLeft, false, 160, frequencySlider.getTextBoxHeight());
durationSlider.setTextBoxStyle (juce::Slider::TextBoxLeft, false, 160, durationSlider.getTextBoxHeight());
```

これにより、各ケースでテキストボックスが 160 ピクセルに設定されます（ただし、[Slider::getTextBoxHeight()](https://docs.juce.com/master/classSlider.html#a8258ee0e1222f3e02a696243a3468578 "Returns the height used for the text-box.")関数を使用して高さを維持します）。

<CaptionImage
  src="/_images/tutorial_slider_values_screenshot2.png"
  caption="より広いテキストボックスのスライダー"
/>

### スライダー値のスキュー

デフォルトでは、スライダートラックは線形です。つまり、スライダーの値はスライダートラックに沿ったスライダーサムの位置に比例します。インターフェースを操作すると、これが正しくないと感じることがわかります。スライダー*スキュー*を調整して、スライダートラックを対数にすることができます。これを行うには、[Slider::setSkewFactorFromMidPoint()](https://docs.juce.com/master/classSlider.html#a2d948c662c1f636810d3125d8b3f0d47 "Sets up a skew factor to alter the way values are distributed.")関数を使用できます。スライダーが設定された後、`MainContentComponent`コンストラクタに以下の 2 行のコードを追加して試してみてください：

```cpp
frequencySlider.setSkewFactorFromMidPoint (500);
durationSlider.setSkewFactorFromMidPoint (0.002);
```

これにより、`frequencySlider`スライダーのスライダートラックの中央に 500 の値が配置され、`durationSlider`スライダーには 0.002 が配置されます。効果的に、スライダーは同じように動くように見えますが、反対方向に動きます。このような非線形のスライダートラックは、時間や周波数などのパラメータでうまく機能します。小さい値に対してより細かい制御が必要ですが、大きい値に対してはそれほど細かい制御を必要としない場合です。

:::tip
このセクションの完成したコードは、このチュートリアルのデモプロジェクトの`SliderValuesTutorial_02.h`ファイルにあります。
:::

<!-- -->

:::note
演習：[Slider::setSkewFactorFromMidPoint()](https://docs.juce.com/master/classSlider.html#a2d948c662c1f636810d3125d8b3f0d47 "Sets up a skew factor to alter the way values are distributed.")関数の呼び出しに異なる値を試したり、異なるテキストボックスサイズを試したりしてください。[Slider](https://docs.juce.com/master/classSlider.html "A slider control for changing a value.")クラスの API リファレンスを見て、他のカスタマイズを試してください。
:::

### Slider コールバックの簡素化

このチュートリアルで示されているリスナーとブロードキャスターのパラダイムを使用する代わりに、最新の C++標準のラムダ関数を使用してスライダーコールバックを簡素化できます。これは、複雑な実装を必要としないシンプルなコールバックに特にうまく機能します。

まず、[Slider::Listener](https://docs.juce.com/master/classSlider.html#a1977aeac9b4363e8ed0cac0ac103055a)クラスからの継承を削除し、MainContentComponent クラスの定義を以下のように復元します：

```cpp
class MainContentComponent : public juce::Component
{
public:
```

次に、MainContentComponent を[Slider](https://docs.juce.com/master/classSlider.html "A slider control for changing a value.")のリスナーとして追加する代わりに、[Slider::onValueChange](https://docs.juce.com/master/classSlider.html#a680d007f6a824a28a60aa05b4045e794 "You can assign a lambda to this callback object to have it called when the slider value is changed.")ヘルパーオブジェクトにラムダ関数を割り当てます：

```cpp
MainContentComponent()
{
    addAndMakeVisible (frequencySlider);
    frequencySlider.setRange (50, 5000.0);
    frequencySlider.setTextValueSuffix (" Hz");
    frequencySlider.onValueChange = [this] { durationSlider.setValue (1.0 / frequencySlider.getValue(), juce::dontSendNotification); };

    addAndMakeVisible (frequencyLabel);
    frequencyLabel.setText ("Frequency", juce::dontSendNotification);
    frequencyLabel.attachToComponent (&frequencySlider, true);

    addAndMakeVisible (durationSlider);
    durationSlider.setRange (1.0 / frequencySlider.getMaximum(),
        1.0 / frequencySlider.getMinimum());
    durationSlider.setTextValueSuffix (" s");
    durationSlider.onValueChange = [this] { frequencySlider.setValue (1.0 / durationSlider.getValue(), juce::dontSendNotification); };
```

これは、ユーザーが[Slider](https://docs.juce.com/master/classSlider.html "A slider control for changing a value.")の値を変更したときに呼び出す関数を[Slider](https://docs.juce.com/master/classSlider.html "A slider control for changing a value.")オブジェクトに伝えます。

:::tip
このコードの実装は、このチュートリアルのデモプロジェクトの`SliderValuesTutorial_03.h`ファイルにあります。
:::

## まとめ

このチュートリアルでは、[Slider](https://docs.juce.com/master/classSlider.html "A slider control for changing a value.")クラスを紹介しました。特に、以下のことを学びました：

- 特定の範囲で動作するようにスライダーを設定する方法。
- スライダー値の変更に応答する方法。
- 対数スケールを使用するようにスライダースキューを設定する方法。

## 関連項目

- [チュートリアル：リスナーとブロードキャスター](../tutorial_listeners_and_broadcasters/)
- [チュートリアル：ComboBox クラス](../tutorial_combo_box/)
- [チュートリアル：Label クラス](../tutorial_label/)
- [チュートリアル：ラジオボタンとチェックボックス](../tutorial_radio_buttons_checkboxes/)
