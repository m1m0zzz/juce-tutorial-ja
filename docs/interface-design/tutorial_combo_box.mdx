---
title: ComboBox クラス
sidebar_position: 10
tags: [初級]
---

# チュートリアル：ComboBox クラス

<SourcePageLink path="tutorial_combo_box" />

このチュートリアルでは、ユーザーに項目のリストを表示するためのコンポーネントである[ComboBox](https://docs.juce.com/master/classComboBox.html "A component that lets the user choose from a drop-down list of choices.")クラスを紹介します。[ComboBox](https://docs.juce.com/master/classComboBox.html "A component that lets the user choose from a drop-down list of choices.")オブジェクトの内容は動的に変更でき、テキスト入力にも使用できます。

**レベル:** 初級<br/>
**プラットフォーム:** Windows, macOS, Linux, iOS, Android<br/>
**クラス:** [ComboBox](https://docs.juce.com/master/classComboBox.html "A component that lets the user choose from a drop-down list of choices."), [Label](https://docs.juce.com/master/classLabel.html "A component that displays a text string, and can optionally become a text editor when clicked."), [Font](https://docs.juce.com/master/classFont.html "Represents a particular font, including its size, style, etc."), [Colour](https://docs.juce.com/master/classColour.html "Represents a colour, also including a transparency value."), [Colours](https://docs.juce.com/master/namespacejuce_1_1Colours.html "Contains a set of predefined named colours (mostly standard HTML colours)")

## はじめに

このチュートリアルのデモプロジェクトをこちらからダウンロードしてください：[PIP](https://docs.juce.com/tutorials/PIPs/ComboBoxTutorial.zip) \| [ZIP](https://docs.juce.com/tutorials/ZIPs/ComboBoxTutorial.zip)。プロジェクトを解凍し、最初のヘッダファイルを Projucer で開いてください。

この手順でサポートが必要な場合は、[チュートリアル：Projucer Part 1: Projucer を始めよう](../../getting-started/tutorial_new_projucer_project/)を参照してください。

## デモプロジェクト

デモプロジェクトは、[Label](https://docs.juce.com/master/classLabel.html "A component that displays a text string, and can optionally become a text editor when clicked.")コンポーネント内のウィンドウ上部にテキストを表示します（[チュートリアル：Label クラス](../tutorial_label/)を参照）。[ComboBox](https://docs.juce.com/master/classComboBox.html "A component that lets the user choose from a drop-down list of choices.")コンポーネントには、**Plain**、**Bold**、**Italic**の項目が含まれています。ユーザーはこれらの項目のいずれかを選択して、ラベル内のテキストのスタイルを変更できます。

<CaptionImage
  src="/_images/tutorial_combo_box_screenshot1.png"
  caption="フォントスタイルの選択"
/>

## ComboBox クラス

このチュートリアルでは、[ComboBox](https://docs.juce.com/master/classComboBox.html "A component that lets the user choose from a drop-down list of choices.")クラスの多くの機能を紹介します。[ComboBox](https://docs.juce.com/master/classComboBox.html "A component that lets the user choose from a drop-down list of choices.")コンポーネントには、テキスト文字列のリストが含まれています。これらの各テキスト文字列は、ID 番号（`int`値）に関連付けられています。現在選択されている項目を照会できます：

- [ComboBox::getSelectedId()](https://docs.juce.com/master/classComboBox.html#ab6232527104faad901ba0fa1380cd8ec "Returns the ID of the item that's currently shown in the box.")関数を使用して現在選択されている ID を取得する。
- [ComboBox::getText()](https://docs.juce.com/master/classComboBox.html#a420630894c696545c29271f557f7614d "Returns the text that is currently shown in the combo-box's text field.")関数を使用して現在表示されているテキストを要求する。

[ComboBox](https://docs.juce.com/master/classComboBox.html "A component that lets the user choose from a drop-down list of choices.")クラスはブロードキャスターでもあります。変更をリッスンするには、[ComboBox::Listener](https://docs.juce.com/master/classComboBox_1_1Listener.html "A class for receiving events from a ComboBox.")クラスを登録するか（[チュートリアル：リスナーとブロードキャスター](../tutorial_listeners_and_broadcasters/)を参照）、代わりに[ComboBox::onChange](https://docs.juce.com/master/classComboBox.html#a9cf2e20990541b9fbb539cd4a8e0ac4e "You can assign a lambda to this callback object to have it called when the selected ID is changed.")ヘルパーオブジェクトでラムダ関数を使用できます。

デモプロジェクトを見てみましょう。`MainContentComponent`クラスには 4 つのプライベートメンバーがあります：

```cpp
juce::Label textLabel { {}, "The quick brown fox jumps over the lazy dog." };
juce::Font textFont { 12.0f };
juce::ComboBox styleMenu;
```

[Label](https://docs.juce.com/master/classLabel.html "A component that displays a text string, and can optionally become a text editor when clicked.")と[Font](https://docs.juce.com/master/classFont.html "Represents a particular font, including its size, style, etc.")オブジェクトはコンストラクタで設定されます：

```cpp
MainContentComponent()
{
    addAndMakeVisible (textLabel);
    textLabel.setFont (textFont);
```

### 項目の追加

項目は、[ComboBox::addItem()](https://docs.juce.com/master/classComboBox.html#a37491da45f1cbb74e47f145e5664d8bf "Adds an item to be shown in the drop-down list.")関数を使用して[ComboBox](https://docs.juce.com/master/classComboBox.html "A component that lets the user choose from a drop-down list of choices.")オブジェクトに 1 つずつ追加できます。ここでは、「Plain」、「Bold」、「Italic」の項目をそれぞれ ID 番号 1、2、3 で追加します：

```cpp
// add items to the combo-box
addAndMakeVisible (styleMenu);
styleMenu.addItem ("Plain", 1);
styleMenu.addItem ("Bold", 2);
styleMenu.addItem ("Italic", 3);

styleMenu.onChange = [this] { styleMenuChanged(); };
styleMenu.setSelectedId (1);

setSize (400, 200);
}
```

### 変更への応答

`styleMenu` [ComboBox](https://docs.juce.com/master/classComboBox.html "A component that lets the user choose from a drop-down list of choices.")オブジェクトがアプリケーションでユーザーによって変更されたときに通知を受けるために、`MainContentComponent`オブジェクトをリスナーとして登録することもできました。しかし、この場合は[ComboBox::onChange](https://docs.juce.com/master/classComboBox.html#a9cf2e20990541b9fbb539cd4a8e0ac4e "You can assign a lambda to this callback object to have it called when the selected ID is changed.")ヘルパーオブジェクトを実装して`styleMenuChanged()`関数を直接呼び出します：

```cpp
styleMenu.onChange = [this] { styleMenuChanged(); };
```

`styleMenuChanged()`関数は`styleMenu`オブジェクトの変更を処理します：

```cpp
void styleMenuChanged()
{
    switch (styleMenu.getSelectedId())
    {
        case 1:
            textFont.setStyleFlags (juce::Font::plain);
            break;
        case 2:
            textFont.setStyleFlags (juce::Font::bold);
            break;
        case 3:
            textFont.setStyleFlags (juce::Font::italic);
            break;
        default:
            break;
    }

    textLabel.setFont (textFont);
}
```

ここでは、ユーザーの選択に基づいて`textFont` [Font](https://docs.juce.com/master/classFont.html "Represents a particular font, including its size, style, etc.")オブジェクトを適切に設定していることがわかります。次に、このフォントを使用して`textLabel` [Label](https://docs.juce.com/master/classLabel.html "A component that displays a text string, and can optionally become a text editor when clicked.")オブジェクトのフォントを更新します。

### 項目 ID 番号の使用

項目 ID として任意の整数を使用できます。ただし、ゼロは使用できません。ゼロには特別な意味があります。項目がまだ選択されていない、または[ComboBox](https://docs.juce.com/master/classComboBox.html "A component that lets the user choose from a drop-down list of choices.")オブジェクトが他のカスタムテキストを表示していることを示すために使用されます。

少数の項目では、コード内で 1、2、3 のような単純な数字を使用するのは管理しやすいです。しかし、アプリをさらに開発すると、すぐに管理できなくなります。私たちの場合、`enum`を使用するとより明確になります。スタイル用のプライベート`enum`を追加しましょう：

```cpp
enum FontStyles {
    stylePlain = 1,
    styleBold,
    styleItalic,
    numberOfStyles
};
```

次に、[ComboBox](https://docs.juce.com/master/classComboBox.html "A component that lets the user choose from a drop-down list of choices.")オブジェクトを設定するときにこれらの値を使用できます：

```cpp
addAndMakeVisible (styleMenu);

// add items to the combo-box
styleMenu.addItem ("Plain", 1);
styleMenu.addItem ("Bold", 2);
styleMenu.addItem ("Italic", 3);

styleMenu.onChange = [this] { styleMenuChanged(); };
styleMenu.setSelectedId (stylePlain);
```

そして`styleMenuChanged()`関数でも：

```cpp
void styleMenuChanged()
{
    switch (styleMenu.getSelectedId())
    {
        case stylePlain:
            textFont.setStyleFlags (juce::Font::plain);
            break;
        case styleBold:
            textFont.setStyleFlags (juce::Font::bold);
            break;
        case styleItalic:
            textFont.setStyleFlags (juce::Font::italic);
            break;
    }

    textLabel.setFont (textFont);
}
```

少なくとも、これによりコードがはるかに読みやすくなります。

ID 番号を使用する他の一般的な戦略は以下のとおりです：

- コンボボックスの項目に関連するデータを格納する配列を使用する。インデックス 0 を未使用のままにするか、オフセットを使用する必要がありますが、ID を配列へのインデックスとして使用できます。例えば、ID は 100 から始めることができます（100、101、102 など）。ID 100 は配列のインデックス 0 に関連付けられ、100 を加算または減算することで ID とインデックス間を簡単に変換できます。
- アプリ内の各コンボボックスに対して異なる範囲の整数のバッチを使用する。例えば、1 つのコンボボックスには ID 100、101、102...を使用し、別のコンボボックスには 200、201、202...などを使用できます。
- 項目テキストのハッシュを使用する。[String::hashCode()](https://docs.juce.com/master/classString.html#ad8ca5cb11984df03ff9697442da5ae4b "Generates a probably-unique 32-bit hashcode from this string.")を使用して文字列の*おそらく*一意のハッシュコードを取得できます。ただし、これがゼロを返す可能性があることに注意してください（この関数を空の文字列で使用するとゼロのハッシュコードが返されます）。

### セクションと区切り線

コンボボックスの項目リストには、区切り線とセクション見出しを含めることができます。これは非常に長いリストで特に便利です。テキストの色を変更するコンボボックスをアプリに追加しましょう。まず、色用の別の`enum`を追加します：

```cpp
enum TextColours {
    black = 1,
    white,
    red,
    darkred,
    indianred,
    green,
    darkgreen,
    lightgreen,
    blue,
    darkblue,
    lightblue,
    numberOfColours
};
```

そして`MainContentComponent`クラスに新しいメンバーを追加します：

```cpp
juce::Label textLabel { {}, "The quick brown fox jumps over the lazy dog." };
juce::Font textFont { 12.0f };
juce::ComboBox styleMenu;
juce::ComboBox coloursMenu;
```

`MainContentComponent`コンストラクタでは、新しいコンボボックスを設定するコードを追加する必要があります。ここでは、[ComboBox::addSeparator()](https://docs.juce.com/master/classComboBox.html#af53bb419bb136f11f6f0342702d8d902 "Adds a separator line to the drop-down list.")と[ComboBox::addSectionHeading()](https://docs.juce.com/master/classComboBox.html#ad376928ef517800c42628399e1a80990 "Adds a heading to the drop-down list, so that you can group the items into different sections.")という 2 つの新しい関数を紹介します：

```cpp
addAndMakeVisible (coloursMenu);

coloursMenu.addItem ("Black", black);
coloursMenu.addItem ("White", white);
coloursMenu.addSeparator();

coloursMenu.addSectionHeading ("Reds");
coloursMenu.addItem ("Red", red);
coloursMenu.addItem ("Dark Red", darkred);
coloursMenu.addItem ("Indian Red", indianred);
coloursMenu.addSeparator();

coloursMenu.addSectionHeading ("Greens");
coloursMenu.addItem ("Green", green);
coloursMenu.addItem ("Dark Green", darkgreen);
coloursMenu.addItem ("Light Green", lightgreen);
coloursMenu.addSeparator();

coloursMenu.addSectionHeading ("Blues");
coloursMenu.addItem ("Blue", blue);
coloursMenu.addItem ("Dark Blue", darkblue);
coloursMenu.addItem ("Light Blue", lightblue);

coloursMenu.onChange = [this] { coloursMenuChanged(); };
coloursMenu.setSelectedId (black);

coloursMenu.setEditableText (true);

setSize (400, 200);
}
```

セクション見出しなしで区切り線を使用したり、区切り線なしでセクション見出しを使用したりできますが、これらは一緒にうまく機能します。

:::tip
区切り線とセクション見出しは選択できず、関連する ID 番号がありません。
:::

`coloursMenu`オブジェクトの変更を処理する新しい関数を実装する必要があります：

```cpp
void coloursMenuChanged()
{
    juce::Colour textColour;

    switch (coloursMenu.getSelectedId())
    {
        case black:
            textColour = Colours::black;
            break;
        case white:
            textColour = Colours::white;
            break;

        case red:
            textColour = Colours::red;
            break;
        case darkred:
            textColour = Colours::darkred;
            break;
        case indianred:
            textColour = Colours::indianred;
            break;

        case green:
            textColour = Colours::green;
            break;
        case darkgreen:
            textColour = Colours::darkgreen;
            break;
        case lightgreen:
            textColour = Colours::lightgreen;
            break;

        case blue:
            textColour = Colours::blue;
            break;
        case darkblue:
            textColour = Colours::darkblue;
            break;
        case lightblue:
            textColour = Colours::lightblue;
            break;
    }

    textLabel.setColour (juce::Label::textColourId, textColour);
}
```

`resized()`関数で`coloursMenu`オブジェクトの境界を設定することを忘れないでください：

```cpp
void resized() override
{
    textLabel.setBounds (10, 10, getWidth() - 20, 20);
    styleMenu.setBounds (10, 40, getWidth() - 20, 20);
    coloursMenu.setBounds (10, 70, getWidth() - 20, 20);
}
```

プロジェクトを実行すると、ウィンドウは以下のようになるはずです：

<CaptionImage
  src="/_images/tutorial_combo_box_screenshot2.png"
  caption="色とスタイルの選択"
/>

これでラベルテキストの色を変更できます。

### テキスト入力

コンボボックスのデフォルトの動作は、リストされている項目のみをユーザーが選択できるようにすることです。ただし、コンボボックスを編集可能にして、ユーザーが他のテキストを入力できるようにすることができます。`MainContentComponent`コンストラクタで`coloursMenu`オブジェクトを編集可能にしましょう：

```cpp
coloursMenu.setEditableText (true);
```

## まとめ

このチュートリアルでは、[ComboBox](https://docs.juce.com/master/classComboBox.html "A component that lets the user choose from a drop-down list of choices.")クラスを紹介しました。このチュートリアルを読んだ後、以下のことができるようになるはずです：

- コンボボックスを作成し、項目を追加する。
- コンボボックスの項目に関連付けられた ID 番号を管理する。
- コンボボックスで選択された項目が変更されたときにユーザーに応答する。
- コンボボックスにカスタムテキストを入力できるようにする。
- コンボボックスの項目を無効化および有効化する。

## 関連項目

- [チュートリアル：Label クラス](../tutorial_label/)
- [チュートリアル：TableListBox クラス](../tutorial_table_list_box/)
- [チュートリアル：リスナーとブロードキャスター](../tutorial_listeners_and_broadcasters/)
