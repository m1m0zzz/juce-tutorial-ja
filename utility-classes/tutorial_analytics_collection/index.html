<!doctype html>
<html lang="ja" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-utility-classes/tutorial_analytics_collection" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">App analytics collection | JUCE日本語版チュートリアル</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://m1m0zzz.github.io/juce-tutorial-ja/img/juce-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://m1m0zzz.github.io/juce-tutorial-ja/img/juce-social-card.jpg"><meta data-rh="true" property="og:url" content="https://m1m0zzz.github.io/juce-tutorial-ja/utility-classes/tutorial_analytics_collection/"><meta data-rh="true" property="og:locale" content="ja"><meta data-rh="true" name="docusaurus_locale" content="ja"><meta data-rh="true" name="docsearch:language" content="ja"><meta data-rh="true" name="keywords" content="JUCE, plugin, VST, 日本語, チュートリアル"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="App analytics collection | JUCE日本語版チュートリアル"><meta data-rh="true" name="description" content="Collect app usage data from users in JUCE applications. Send analytics events to Google Analytics using the analytics module."><meta data-rh="true" property="og:description" content="Collect app usage data from users in JUCE applications. Send analytics events to Google Analytics using the analytics module."><link data-rh="true" rel="icon" href="/juce-tutorial-ja/img/juce.png"><link data-rh="true" rel="canonical" href="https://m1m0zzz.github.io/juce-tutorial-ja/utility-classes/tutorial_analytics_collection/"><link data-rh="true" rel="alternate" href="https://m1m0zzz.github.io/juce-tutorial-ja/utility-classes/tutorial_analytics_collection/" hreflang="ja"><link data-rh="true" rel="alternate" href="https://m1m0zzz.github.io/juce-tutorial-ja/utility-classes/tutorial_analytics_collection/" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-1662Y26YFC"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-1662Y26YFC",{anonymize_ip:!0})</script><link rel="stylesheet" href="/juce-tutorial-ja/assets/css/styles.e1cde857.css">
<script src="/juce-tutorial-ja/assets/js/runtime~main.253e4de4.js" defer="defer"></script>
<script src="/juce-tutorial-ja/assets/js/main.9c5a865c.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="メインコンテンツまでスキップ"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">メインコンテンツまでスキップ</a></div><nav aria-label="ナビゲーション" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="ナビゲーションバーを開く" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/juce-tutorial-ja/"><div class="navbar__logo"><img src="/juce-tutorial-ja/img/juce.png" alt="Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/juce-tutorial-ja/img/juce.png" alt="Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">JUCE日本語版チュートリアル</b></a><a class="navbar__item navbar__link" href="/juce-tutorial-ja/tags/初級/">tag:初級</a><a class="navbar__item navbar__link" href="/juce-tutorial-ja/tags/中級/">tag:中級</a><a class="navbar__item navbar__link" href="/juce-tutorial-ja/tags/上級/">tag:上級</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/m1m0zzz/juce-tutorial-ja" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="ダークモードを切り替える(現在はライトモード)" aria-label="ダークモードを切り替える(現在はライトモード)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="先頭へ戻る" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="ドキュメントのサイドバー" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/juce-tutorial-ja/">About / このサイトについて</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/juce-tutorial-ja/category/getting-started/">Getting Started</a><button aria-label="&#x27;Getting Started&#x27;の目次を開く" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/juce-tutorial-ja/category/audio/">Audio</a><button aria-label="&#x27;Audio&#x27;の目次を開く" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/juce-tutorial-ja/category/synth/">Synth</a><button aria-label="&#x27;Synth&#x27;の目次を開く" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/juce-tutorial-ja/category/midi/">MIDI</a><button aria-label="&#x27;MIDI&#x27;の目次を開く" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/juce-tutorial-ja/category/plugins/">Plugins</a><button aria-label="&#x27;Plugins&#x27;の目次を開く" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/juce-tutorial-ja/category/dsp/">DSP</a><button aria-label="&#x27;DSP&#x27;の目次を開く" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/juce-tutorial-ja/category/graphics/">Graphics</a><button aria-label="&#x27;Graphics&#x27;の 目次を開く" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/juce-tutorial-ja/category/interface-design/">Interface Design</a><button aria-label="&#x27;Interface Design&#x27;の目次を開く" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/juce-tutorial-ja/category/mobile/">Mobile</a><button aria-label="&#x27;Mobile&#x27;の目次を開く" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/juce-tutorial-ja/category/utility-classes/">Utility Classes</a><button aria-label="&#x27;Utility Classes&#x27;の目次を隠す" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/juce-tutorial-ja/utility-classes/tutorial_big_integer/">The BigInteger class</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/juce-tutorial-ja/utility-classes/tutorial_random/">The Random class</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/juce-tutorial-ja/utility-classes/tutorial_file_reading/">File reading</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/juce-tutorial-ja/utility-classes/tutorial_value_tree/">The ValueTree class</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/juce-tutorial-ja/utility-classes/tutorial_undo_manager_value_tree/">Using an UndoManager with a ValueTree</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/juce-tutorial-ja/utility-classes/tutorial_analytics_collection/">App analytics collection</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/juce-tutorial-ja/utility-classes/tutorial_online_unlock_status/">Unlock your plugins through online registration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/juce-tutorial-ja/utility-classes/tutorial_app_plugin_packaging/">Package your app or plugin for distribution</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/juce-tutorial-ja/utility-classes/tutorial_osc_sender_receiver/">Implement the OSC protocol in your app</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="パンくずリストのナビゲーション"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="ホームページ" class="breadcrumbs__link" href="/juce-tutorial-ja/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/juce-tutorial-ja/category/utility-classes/"><span itemprop="name">Utility Classes</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">App analytics collection</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">このページの見出し</button></div><div class="theme-doc-markdown markdown"><p><a href="https://docs.juce.com/master/tutorial_analytics_collection.html">📚 Source Page</a></p>
<header><h1>Tutorial: App analytics collection</h1></header>
<p>Collect app usage data from users in JUCE applications. Send analytics events to Google Analytics using the analytics module.</p>
<p>Level: Intermediate</p>
<p>Platforms: Windows, macOS, Linux, iOS, Android</p>
<p>Classes: <a href="https://docs.juce.com/master/classThreadedAnalyticsDestination" target="_blank" rel="noopener noreferrer" title="A base class for dispatching analytics events on a dedicated thread.">ThreadedAnalyticsDestination</a>, <a href="https://docs.juce.com/master/classButtonTracker" target="_blank" rel="noopener noreferrer" title="A class that automatically sends analytics events to the Analytics singleton when a button is clicked...">ButtonTracker</a>, <a href="https://docs.juce.com/master/classWebInputStream" target="_blank" rel="noopener noreferrer" title="An InputStream which can be used to read from a given URL.">WebInputStream</a>, <a href="https://docs.juce.com/master/classCriticalSection" target="_blank" rel="noopener noreferrer" title="A re-entrant mutex.">CriticalSection</a>, <a title="Provides the type of scoped lock to use with a CriticalSection." href="/juce-tutorial-ja/utility-classes/tutorial_analytics_collection/classCriticalSection.html/#a4d398019b977a4c2151c6f1e2a06210b">CriticalSection::ScopedLockType</a></p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>警告</div><div class="admonitionContent_BuS1"><p>This project requires a Google Analytics account. If you need help with this, follow the instructions on the <a href="https://support.google.com/analytics/" target="_blank" rel="noopener noreferrer">Google Analytics website</a> to open an account.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="はじめる">はじめる<a href="#はじめる" class="hash-link" aria-label="はじめる への直接リンク" title="はじめる への直接リンク">​</a></h2>
<p>Download the demo project for this tutorial here: <a href="/juce-tutorial-ja/tutorials/PIPs/AnalyticsCollectionTutorial.zip/">PIP</a> | <a href="/juce-tutorial-ja/tutorials/ZIPs/AnalyticsCollectionTutorial.zip/">ZIP</a>. Unzip the project and open the first header file in the Projucer.</p>
<p>If you need help with this step, see <a href="/juce-tutorial-ja/utility-classes/tutorial_new_projucer_project/">Tutorial: Projucer Part 1: Getting started with the Projucer</a>.</p>
<p>Please make sure you have your Google Analytics API key written down and ready for this tutorial to fully work.</p>
<h1>The demo project</h1>
<p>The demo project shows a very simple UI with two buttons sending analytics events when pressed. Since the API key has not been set up yet, Google will not receive any events before implementation.</p>
<figure><img src="https://docs.juce.com/master/tutorial_analytics_collection_screenshot1.png" alt="The demo project app window"><figcaption><b>The demo project app window</b></figcaption></figure>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>注記</div><div class="admonitionContent_BuS1"><p>This project uses Google Analytics to track app analytics but you can apply this to any other service you wish to use.</p><p>The code presented here is broadly similar to the <strong>AnalyticsCollection</strong> from the JUCE Examples.</p></div></div>
<h1>Anatomy of events</h1>
<p>Events describe how the user has interacted with the content in applications and are sent to the analytics tracking system. To better categorise and filter the interactions, events are structured using the following keywords:</p>
<ul>
<li>Category: Describes groups of events that are combined under the analytics reports.</li>
<li>Action: Specifies the action that was performed to trigger the event.</li>
<li>Label: Additional information explaining the specific object that interacted with the user.</li>
<li>Value: <a href="https://docs.juce.com/master/classOptional" target="_blank" rel="noopener noreferrer" title="A simple optional type.">Optional</a> integer to provide numerical data to the event in question.</li>
</ul>
<p>All the events are sent with a unique user ID and a timestamp along with the keywords mentioned above. Additionally, users can be grouped into categories to better describe their capacity such as beta testers or developers.</p>
<h1>API key set up</h1>
<p>The first step for the project to work properly is to set up the Google Analytics API key. You can find the Tracking ID in your Google Analytics dashboard here:</p>
<figure><img src="https://docs.juce.com/master/tutorial_analytics_collection_screenshot2.png" alt="Google Analytics Tracking ID"><figcaption><b>Google Analytics Tracking ID</b></figcaption></figure>
<p>Copy this ID, and replace the <code>apiKey</code> placeholder variable in the <code>GoogleAnalyticsDestination</code> class:</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>警告</div><div class="admonitionContent_BuS1"><p>Ideally, this API key should not be visible in your binary distribution as there could be all sorts of malicious uses if discovered and may pollute your analytics data with spam. One way to prevent this would be to retrieve the API key dynamically at runtime (such as from your own server).</p></div></div>
<h1>Tracking app startup</h1>
<p>Let&#x27;s first start by tracking user-independent information such as app launches and define constant user information that will be used by the analytics system. In the constructor of the <code>MainContentComponent</code> class, we start by getting a reference to the <a href="https://docs.juce.com/master/classAnalytics" target="_blank" rel="noopener noreferrer" title="A singleton class to manage analytics data.">Analytics</a> singleton by calling <code>Analytics::getInstance()</code>.</p>
<p>We can then set the user ID with <code>setUserID()</code> by choosing a unique identifier for this user [1]. Make sure not to include any sensitive personal information in this identifier. We can also set a user group on this user by calling <code>setUserProperties()</code> using a <a href="https://docs.juce.com/master/classStringPairArray" target="_blank" rel="noopener noreferrer" title="A container for holding a set of strings which are keyed by another string.">StringPairArray</a> [2].</p>
<p>For the events to be received, we need to specify at least one destination to our <a href="https://docs.juce.com/master/classAnalytics" target="_blank" rel="noopener noreferrer" title="A singleton class to manage analytics data.">Analytics</a> instance. We can optionally add multiple destinations if we wish. In this case we add an instance of the GoogleAnalyticsDestination class to the singleton [3].</p>
<p>Since the <code>MainContentComponent</code> constructor gets called when the MainWindow is instantiated, we can log this event using the function <code>logEvent()</code> right when the component gets owned by the MainWindow [4].</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    MainContentComponent()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Add an analytics identifier for the user. Make sure you don&#x27;t accidentally</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // collect identifiable information if you haven&#x27;t asked for permission!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        juce::Analytics::getInstance()-&gt;setUserId (&quot;AnonUser1234&quot;);                                 // [1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Add any other constant user information.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        juce::StringPairArray userData;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        userData.set (&quot;group&quot;, &quot;beta&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        juce::Analytics::getInstance()-&gt;setUserProperties (userData);                               // [2]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Add any analytics destinations we want to use to the Analytics singleton.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        juce::Analytics::getInstance()-&gt;addDestination (new GoogleAnalyticsDestination());          // [3]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // The event type here should probably be DemoAnalyticsEventTypes::sessionStart</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // in a more advanced app.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        juce::Analytics::getInstance()-&gt;logEvent (&quot;startup&quot;, {}, DemoAnalyticsEventTypes::event);   // [4]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Likewise, we can log the shutdown event in the <code>MainContentComponent</code> destructor right when the MainWindow gets deleted [5].</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    ~MainContentComponent() override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // The event type here should probably be DemoAnalyticsEventTypes::sessionEnd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // in a more advanced app.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        juce::Analytics::getInstance()-&gt;logEvent (&quot;shutdown&quot;, {}, DemoAnalyticsEventTypes::event);  // [5]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h1>Tracking Button behaviour</h1>
<p>In order to add tracking to specific user actions, we need to define which user interactions we want recorded and sent. Fortunately to record button behaviour, we can use a handy class included in the JUCE analytics module called <a href="https://docs.juce.com/master/classButtonTracker" target="_blank" rel="noopener noreferrer" title="A class that automatically sends analytics events to the Analytics singleton when a button is clicked...">ButtonTracker</a> that will automatically handle this for us.</p>
<p>Let&#x27;s first declare a <a href="https://docs.juce.com/master/classButtonTracker" target="_blank" rel="noopener noreferrer" title="A class that automatically sends analytics events to the Analytics singleton when a button is clicked...">ButtonTracker</a> as a member variable in the <code>MainContentComponent</code> class [1].</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    juce::TextButton eventButton { &quot;Press me!&quot; }, crashButton { &quot;Simulate crash!&quot; };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    std::unique_ptr logEventButtonPress;   // [1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    JUCE_DECLARE_NON_COPYABLE_WITH_LEAK_DETECTOR (MainContentComponent)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now in the MainContentComponent constructor, we can link the specific <a href="https://docs.juce.com/master/classTextButton" target="_blank" rel="noopener noreferrer" title="A button that uses the standard lozenge-shaped background with a line of text on it.">TextButton</a> object we want to track by passing it as an argument to the <a href="https://docs.juce.com/master/classButtonTracker" target="_blank" rel="noopener noreferrer" title="A class that automatically sends analytics events to the Analytics singleton when a button is clicked...">ButtonTracker</a> constructor. We also set the event category and action properties to send when the event is fired [2].</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">        juce::StringPairArray logButtonPressParameters;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        logButtonPressParameters.set (&quot;id&quot;, &quot;a&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        logEventButtonPress.reset (new juce::ButtonTracker (eventButton, &quot;button_press&quot;, logButtonPressParameters)); // [2]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Create additional GUI components and implement tracking on them with different event parameters.</p>
<h1>Sending events</h1>
<p>The JUCE analytics module handles the logging of events on a dedicated thread and sends the analytics data in batches periodically. Therefore, we need to temporarily store the events on local storage until the data is sent. In the rest of this tutorial, we will be working in the <code>GoogleAnalyticsDestination</code> class.</p>
<p>We first need to specify a location to store our analytics event data in the application data directory. For this we use the special location <code>[File::userApplicationDataDirectory](classFile.html#a3e19cafabb03c5838160263a6e76313da0c9f89d8dc9f9f32c9eb42428385351d &quot;The folder in which applications store their persistent user-specific settings.&quot;)</code> to find the correct location and navigate to the corresponding application folder for our app [1]. If the location does not exist we create the folder [2] and save the file path as an XML file name extension [3].</p>
<p>We can now start the thread by using the <code>startAnalyticsThread()</code> function and specifying the waiting time between batches of events in milliseconds [4].</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    GoogleAnalyticsDestination()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        : ThreadedAnalyticsDestination (&quot;GoogleAnalyticsThread&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Choose where to save any unsent events.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            auto appDataDir = juce::File::getSpecialLocation (juce::File::userApplicationDataDirectory)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                   .getChildFile (juce::JUCEApplication::getInstance()-&gt;getApplicationName());  // [1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (! appDataDir.exists())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                appDataDir.createDirectory();                                                                   // [2]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            savedEventsFile = appDataDir.getChildFile (&quot;analytics_events.xml&quot;);                                 // [3]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">        startAnalyticsThread (initialPeriodMs);                                                                 // [4]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the class destructor, we have to ensure that the last batch of events can be sent without the application being killed by the operating system. To allow this, we provide one last batch period while sleeping the thread before stopping it forcibly after 1 second. This provides enough time for one last sending attempt without elongating too much the application shutdown time.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    ~GoogleAnalyticsDestination() override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Here we sleep so that our background thread has a chance to send the</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // last lot of batched events. Be careful - if your app takes too long to</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // shut down then some operating systems will kill it forcibly!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        juce::Thread::sleep (initialPeriodMs);  // [5]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        stopAnalyticsThread (1000);             // [6]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We can supply the maximum number of events to send in batches by overriding the <code>getMaximumBatchSize()</code> function like so:</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="formatting-the-http-request">Formatting the HTTP request<a href="#formatting-the-http-request" class="hash-link" aria-label="Formatting the HTTP request への直接リンク" title="Formatting the HTTP request への直接リンク">​</a></h2>
<p>Now we need to format the correct HTTP request to log these events to the analytics server. The <a href="https://docs.juce.com/master/classURL" target="_blank" rel="noopener noreferrer" title="Represents a URL and has a bunch of useful functions to manipulate it.">URL</a> we are trying to construct with its corresponding POST data in the case of a button press behaviour for example looks something like this:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">POST /batch HTTP/1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Host: www.google-analytics.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">v=1                            // Version Number</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&amp;aip=1                         // Anonymise IP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&amp;tid=UA-XXXXXXXXX-1            // Tracking ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&amp;t=event                       // Log Type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&amp;ec=button_press               // Event Category</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&amp;ea=a                          // Event Action</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&amp;cid=AnonUser1234              // User ID</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>[v]: The batch logging API version.</li>
<li>[aip]: The IP address of the sender is anonymised.</li>
<li>[tid]: The Tracking ID for the corresponding app.</li>
<li>[t]: The type of logging for the analytics system.</li>
<li>[ec]: The category identifier for the logged event.</li>
<li>[ea]: The action identifier for the logged event.</li>
<li>[cid]: The user ID for the corresponding user.</li>
</ul>
<p>In a typical app lifecycle, the batched logger will first process the appStarted event when the application is fired up. Then when the user clicks on the button we log the button_press event and finally log the appStopped event when the application quits.</p>
<p>In order to account for these 3 logging scenarios, we need to construct different requests in the <code>logBatchedEvents()</code> function:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    bool logBatchedEvents (const juce::Array&amp; events) override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Send events to Google Analytics.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        juce::String appData (&quot;v=1&amp;aip=1&amp;tid=&quot; + apiKey);       // [1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        juce::StringArray postData;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (auto&amp; event : events)                              // [2]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            juce::StringPairArray data;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            switch (event.eventType)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                case (DemoAnalyticsEventTypes::event):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    data.set (&quot;t&quot;, &quot;event&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    if (event.name == &quot;startup&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        data.set (&quot;ec&quot;,  &quot;info&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        data.set (&quot;ea&quot;,  &quot;appStarted&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    else if (event.name == &quot;shutdown&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        data.set (&quot;ec&quot;,  &quot;info&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        data.set (&quot;ea&quot;,  &quot;appStopped&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    else if (event.name == &quot;button_press&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        data.set (&quot;ec&quot;,  &quot;button_press&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        data.set (&quot;ea&quot;,  event.parameters[&quot;id&quot;]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    else if (event.name == &quot;crash&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        data.set (&quot;ec&quot;,  &quot;crash&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        data.set (&quot;ea&quot;,  &quot;crash&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        jassertfalse;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        continue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                default:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    // Unknown event type! In this demo app we&#x27;re just using a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    // single event type, but in a real app you probably want to</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    // handle multiple ones.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    jassertfalse;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            data.set (&quot;cid&quot;, event.userID);                                 // [3]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            juce::StringArray eventData;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            for (auto&amp; key : data.getAllKeys())                             // [4]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                eventData.add (key + &quot;=&quot; + juce::URL::addEscapeChars (data[key], true));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            postData.add (appData + &quot;&amp;&quot; + eventData.joinIntoString (&quot;&amp;&quot;));  // [5]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auto url = juce::URL (&quot;https://www.google-analytics.com/batch&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       .withPOSTData (postData.joinIntoString (&quot;\n&quot;));      // [6]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>[1]: We start by adding the version number, anonymised IP and tracking ID to the appData string variable.</li>
<li>[2]: Then for each event in the batch, we determine the type of event in question to set its category and action properties. If the event is a startup or a shutdown, we set the event category to &quot;info&quot; and set the action property to &quot;appStarted&quot; or &quot;appStopped&quot; respectively. If the event is a button pressing, we set the event category to &quot;button_press&quot; and retrieve its action property from the id parameter of the <a href="https://docs.juce.com/master/classButtonTracker" target="_blank" rel="noopener noreferrer" title="A class that automatically sends analytics events to the Analytics singleton when a button is clicked...">ButtonTracker</a>.</li>
<li>[3]: We also set the user ID for the event to log.</li>
<li>[4]: Now for all the individual <a href="https://docs.juce.com/master/classStringPairArray" target="_blank" rel="noopener noreferrer" title="A container for holding a set of strings which are keyed by another string.">StringPairArray</a> entries, we concatenate keys with their corresponding values by inserting an equal sign in between and escaping any special characters from the <a href="https://docs.juce.com/master/classURL" target="_blank" rel="noopener noreferrer" title="Represents a URL and has a bunch of useful functions to manipulate it.">URL</a>.</li>
<li>[5]: Finally, we can join all the event parameters together with ampersand signs in between and by prepending the initial appData content to the front.</li>
<li>[6]: The <a href="https://docs.juce.com/master/classURL" target="_blank" rel="noopener noreferrer" title="Represents a URL and has a bunch of useful functions to manipulate it.">URL</a> is eventually constructed with its POST data appended line by line. This way we can send multiple events in a single HTTP request.</li>
</ul>
<p>Modify the code above to handle all event properties including label and value attributes.</p>
<p>Now that we have our <a href="https://docs.juce.com/master/classURL" target="_blank" rel="noopener noreferrer" title="Represents a URL and has a bunch of useful functions to manipulate it.">URL</a> ready we need to send the request to the server by creating a <a href="https://docs.juce.com/master/classWebInputStream" target="_blank" rel="noopener noreferrer" title="An InputStream which can be used to read from a given URL.">WebInputStream</a>. We first have to lock the <a href="https://docs.juce.com/master/classCriticalSection" target="_blank" rel="noopener noreferrer" title="A re-entrant mutex.">CriticalSection</a> mutex declared as a member variable called webStreamCreation. Using a ScopedLock object allows us to automatically lock and unlock the mutex for the piece of code delimited by the curly brackets [1].</p>
<p>If the <code>stopLoggingEvents()</code> function was previously called due to the application terminating, we return immediately without attempting to initialise the <a href="https://docs.juce.com/master/classWebInputStream" target="_blank" rel="noopener noreferrer" title="An InputStream which can be used to read from a given URL.">WebInputStream</a> [2]. Otherwise, we can create it in a std::unique_ptr by passing the previously constructed <a href="https://docs.juce.com/master/classURL" target="_blank" rel="noopener noreferrer" title="Represents a URL and has a bunch of useful functions to manipulate it.">URL</a> as an argument and using POST as the method [3].</p>
<p>We can then connect to the specified <a href="https://docs.juce.com/master/classURL" target="_blank" rel="noopener noreferrer" title="Represents a URL and has a bunch of useful functions to manipulate it.">URL</a> and perform the request using the <code>connect()</code> function on the <a href="https://docs.juce.com/master/classWebInputStream" target="_blank" rel="noopener noreferrer" title="An InputStream which can be used to read from a given URL.">WebInputStream</a> [4]. If the response is successful, we just return positively from the function. Otherwise, we set an exponential decay on the batch period by multiplying the previous rate by 2 and return negatively from the function [5].</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            const juce::ScopedLock lock (webStreamCreation);        // [1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (shouldExit)                                         // [2]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            webStream.reset (new juce::WebInputStream (url, true)); // [3]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auto success = webStream-&gt;connect (nullptr);                // [4]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Do an exponential backoff if we failed to connect.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (success)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            periodMs = initialPeriodMs;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            periodMs *= 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        setBatchPeriod (periodMs);                                  // [5]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return success;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>When the application shuts down, we need to cancel connections to the <a href="https://docs.juce.com/master/classWebInputStream" target="_blank" rel="noopener noreferrer" title="An InputStream which can be used to read from a given URL.">WebInputStream</a> if there are any that are concurrently running. By first acquiring the lock from the same <a href="https://docs.juce.com/master/classCriticalSection" target="_blank" rel="noopener noreferrer" title="A re-entrant mutex.">CriticalSection</a> object using a ScopedLock, we ensure that the previously encountered critical section of the code in the <code>logBatchedEvents()</code> function will have terminated before [1]. Setting the shouldExit boolean to true prevents any new connections from being created subsequently [2]. Then we can finally cancel any <a href="https://docs.juce.com/master/classWebInputStream" target="_blank" rel="noopener noreferrer" title="An InputStream which can be used to read from a given URL.">WebInputStream</a> connections using the <code>cancel()</code> function if there are any [3].</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    void stopLoggingEvents() override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        const juce::ScopedLock lock (webStreamCreation);            // [1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        shouldExit = true;                                          // [2]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (webStream.get() != nullptr)                             // [3]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            webStream-&gt;cancel();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This completes the part of the tutorial dealing with logging events. However, if the transmission of event data fails and the application terminates, we currently have no way of keeping track of unlogged events.</p>
<h1>Save and restore unlogged events</h1>
<p>This section will cover the use of XML files to store any unlogged events to disk in the case of a lost connection.</p>
<p>The XML document storing unlogged event information will look something like this for a single button press:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                                                              // Root XML element for the whole document.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     // Event node with name, type, timestamp and user ID.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                                      // Parameters related to the parent event.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                      // Properties for the user in the parent event.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We will look at the <code>saveUnloggedEvents()</code> and <code>restoreUnloggedEvents()</code> functions that deal with saving and restoring events respectively. The <code>saveUnloggedEvents()</code> function will build an XML structure based on the format shown above and save the content in an XML file:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    void saveUnloggedEvents (const std::deque&amp; eventsToSave) override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Save unsent events to disk. Here we use XML as a serialisation format, but</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // you can use anything else as long as the restoreUnloggedEvents method can</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // restore events from disk. If you&#x27;re saving very large numbers of events then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // a binary format may be more suitable if it is faster - remember that this</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // method is called on app shutdown so it needs to complete quickly!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        juce::XmlDocument previouslySavedEvents (savedEventsFile);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        std::unique_ptr xml (previouslySavedEvents.getDocumentElement()); // [1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (xml.get() == nullptr || xml-&gt;getTagName() != &quot;events&quot;)                          // [2]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            xml.reset (new juce::XmlElement (&quot;events&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (auto&amp; event : eventsToSave)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            auto* xmlEvent = new juce::XmlElement (&quot;google_analytics_event&quot;);               // [3]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            xmlEvent-&gt;setAttribute (&quot;name&quot;, event.name);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            xmlEvent-&gt;setAttribute (&quot;type&quot;, event.eventType);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            xmlEvent-&gt;setAttribute (&quot;timestamp&quot;, (int) event.timestamp);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            xmlEvent-&gt;setAttribute (&quot;user_id&quot;, event.userID);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            auto* parameters = new juce::XmlElement (&quot;parameters&quot;);                         // [4]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            for (auto&amp; key : event.parameters.getAllKeys())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                parameters-&gt;setAttribute (key, event.parameters[key]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            xmlEvent-&gt;addChildElement (parameters);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            auto* userProperties = new juce::XmlElement (&quot;user_properties&quot;);                // [5]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            for (auto&amp; key : event.userProperties.getAllKeys())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                userProperties-&gt;setAttribute (key, event.userProperties[key]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            xmlEvent-&gt;addChildElement (userProperties);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            xml-&gt;addChildElement (xmlEvent);                                                // [6]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        xml-&gt;writeTo (savedEventsFile);                                                     // [7]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>[1]: First we retrieve any previously saved events from the XML file stored at the previously defined file location and build an <a href="https://docs.juce.com/master/classXmlElement" target="_blank" rel="noopener noreferrer" title="Used to build a tree of elements representing an XML document.">XmlElement</a> based on it.</li>
<li>[2]: If the <a href="https://docs.juce.com/master/classXmlElement" target="_blank" rel="noopener noreferrer" title="Used to build a tree of elements representing an XML document.">XmlElement</a> does not exist or does not have the root &quot;events&quot; node, we create it.</li>
<li>[3]: For each unsaved event in the queue, we create a &quot;google_analytics_event&quot; node with the event name, type, timestamp and user ID as attributes.</li>
<li>[4]: We also create a &quot;parameters&quot; node as a child node to the previously created one with event parameters as attributes to it.</li>
<li>[5]: At the same hierarchy level, we create a &quot;user_properties&quot; node as a child node with user properties as attributes to it.</li>
<li>[6]: We can then add the individual event nodes as children to the root &quot;events&quot; node.</li>
<li>[7]: Finally, we write the XML structure to the XML file and store the events.</li>
</ul>
<p>On the other hand, the <code>restoreUnloggedEvents()</code> function will in turn read an XML structure based on the same format shown previously and fill up the event queue:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    void restoreUnloggedEvents (std::deque&amp; restoredEventQueue) override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        juce::XmlDocument savedEvents (savedEventsFile);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        std::unique_ptr xml (savedEvents.getDocumentElement());           // [1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (xml.get() == nullptr || xml-&gt;getTagName() != &quot;events&quot;)                          // [2]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auto numEvents = xml-&gt;getNumChildElements();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (auto iEvent = 0; iEvent &lt; numEvents; ++iEvent)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            auto* xmlEvent = xml-&gt;getChildElement (iEvent);                                 // [3]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            juce::StringPairArray parameters;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            auto* xmlParameters = xmlEvent-&gt;getChildByName (&quot;parameters&quot;);                  // [4]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            auto numParameters = xmlParameters-&gt;getNumAttributes();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            for (auto iParam = 0; iParam &lt; numParameters; ++iParam)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                parameters.set (xmlParameters-&gt;getAttributeName (iParam),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                xmlParameters-&gt;getAttributeValue (iParam));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            juce::StringPairArray userProperties;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            auto* xmlUserProperties = xmlEvent-&gt;getChildByName (&quot;user_properties&quot;);         // [5]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            auto numUserProperties = xmlUserProperties-&gt;getNumAttributes();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            for (auto iProp = 0; iProp &lt; numUserProperties; ++iProp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                userProperties.set (xmlUserProperties-&gt;getAttributeName (iProp),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    xmlUserProperties-&gt;getAttributeValue (iProp));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            restoredEventQueue.push_back ({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                xmlEvent-&gt;getStringAttribute (&quot;name&quot;),                                      // [6]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                xmlEvent-&gt;getIntAttribute (&quot;type&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                static_cast (xmlEvent-&gt;getIntAttribute (&quot;timestamp&quot;)),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                parameters,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                xmlEvent-&gt;getStringAttribute (&quot;user_id&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                userProperties</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        savedEventsFile.deleteFile();                                                       // [7]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>[1]: Same as before, we retrieve any previously saved events from the XML file stored at the previously defined file location and build an <a href="https://docs.juce.com/master/classXmlElement" target="_blank" rel="noopener noreferrer" title="Used to build a tree of elements representing an XML document.">XmlElement</a> based on it.</li>
<li>[2]: If the <a href="https://docs.juce.com/master/classXmlElement" target="_blank" rel="noopener noreferrer" title="Used to build a tree of elements representing an XML document.">XmlElement</a> does not exist or does not have the root &quot;events&quot; node, we return from the function as there is nothing to do.</li>
<li>[3]: We first retrieve a single event child node to parse from the root parent.</li>
<li>[4]: For each attribute from the child &quot;parameters&quot; node, we set a key/value pair and add it to a <a href="https://docs.juce.com/master/classStringPairArray" target="_blank" rel="noopener noreferrer" title="A container for holding a set of strings which are keyed by another string.">StringPairArray</a>.</li>
<li>[5]: For each attribute from the child &quot;user_properties&quot; node, we set a key/value pair and add it to a <a href="https://docs.juce.com/master/classStringPairArray" target="_blank" rel="noopener noreferrer" title="A container for holding a set of strings which are keyed by another string.">StringPairArray</a>.</li>
<li>[6]: We can then push the individual events back into the event queue by setting the corresponding parameters from the <a href="https://docs.juce.com/master/classStringPairArray" target="_blank" rel="noopener noreferrer" title="A container for holding a set of strings which are keyed by another string.">StringPairArray</a> objects.</li>
<li>[7]: Finally, we delete the XML file from disk when done.</li>
</ul>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>注記</div><div class="admonitionContent_BuS1"><p>We used XML as a serialisation format but if we need to save large amounts of unsaved events, a binary format would be more efficient.</p></div></div>
<p>Save and restore unlogged events in a different serialisation format such as <a href="https://docs.juce.com/master/classJSON" target="_blank" rel="noopener noreferrer" title="Contains static methods for converting JSON-formatted text to and from var objects.">JSON</a> or in a binary format.</p>
<h1>概要</h1>
<p>In this tutorial, we have learnt how to track usage data with Google Analytics and the JUCE analytics module. In particular, we have:</p>
<ul>
<li>Sent analytics events to Google Analytics on a separate thread.</li>
<li>Stored unsent events locally in an XML document.</li>
<li>Restored saved events from the XML document to the event queue.</li>
</ul>
<h1>関連項目</h1>
<ul>
<li><a href="/juce-tutorial-ja/utility-classes/tutorial_android_studio/">Tutorial: Getting started with Android</a></li>
<li><a href="/juce-tutorial-ja/utility-classes/tutorial_android_screen_sizes/">Tutorial: Managing Android screen sizes</a></li>
<li><a href="/juce-tutorial-ja/utility-classes/tutorial_in_app_purchases/">Tutorial: In-App Purchases on desktop and mobile devices</a></li>
<li><a href="/juce-tutorial-ja/utility-classes/tutorial_push_notifications/">Tutorial: Push Notifications on desktop and mobile devices</a></li>
<li><a href="/juce-tutorial-ja/utility-classes/tutorial_app_plugin_packaging/">Tutorial: Package your app or plugin for distribution</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/m1m0zzz/juce-tutorial-ja/tree/main/docs/utility-classes/tutorial_analytics_collection.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>このページを編集</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="ドキュメントページ"><a class="pagination-nav__link pagination-nav__link--prev" href="/juce-tutorial-ja/utility-classes/tutorial_undo_manager_value_tree/"><div class="pagination-nav__sublabel">前へ</div><div class="pagination-nav__label">Using an UndoManager with a ValueTree</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/juce-tutorial-ja/utility-classes/tutorial_online_unlock_status/"><div class="pagination-nav__sublabel">次へ</div><div class="pagination-nav__label">Unlock your plugins through online registration</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#はじめる" class="table-of-contents__link toc-highlight">はじめる</a></li><li><a href="#formatting-the-http-request" class="table-of-contents__link toc-highlight">Formatting the HTTP request</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Tutorial</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/juce-tutorial-ja/category/getting-started/">Getting Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">JUCE</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://juce.com/learn/tutorials/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Tutorials<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://juce.com/learn/documentation/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Documentation<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://forum.juce.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/m1m0zzz/juce-tutorial-ja" target="_blank" rel="noopener noreferrer" class="footer__link-item">repo<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/juce-framework/JUCE" target="_blank" rel="noopener noreferrer" class="footer__link-item">JUCE GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">© 2024 Raw Material Software Limited. translation: mimoz</div></div></div></footer></div>
</body>
</html>