<!doctype html>
<html lang="ja" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-audio/tutorial_looping_audio_sample_buffer_advanced" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">AudioSampleBufferクラスを使ったオーディオのループ（上級者向け） | JUCE日本語版チュートリアル</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://m1m0zzz.github.io/juce-tutorial-ja/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://m1m0zzz.github.io/juce-tutorial-ja/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://m1m0zzz.github.io/juce-tutorial-ja/audio/tutorial_looping_audio_sample_buffer_advanced/"><meta data-rh="true" property="og:locale" content="ja"><meta data-rh="true" name="docusaurus_locale" content="ja"><meta data-rh="true" name="docsearch:language" content="ja"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="AudioSampleBufferクラスを使ったオーディオのループ（上級者向け） | JUCE日本語版チュートリアル"><meta data-rh="true" name="description" content="This tutorial shows how to play and loop audio stored in an オーディオサンプルバッファ object using thread-safe techniques. A technique for loading the audio data on a background thread is also introduced."><meta data-rh="true" property="og:description" content="This tutorial shows how to play and loop audio stored in an オーディオサンプルバッファ object using thread-safe techniques. A technique for loading the audio data on a background thread is also introduced."><link data-rh="true" rel="icon" href="/juce-tutorial-ja/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://m1m0zzz.github.io/juce-tutorial-ja/audio/tutorial_looping_audio_sample_buffer_advanced/"><link data-rh="true" rel="alternate" href="https://m1m0zzz.github.io/juce-tutorial-ja/audio/tutorial_looping_audio_sample_buffer_advanced/" hreflang="ja"><link data-rh="true" rel="alternate" href="https://m1m0zzz.github.io/juce-tutorial-ja/audio/tutorial_looping_audio_sample_buffer_advanced/" hreflang="x-default"><link rel="stylesheet" href="/juce-tutorial-ja/assets/css/styles.ee4ac6b4.css">
<script src="/juce-tutorial-ja/assets/js/runtime~main.5add7671.js" defer="defer"></script>
<script src="/juce-tutorial-ja/assets/js/main.cf826c6e.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="メインコンテンツまでスキップ"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">メインコンテンツまでスキップ</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/juce-tutorial-ja/"><div class="navbar__logo"><img src="/juce-tutorial-ja/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/juce-tutorial-ja/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">JUCE日本語版チュートリアル</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/juce-tutorial-ja/">Tutorial</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/m1m0zzz/juce-tutorial-ja" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="ダークモードを切り替える(現在はライトモード)" aria-label="ダークモードを切り替える(現在はライトモード)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="先頭へ戻る" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/juce-tutorial-ja/">About / このサイトについて</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/juce-tutorial-ja/category/getting-started/">Getting Started</a><button aria-label="Expand sidebar category &#x27;Getting Started&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/juce-tutorial-ja/category/audio/">Audio</a><button aria-label="Collapse sidebar category &#x27;Audio&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/juce-tutorial-ja/audio/tutorial_playing_sound_files/">オーディオプレーヤーの構築</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/juce-tutorial-ja/audio/tutorial_processing_audio_input/">オーディオ入力の処理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/juce-tutorial-ja/audio/tutorial_looping_audio_sample_buffer/">AudioSampleBufferクラスを使ったオーディオのループ再生</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/juce-tutorial-ja/audio/tutorial_looping_audio_sample_buffer_advanced/">AudioSampleBufferクラスを使ったオーディオのループ（上級者向け）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/juce-tutorial-ja/audio/tutorial_audio_thumbnail/">オーディオ波形を描く</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/juce-tutorial-ja/audio/tutorial_audio_device_manager/">AudioDeviceManagerクラス</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/juce-tutorial-ja/category/synth/">Synth</a><button aria-label="Expand sidebar category &#x27;Synth&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/juce-tutorial-ja/category/midi/">MIDI</a><button aria-label="Expand sidebar category &#x27;MIDI&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/juce-tutorial-ja/category/plugins/">Plugins</a><button aria-label="Expand sidebar category &#x27;Plugins&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/juce-tutorial-ja/category/dsp/">DSP</a><button aria-label="Expand sidebar category &#x27;DSP&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/juce-tutorial-ja/category/graphics/">Graphics</a><button aria-label="Expand sidebar category &#x27;Graphics&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/juce-tutorial-ja/category/interface-design/">Interface Design</a><button aria-label="Expand sidebar category &#x27;Interface Design&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/juce-tutorial-ja/category/mobile/">Mobile</a><button aria-label="Expand sidebar category &#x27;Mobile&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/juce-tutorial-ja/category/utility-classes/">Utility Classes</a><button aria-label="Expand sidebar category &#x27;Utility Classes&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="パンくずリストのナビゲーション"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="ホームページ" class="breadcrumbs__link" href="/juce-tutorial-ja/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/juce-tutorial-ja/category/audio/"><span itemprop="name">Audio</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">AudioSampleBufferクラスを使ったオーディオのループ（上級者向け）</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">このページの見出し</button></div><div class="theme-doc-markdown markdown"><h1>チュートリアルAudioSampleBufferクラスを使ったオーディオのループ（上級者向け）</h1>
<p>This tutorial shows how to play and loop audio stored in an <a href="/juce-tutorial-ja/audio/tutorial_looping_audio_sample_buffer_advanced/group__juce__audio__basics-buffers.html/#gab339ebab0d3b10c91c0d47c8fd2e50d2">オーディオサンプルバッファ</a> object using thread-safe techniques. A technique for loading the audio data on a background thread is also introduced.</p>
<p>レベル Advanced</p>
<p>プラットフォーム Windows, macOS, Linux</p>
<p>クラス： <a href="https://docs.juce.com/master/classReferenceCountedObject" target="_blank" rel="noopener noreferrer" title="A base class which provides methods for reference-counting.">参照カウントオブジェクト</a>, <a href="https://docs.juce.com/master/classReferenceCountedArray" target="_blank" rel="noopener noreferrer" title="Holds a list of objects derived from ReferenceCountedObject, or which implement basic reference-count...">参照カウント配列</a>, <a href="https://docs.juce.com/master/classThread" target="_blank" rel="noopener noreferrer" title="Encapsulates a thread.">スレッド</a>, <a href="https://docs.juce.com/master/classAudioBuffer" target="_blank" rel="noopener noreferrer" title="A multi-channel buffer containing floating point audio samples.">オーディオバッファ</a></p>
<h1>Getting started</h1>
<p>This tutorial leads on from <a href="/juce-tutorial-ja/audio/tutorial_looping_audio_sample_buffer/">チュートリアルAudioSampleBufferクラスを使ったオーディオのループ再生</a>. If you haven&#x27;t done so already, you should read that tutorial first.</p>
<p>Download the demo project for this tutorial here: <a href="/juce-tutorial-ja/tutorials/PIPs/LoopingAudioSampleBufferAdvancedTutorial.zip/">ピップ</a> | <a href="/juce-tutorial-ja/tutorials/ZIPs/LoopingAudioSampleBufferAdvancedTutorial.zip/">ジップ</a>. Unzip the project and open the first header file in the Projucer.</p>
<p>If you need help with this step, see <a href="/juce-tutorial-ja/audio/tutorial_new_projucer_project/">チュートリアルProjucerパート1：Projucerを始める</a>.</p>
<h1>The demo project</h1>
<p>The demo project implements similar behaviour to the demo project from <a href="/juce-tutorial-ja/audio/tutorial_looping_audio_sample_buffer/">チュートリアルAudioSampleBufferクラスを使ったオーディオのループ再生</a>. It allows the user to open an audio file that is loaded into a buffer and played in a loop. One major difference in this tutorial is that the audio system is kept running, rather than shutting it down each time we browse for a file. This is achieved by using some helpful classes for communicating between threads in a thread-safe manner.</p>
<h1>Thread-safe techniques</h1>
<p>You should recall in <a href="/juce-tutorial-ja/audio/tutorial_looping_audio_sample_buffer/">チュートリアルAudioSampleBufferクラスを使ったオーディオのループ再生</a> how we solved the potential problem of the audio thread and the message thread accessing potentially incomplete or corrupted data. Just before we browsed for a file we shut down the audio system. Then, once a file was selected, we opened the file and restarted the audio system. This is clearly an impractical and cumbersome method in a real application!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="reference-counted-objects">Reference-counted objects<a href="#reference-counted-objects" class="hash-link" aria-label="Reference-counted objects への直接リンク" title="Reference-counted objects への直接リンク">​</a></h2>
<p>The <a href="https://docs.juce.com/master/classReferenceCountedObject" target="_blank" rel="noopener noreferrer" title="A base class which provides methods for reference-counting.">参照カウントオブジェクト</a> class is a useful tool for passing messages and data between threads. Here, we store our <a href="/juce-tutorial-ja/audio/tutorial_looping_audio_sample_buffer_advanced/group__juce__audio__basics-buffers.html/#gab339ebab0d3b10c91c0d47c8fd2e50d2">オーディオサンプルバッファ</a> object and the playback position in a <a href="https://docs.juce.com/master/classReferenceCountedObject" target="_blank" rel="noopener noreferrer" title="A base class which provides methods for reference-counting.">参照カウントオブジェクト</a> class. To help with debugging, and to help illustrate how the class works, we also include <code>名称</code> member (although this isn&#x27;t strictly necessary for the class to function):</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    class ReferenceCountedBuffer  : public juce::ReferenceCountedObject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        typedef juce::ReferenceCountedObjectPtrPtr；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ReferenceCountedBuffer (const juce::String&amp; nameToUse、</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                int numChannels、</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                int numSamples)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            : name (nameToUse)、</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              バッファ (numChannels, numSamples)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            DBG (juce::String (&quot;Buffer named &#x27;&quot;) + name + &quot;&#x27; built. numChannels = &quot; + juce::String (numChannels) + &quot;, numSamples = &quot; + juce::String (numSamples))；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ~ReferenceCountedBuffer()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            DBG (juce::String (&quot;Buffer named &#x27;&quot;) + name + &quot;&#x27; 破壊されました&quot;)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        juce::AudioSampleBuffer* getAudioSampleBuffer()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return &amp;buffer；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int position = 0；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        juce::String name；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        juce::AudioSampleBuffer buffer；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        JUCE_DECLARE_NON_COPYABLE_WITH_LEAK_DETECTOR (ReferenceCountedBuffer).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <code>typedef</code> at the top of the class is an important part in implementing a <a href="https://docs.juce.com/master/classReferenceCountedObject" target="_blank" rel="noopener noreferrer" title="A base class which provides methods for reference-counting.">参照カウントオブジェクト</a> subclass. Rather than storing our <code>リファレンスカウントバッファー</code> object in a raw pointer, we store it in a <code>ReferenceCountedBuffer::Ptr</code> type. It is this that manages the reference count of the object (incrementing and decrementing as necessary) and its lifetime (deleting the object when the reference count reaches zero). We can also store an array of <code>リファレンスカウントバッファー</code> objects using the <a href="https://docs.juce.com/master/classReferenceCountedArray" target="_blank" rel="noopener noreferrer" title="Holds a list of objects derived from ReferenceCountedObject, or which implement basic reference-count...">参照カウント配列</a> class.</p>
<p>In our <code>メインコンテンツコンポーネント</code> class we store both an array and a single instance:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    juce::SpinLock mutex;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    juce::ReferenceCountedArrayバッファー</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ReferenceCountedBuffer::Ptr currentBuffer；</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <code>バッファ</code> member keeps hold of our buffers in the array until we are absolutely sure they are no longer needed by the audio thread. The <code>カレントバッファ</code> member holds the currently selected buffer.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="implementing-the-background-thread">Implementing the background thread<a href="#implementing-the-background-thread" class="hash-link" aria-label="Implementing the background thread への直接リンク" title="Implementing the background thread への直接リンク">​</a></h2>
<p>Our <code>メインコンテンツコンポーネント</code> class inherits from the <a href="https://docs.juce.com/master/classThread" target="_blank" rel="noopener noreferrer" title="Encapsulates a thread.">スレッド</a> class:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class MainContentComponent : public juce::AudioAppComponent、</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                               private juce::Thread</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public：</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This is used to implement our background thread. Our overridden <a title="Must be implemented to perform the thread&#x27;s actual code." href="/juce-tutorial-ja/audio/tutorial_looping_audio_sample_buffer_advanced/classThread.html/#aae90dfabab3e1776cf01a26e7ee3a620">スレッド::run()</a> function is as follows:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">void run() オーバーライド</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        while (! threadShouldExit())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            checkForBuffersToFree()；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            wait (500)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Here, we check whether there are any buffers to be freed, then our thread waits for 500ms or to be woken up (using the <a title="Wakes up the thread." href="/juce-tutorial-ja/audio/tutorial_looping_audio_sample_buffer_advanced/classThread.html/#a0b4d5a1ffaa35cc13f323a0524012a2b">スレッド::notify()</a> function). Essentially, this means that the check will occur at least every 500ms. The <code>checkForBuffersToFree()</code> function searches through our <code>バッファ</code> array to see if any buffers can be freed:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">void checkForBuffersToFree()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (auto i = buffers.size(); --i &gt;= 0;)                           // [1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ReferenceCountedBuffer::Ptr buffer (buffers.getUnchecked (i)); // [2].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (buffer-&gt;getReferenceCount() == 2) // [3].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                buffers.remove (i)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>[1]: It is useful to remember to iterate over the array in reverse in these situations. It is easier to avoid corrupting the array index access if we remove items as we iterate over the array.</li>
<li>[2]: This retains a copy of a buffer at the specified index.</li>
<li>[3]: If the reference count at this point is equal to 2 then we know that the audio thread can&#x27;t be using the buffer and we can remove it from the array. One of these two references will be in the <code>バッファ</code> and the other will be in the local <code>バッファ</code> variable. The removed buffer will delete itself as the <code>  バッファ</code> variable goes out of scope (as this will be the last remaining reference).</li>
</ul>
<p>Of course, we need to start the thread as our application starts, which we do in our <code>メインコンテンツコンポーネント</code> constructor:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">startThread()；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="opening-the-file">Opening the file<a href="#opening-the-file" class="hash-link" aria-label="Opening the file への直接リンク" title="Opening the file への直接リンク">​</a></h2>
<p>Our <code>openButtonClicked()</code> function is similar to the <code>openButtonClicked()</code> function from <a href="/juce-tutorial-ja/audio/tutorial_looping_audio_sample_buffer/">チュートリアルAudioSampleBufferクラスを使ったオーディオのループ再生</a> with some minor differences:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    void openButtonClicked()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        chooser = std::make_unique (&quot;Select a Wave file shorter than 2 seconds to play...&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                       juce::File{},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                       &quot;*.wav&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auto chooserFlags = juce::FileBrowserComponent::openMode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          | juce::FileBrowserComponent::canSelectFiles;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        chooser-&gt;launchAsync (chooserFlags, [this] (const juce::FileChooser&amp; fc)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            auto file = fc.getResult();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (file == juce::File{})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            std::unique_ptrreader (formatManager.createReaderFor (file))；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (reader != nullptr)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                auto duration = (float) reader-&gt;lengthInSamples / reader-&gt;sampleRate；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (duration &lt; 2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    ReferenceCountedBuffer::Ptr newBuffer = new ReferenceCountedBuffer (file.getFileName()、</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                                                        (int) reader-&gt;numChannels、</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                                                        (int) reader-&gt;lengthInSamples)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    reader-&gt;read (newBuffer-&gt;getAudioSampleBuffer(), 0, (int) reader-&gt;lengthInSamples, 0, true, true)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        const juce::SpinLock::ScopedLockType lock (mutex)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        currentBuffer = newBuffer；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    buffers.add (newBuffer)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                その他</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    // ファイルが2秒以上あるというエラーを処理する。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>以下はその違いである：</p>
<ul>
<li>Allocate a new instance of our <code>リファレンスカウントバッファー</code> class.</li>
<li>Read the audio data into the <a href="/juce-tutorial-ja/audio/tutorial_looping_audio_sample_buffer_advanced/group__juce__audio__basics-buffers.html/#gab339ebab0d3b10c91c0d47c8fd2e50d2">オーディオサンプルバッファ</a> object that it contains.</li>
<li>現在のバッファにする。</li>
<li>これをバッファの配列に追加する。</li>
</ul>
<p>To clear the current buffer we can just set its value to <code>ヌルプトル</code>:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">void clearButtonClicked()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        const juce::SpinLock::ScopedLockType lock (mutex)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        currentBuffer = nullptr；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="playing-the-buffer">Playing the buffer<a href="#playing-the-buffer" class="hash-link" aria-label="Playing the buffer への直接リンク" title="Playing the buffer への直接リンク">​</a></h2>
<p>Our <code>getNextAudioBlock()</code> function is similar to the <code>getNextAudioBlock()</code> function from <a href="/juce-tutorial-ja/audio/tutorial_looping_audio_sample_buffer/">チュートリアルAudioSampleBufferクラスを使ったオーディオのループ再生</a> except we need to access our current <code>リファレンスカウントバッファー</code> object and the <a href="/juce-tutorial-ja/audio/tutorial_looping_audio_sample_buffer_advanced/group__juce__audio__basics-buffers.html/#gab339ebab0d3b10c91c0d47c8fd2e50d2">オーディオサンプルバッファ</a> object it contains.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">void getNextAudioBlock (const juce::AudioSourceChannelInfo&amp; bufferToFill) override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auto retainedCurrentBuffer = [&amp;]() -&gt; ReferenceCountedBuffer::Ptr // [4].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            const juce::SpinLock::ScopedTryLockType ロック (mutex)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (lock.isLocked())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return currentBuffer；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return nullptr；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (retainedCurrentBuffer == nullptr) // [5].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            bufferToFill.clearActiveBufferRegion()；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            を返します；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auto* currentAudioSampleBuffer = retainedCurrentBuffer-&gt;getAudioSampleBuffer(); // [6].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auto position = retainedCurrentBuffer-&gt;position; // [7].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auto numInputChannels = currentAudioSampleBuffer-&gt;getNumChannels()；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auto numOutputChannels = bufferToFill.buffer-&gt;getNumChannels()；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auto outputSamplesRemaining = bufferToFill.numSamples；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auto outputSamplesOffset = 0；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        while (outputSamplesRemaining &gt; 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            auto bufferSamplesRemaining = currentAudioSampleBuffer-&gt;getNumSamples() - position；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            auto samplesThisTime = juce::jmin (outputSamplesRemaining, bufferSamplesRemaining)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            for (auto channel = 0; channel &lt; numOutputChannels; ++channel)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                bufferToFill.buffer-&gt;copyFrom (channel、</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                               bufferToFill.startSample + outputSamplesOffset、</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                               *currentAudioSampleBuffer、</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                               channel % numInputChannels、</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                               position、</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                               samplesThisTime)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            outputSamplesRemaining -= samplesThisTime；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            outputSamplesOffset += samplesThisTime；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            position += samplesThisTime；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (position == currentAudioSampleBuffer-&gt;getNumSamples())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                position = 0；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        retainedCurrentBuffer-&gt;position = position; // [8].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>重要な変更点は以下の通りだ：</p>
<ul>
<li>[4]: We retain a copy of the <code>カレントバッファ</code> member. After this point in the function it doesn&#x27;t matter if the <code>カレントバッファ</code> member is changed on another thread since we have taken a local copy. Note that we use a try lock here, so that the audio thread doesn&#x27;t get stuck waiting to access the <code>カレントバッファ</code> in the case that another thread is currently modifying it.</li>
<li>[5]: We output silence if the <code>カレントバッファ</code> member was null when we took a copy.</li>
<li>[6]: We access the <a href="/juce-tutorial-ja/audio/tutorial_looping_audio_sample_buffer_advanced/group__juce__audio__basics-buffers.html/#gab339ebab0d3b10c91c0d47c8fd2e50d2">オーディオサンプルバッファ</a> object within the <code>リファレンスカウントバッファー</code> object.</li>
<li>[7]: We get the current playback position for the buffer.</li>
<li>[8]: After modifying the current playback position, we store it back in the <code>リファレンスカウントバッファー</code> object.</li>
</ul>
<p>This algorithm ensures that <code>リファレンスカウントバッファー</code> objects aren&#x27;t deleted on the the audio thread. It is not a good idea to allocate or free memory on the audio thread. The <code>リファレンスカウントバッファー</code> objects will only be deleted on our background thread.</p>
<h1>Reading the audio on the background thread</h1>
<p>私たちのアプリケーションは、依然としてメッセージスレッドでオーディオデータを読み込んでいます。メッセージスレッドがブロックされ、大きなファイルはロードに時間がかかる可能性があるため、これは理想的ではありません。実際、バックグラウンドスレッドを使ってこのタスクを実行することもできます。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="passing-the-file-path-to-the-background-thread">Passing the file path to the background thread<a href="#passing-the-file-path-to-the-background-thread" class="hash-link" aria-label="Passing the file path to the background thread への直接リンク" title="Passing the file path to the background thread への直接リンク">​</a></h2>
<p>First, add the following member to the <code>メインコンテンツコンポーネント</code> class:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">juce::CriticalSection pathMutex；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    juce::String chosenPath；</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now change the <code>openButtonClicked()</code> function to <em>スワップ</em> the full path of the file into this member. Swapping strings is not technically thread-safe, so we also need to take a lock to ensure that no other threads try to modify <code>chosenPath</code> while this thread is using it.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    void openButtonClicked()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        chooser = std::make_unique(&quot;Select a Wave file shorter than 2 seconds to play...&quot;、</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                       juce::File{}、</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                       &quot;*.wav&quot;)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auto chooserFlags = juce::FileBrowserComponent::openMode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          | juce::FileBrowserComponent::canSelectFiles；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        chooser-&gt;launchAsync (chooserFlags, [this] (const juce::FileChooser&amp; fc))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            auto file = fc.getResult()；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (file == juce::File{})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                を返します；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            auto path = file.getFullPathName()；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                const juce::ScopedLock lock (pathMutex)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                chosenPath.swapWith (path)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            notify()；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>ここでは、ファイルを開くためにバックグラウンド・スレッドで関数を呼び出すので、バックグラウンド・スレッドもウェイクアップする。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="accessing-the-path-from-the-background-thread">Accessing the path from the background thread<a href="#accessing-the-path-from-the-background-thread" class="hash-link" aria-label="Accessing the path from the background thread への直接リンク" title="Accessing the path from the background thread への直接リンク">​</a></h2>
<p>Our <code>実行()</code> function should be updated as follows:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">void run() オーバーライド</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        while (! threadShouldExit())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            checkForPathToOpen()；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            checkForBuffersToFree()；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            wait (500)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <code>checkForPathToOpen()</code> function checks the <code>chosenPath</code> member by swapping it into a local variable. Again, swapping is not thread-safe, so we must take a lock before accessing <code>chosenPath</code>.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    void checkForPathToOpen()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        juce::String pathToOpen;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            const juce::ScopedLock lock (pathMutex);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            pathToOpen.swapWith (chosenPath);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (pathToOpen.isNotEmpty())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            juce::File file (pathToOpen);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            std::unique_ptrreader (formatManager.createReaderFor (file))；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (reader.get() != nullptr)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                auto duration = (float) reader-&gt;lengthInSamples / reader-&gt;sampleRate；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (duration &lt; 2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    ReferenceCountedBuffer::Ptr newBuffer = new ReferenceCountedBuffer (file.getFileName()、</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                                                        (int) reader-&gt;numChannels、</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                                                        (int) reader-&gt;lengthInSamples)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    reader-&gt;read (newBuffer-&gt;getAudioSampleBuffer(), 0, (int) reader-&gt;lengthInSamples, 0, true, true)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        const juce::SpinLock::ScopedLockType lock (mutex)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        currentBuffer = newBuffer；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    buffers.add (newBuffer)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                その他</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    // ファイルが2秒以上あるというエラーを処理する。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If the <code>パスを開く</code> variable is an empty string then we know there isn&#x27;t a new file to open. The remainder of the code in this function should be familiar to you.</p>
<p>アプリケーションを再度実行すれば、正しく機能するはずです。</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>注記</div><div class="admonitionContent_BuS1"><p>The final code for this section can be found in the <code>LoopingAudioSampleBufferAdvancedTutorial_02.h</code> file of the demo project.</p></div></div>
<h1>Summary</h1>
<p>このチュートリアルでは、特にオーディオアプリケーションにおいて、スレッド間でデータを受け渡すための便利なテクニックを紹介しました。このチュートリアルを読めば、以下のことができるようになるでしょう：</p>
<ul>
<li>Implement a subclass of the <a href="https://docs.juce.com/master/classReferenceCountedObject" target="_blank" rel="noopener noreferrer" title="A base class which provides methods for reference-counting.">参照カウントオブジェクト</a> class.</li>
<li>Maintain the lifetime of a <a href="https://docs.juce.com/master/classReferenceCountedObject" target="_blank" rel="noopener noreferrer" title="A base class which provides methods for reference-counting.">参照カウントオブジェクト</a> in a multi-threaded application.</li>
<li>不要になったオブジェクトの削除や、ファイルの読み取り操作などのタスクを実行するバックグラウンド・スレッドを実装する。</li>
</ul>
<h1>See also</h1>
<ul>
<li><a href="/juce-tutorial-ja/audio/tutorial_playing_sound_files/">チュートリアルオーディオプレーヤーの構築</a></li>
<li><a href="/juce-tutorial-ja/audio/tutorial_processing_audio_input/">チュートリアルオーディオ入力を処理する</a></li>
<li><a href="/juce-tutorial-ja/audio/tutorial_audio_thumbnail/">チュートリアルオーディオ波形を描く</a></li>
<li><a href="/juce-tutorial-ja/audio/tutorial_looping_audio_sample_buffer/">チュートリアルAudioSampleBufferクラスを使ったオーディオのループ再生</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/m1m0zzz/juce-tutorial-ja/tree/main/docs/audio/tutorial_looping_audio_sample_buffer_advanced.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>このページを編集</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="ドキュメントページ"><a class="pagination-nav__link pagination-nav__link--prev" href="/juce-tutorial-ja/audio/tutorial_looping_audio_sample_buffer/"><div class="pagination-nav__sublabel">前へ</div><div class="pagination-nav__label">AudioSampleBufferクラスを使ったオーディオのループ再生</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/juce-tutorial-ja/audio/tutorial_audio_thumbnail/"><div class="pagination-nav__sublabel">次へ</div><div class="pagination-nav__label">オーディオ波形を描く</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#reference-counted-objects" class="table-of-contents__link toc-highlight">Reference-counted objects</a></li><li><a href="#implementing-the-background-thread" class="table-of-contents__link toc-highlight">Implementing the background thread</a></li><li><a href="#opening-the-file" class="table-of-contents__link toc-highlight">Opening the file</a></li><li><a href="#playing-the-buffer" class="table-of-contents__link toc-highlight">Playing the buffer</a></li><li><a href="#passing-the-file-path-to-the-background-thread" class="table-of-contents__link toc-highlight">Passing the file path to the background thread</a></li><li><a href="#accessing-the-path-from-the-background-thread" class="table-of-contents__link toc-highlight">Accessing the path from the background thread</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Tutorial</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/juce-tutorial-ja/category/getting-started/">Getting Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">JUCE</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://juce.com/learn/tutorials/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Tutorials<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://juce.com/learn/documentation/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Documentation<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://forum.juce.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/m1m0zzz/juce-tutorial-ja" target="_blank" rel="noopener noreferrer" class="footer__link-item">repo<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/juce-framework/JUCE" target="_blank" rel="noopener noreferrer" class="footer__link-item">JUCE GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">© 2024 Raw Material Software Limited. translation: mimoz</div></div></div></footer></div>
</body>
</html>