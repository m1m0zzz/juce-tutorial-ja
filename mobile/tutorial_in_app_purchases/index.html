<!doctype html>
<html lang="ja" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-mobile/tutorial_in_app_purchases" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">デスクトップおよびモバイルデバイスでのアプリ内課金 | JUCE日本語版チュートリアル</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://m1m0zzz.github.io/juce-tutorial-ja/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://m1m0zzz.github.io/juce-tutorial-ja/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://m1m0zzz.github.io/juce-tutorial-ja/mobile/tutorial_in_app_purchases/"><meta data-rh="true" property="og:locale" content="ja"><meta data-rh="true" name="docusaurus_locale" content="ja"><meta data-rh="true" name="docsearch:language" content="ja"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="デスクトップおよびモバイルデバイスでのアプリ内課金 | JUCE日本語版チュートリアル"><meta data-rh="true" name="description" content="デスクトップアプリケーションとモバイルアプリケーションで、消耗品と非消耗品のアプリ内課金を販売できます。macOS/iOSとAndroidデバイスの両方で、IAP製品のセットアップと支払い処理方法をご紹介します。"><meta data-rh="true" property="og:description" content="デスクトップアプリケーションとモバイルアプリケーションで、消耗品と非消耗品のアプリ内課金を販売できます。macOS/iOSとAndroidデバイスの両方で、IAP製品のセットアップと支払い処理方法をご紹介します。"><link data-rh="true" rel="icon" href="/juce-tutorial-ja/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://m1m0zzz.github.io/juce-tutorial-ja/mobile/tutorial_in_app_purchases/"><link data-rh="true" rel="alternate" href="https://m1m0zzz.github.io/juce-tutorial-ja/mobile/tutorial_in_app_purchases/" hreflang="ja"><link data-rh="true" rel="alternate" href="https://m1m0zzz.github.io/juce-tutorial-ja/mobile/tutorial_in_app_purchases/" hreflang="x-default"><link rel="stylesheet" href="/juce-tutorial-ja/assets/css/styles.ee4ac6b4.css">
<script src="/juce-tutorial-ja/assets/js/runtime~main.2c1dcd22.js" defer="defer"></script>
<script src="/juce-tutorial-ja/assets/js/main.cf826c6e.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="メインコンテンツまでスキップ"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">メインコンテンツまでスキップ</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/juce-tutorial-ja/"><div class="navbar__logo"><img src="/juce-tutorial-ja/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/juce-tutorial-ja/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">JUCE日本語版チュートリアル</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/juce-tutorial-ja/">Tutorial</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/m1m0zzz/juce-tutorial-ja" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="ダークモードを切り替える(現在はライトモード)" aria-label="ダークモードを切り替える(現在はライトモード)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="先頭へ戻る" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/juce-tutorial-ja/">About / このサイトについて</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/juce-tutorial-ja/category/getting-started/">Getting Started</a><button aria-label="Expand sidebar category &#x27;Getting Started&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/juce-tutorial-ja/category/audio/">Audio</a><button aria-label="Expand sidebar category &#x27;Audio&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/juce-tutorial-ja/category/synth/">Synth</a><button aria-label="Expand sidebar category &#x27;Synth&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/juce-tutorial-ja/category/midi/">MIDI</a><button aria-label="Expand sidebar category &#x27;MIDI&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/juce-tutorial-ja/category/plugins/">Plugins</a><button aria-label="Expand sidebar category &#x27;Plugins&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/juce-tutorial-ja/category/dsp/">DSP</a><button aria-label="Expand sidebar category &#x27;DSP&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/juce-tutorial-ja/category/graphics/">Graphics</a><button aria-label="Expand sidebar category &#x27;Graphics&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/juce-tutorial-ja/category/interface-design/">Interface Design</a><button aria-label="Expand sidebar category &#x27;Interface Design&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/juce-tutorial-ja/category/mobile/">Mobile</a><button aria-label="Collapse sidebar category &#x27;Mobile&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/juce-tutorial-ja/mobile/tutorial_android_studio/">アンドロイド入門</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/juce-tutorial-ja/mobile/tutorial_android_screen_sizes/">アンドロイドの画面サイズの管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/juce-tutorial-ja/mobile/tutorial_new_projucer_project/">デスクトップおよびモバイルデバイスでのアプリ内課金</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/juce-tutorial-ja/mobile/tutorial_in_app_purchases/">デスクトップおよびモバイルデバイス でのアプリ内課金</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/juce-tutorial-ja/category/utility-classes/">Utility Classes</a><button aria-label="Expand sidebar category &#x27;Utility Classes&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="パンくずリストのナビゲーション"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="ホームページ" class="breadcrumbs__link" href="/juce-tutorial-ja/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/juce-tutorial-ja/category/mobile/"><span itemprop="name">Mobile</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">デスクトップおよびモバイルデバイスでのアプリ内課金</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">この ページの見出し</button></div><div class="theme-doc-markdown markdown"><h1>チュートリアルデスクトップとモバイルデバイスでのアプリ内課金</h1>
<p>デスクトップアプリケーションとモバイルアプリケーションで、消耗品と非消耗品のアプリ内課金を販売できます。macOS/iOSとAndroidデバイスの両方で、IAP製品のセットアップと支払い処理方法をご紹介します。</p>
<p>レベル Advanced</p>
<p>プラットフォーム macOS, iOS, Android</p>
<p>クラス： <a href="https://docs.juce.com/master/structInAppPurchases_1_1Listener" target="_blank" rel="noopener noreferrer" title="Represents an object that gets notified about events such as product info returned or product purchas...">InAppPurchases::リスナー</a>, <a href="https://docs.juce.com/master/classSoundPlayer" target="_blank" rel="noopener noreferrer" title="A simple sound player that you can add to the AudioDeviceManager to play simple sounds.">サウンドプレーヤー</a>, <a href="https://docs.juce.com/master/classAsyncUpdater" target="_blank" rel="noopener noreferrer" title="Has a callback method that is triggered asynchronously.">非同期アップデーター</a>, <a href="https://docs.juce.com/master/classListBoxModel" target="_blank" rel="noopener noreferrer" title="A subclass of this is used to drive a ListBox.">リストボックスモデル</a></p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>警告</div><div class="admonitionContent_BuS1"><p>This project requires Apple Developer and iTunes Connect accounts on macOS/iOS and a Google Play Developer account on Android. If you need help with this, follow the instructions on the <a href="https://developer.apple.com/account/" target="_blank" rel="noopener noreferrer">アップル開発者</a>, <a href="https://itunesconnect.apple.com" target="_blank" rel="noopener noreferrer">iTunes Connect</a> and <a href="https://play.google.com/apps/publish/" target="_blank" rel="noopener noreferrer">Google Playデベロッパー</a> websites to open up these accounts.</p><p>シミュレーターはIAPテストをサポートしていないため、このプロジェクトではアプリ内課金をテストするために物理的なデバイスが必要です。このためにデバイスを用意してください。</p></div></div>
<h1>Getting started</h1>
<p>Download the demo project for this tutorial here: <a href="/juce-tutorial-ja/tutorials/PIPs/InAppPurchaseTutorial.zip/">ピップ</a> | <a href="/juce-tutorial-ja/tutorials/ZIPs/InAppPurchaseTutorial.zip/">ジップ</a>. Unzip the project and open the first header file in the Projucer.</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>警告</div><div class="admonitionContent_BuS1"><p>If using the PIP version of this project, please make sure to copy the <code>リソース</code> folder into the generated Projucer project.</p></div></div>
<p>If you need help with this step, see <a href="/juce-tutorial-ja/mobile/tutorial_new_projucer_project/">チュートリアルProjucerパート1：Projucerを始める</a>.</p>
<h1>The demo project</h1>
<p>このプロジェクトでは、音声ディクテーション  を使用してフレーズを再生する際に、いくつかの聴覚的なフレーバーを提供するために、アプリ内課金で取得できるさまざまな音声を提供しています。デフォルトでは、ユーザーは一般的なロボット音声を利用できますが、必然的にJUCE開発者の音声を試したくなります。iOSシミュレータでモバイル・アプリケーションを実行すると、ウィンドウは次のようになります：</p>
<figure><img src="https://docs.juce.com/master/tutorial_in_app_purchases_screenshot1.png" alt="The demo project app window on iOS"><figcaption><b>The demo project app window on iOS</b></figcaption></figure>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>注記</div><div class="admonitionContent_BuS1"><p>アプリケーションはシミュレータで実行されているので、商品がグレーアウトし、価格が無期限にフェッチされるのは予想された動作です。</p><div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>警告</div><div class="admonitionContent_BuS1"><p>これはチュートリアル・プロジェクトですが、サンドボックス・モードかテスト・ユーザーとしてログインしていない限り、商品を購入しようとするとクレジットカードに課金されます！</p><div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>注記</div><div class="admonitionContent_BuS1"><p>The code presented here is broadly similar to the <strong>アプリ内購入</strong> from the JUCE Examples.</p></div></div></div></div></div></div>
<h1>Initial Setup</h1>
<p>In order for this project to function properly, we have to perform some initial setup procedures with appropriate developer consoles for specific deployment platform. Let&#x27;s first allow appropriate permissions for in-app purchases in the Projucer. Under macOS/iOS, make sure that the <strong>アプリ内課金機能</strong> checkbox is ticked. Under Android, make sure that the <strong>アプリ内課金</strong> checkbox is ticked.</p>
<figure><img src="https://docs.juce.com/master/tutorial_in_app_purchases_screenshot2_android.png" alt="Project settings window on iOS](tutorial_in_app_purchases_screenshot2_ios.png) ![Project settings window on Android"><figcaption><b>Project settings window on iOS](tutorial_in_app_purchases_screenshot2_ios.png) ![Project settings window on Android</b></figcaption></figure>
<p>プロジェクトを保存してお気に入りのIDEで開くと、Projucerが自動的に必要なエンタイトルメントをデプロイメント・ターゲットに追加します。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="apple-developer">Apple Developer<a href="#apple-developer" class="hash-link" aria-label="Apple Developer への直接リンク" title="Apple Developer への直接リンク">​</a></h2>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>注記</div><div class="admonitionContent_BuS1"><p>If developing for Android, please skip to the next section <a href="#tutorial_in_app_purchases_initial_setup_google_play_developer">Google Playデベロッパー</a> for instructions.</p></div></div>
<p>macOS と iOS では、アプリケーションに署名するために、Xcode 内の Apple Developer アカウントでサインインし、開発チームを選択する必要があります。あなたのプロジェクトのためのユニークなバンドル ID を選択します。以下のスクリーンショットのように、Xcode は自動的に署名証明書と Provisioning Profile を提供します：</p>
<figure><img src="https://docs.juce.com/master/tutorial_in_app_purchases_screenshot3.png" alt="General settings window in Xcode"><figcaption><b>General settings window in Xcode</b></figcaption></figure>
<p>Also make sure that the correct app capabilities have been ticked and approved in the <strong>能力</strong> settings window. You should see the same information as follows:</p>
<figure><img src="https://docs.juce.com/master/tutorial_in_app_purchases_screenshot4.png" alt="Capabilities settings window in Xcode"><figcaption><b>Capabilities settings window in Xcode</b></figcaption></figure>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="itunes-connect">iTunes Connect<a href="#itunes-connect" class="hash-link" aria-label="iTunes Connect への直接リンク" title="iTunes Connect への直接リンク">​</a></h2>
<p>For the in-app purchases to display properly on iOS, we need to create IAP products in iTunes Connect. First, create a new app in your dashboard under <strong>私のアプリ</strong>. If you navigate to the <strong>特徴</strong> tab of your app, you can access the <strong>アプリ内課金</strong> feature on the following screen:</p>
<figure><img src="https://docs.juce.com/master/tutorial_in_app_purchases_screenshot5.png" alt="Create IAP products in iTunes Connect"><figcaption><b>Create IAP products in iTunes Connect</b></figcaption></figure>
<p>Click on the <strong>+</strong> sign to create six products that correspond with the options in the app with appropriate names and prices.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="google-play-developer">Google Play Developer<a href="#google-play-developer" class="hash-link" aria-label="Google Play Developer への直接リンク" title="Google Play Developer への直接リンク">​</a></h2>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>注記</div><div class="admonitionContent_BuS1"><p>If developing for macOS/iOS, please jump to the previous section <a href="#tutorial_in_app_purchases_initial_setup_apple_developer">アップル開発者</a> for instructions.</p></div></div>
<p>For the in-app purchases to display properly on Android, we need to create in-app billing products in the Google Play Console. First, navigate to your app page from the <strong>すべてのアプリケーション</strong> panel and open up the <strong>アプリ内商品</strong> page under <strong>店舗プレゼンス</strong>. You can access the items under the <strong>マネージド製品</strong> tab as shown on the following screen:</p>
<figure><img src="https://docs.juce.com/master/tutorial_in_app_purchases_screenshot6.png" alt="Create IAB products in the Google Play Console"><figcaption><b>Create IAB products in the Google Play Console</b></figcaption></figure>
<p>Click on <strong>マネージド製品を作る</strong> to create six products that correspond with the options in the app with appropriate names and prices.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>注記</div><div class="admonitionContent_BuS1"><p>Google PlayのプロダクトIDに関する制限により、プロダクトIDには数字（0～9）、小文字（a～z）、アンダースコア（_）、またはフルストップ（.)のみを使用することをお勧めします。こうすることで、AppStoreとPlayStoreの両方で同じプロダクトIDを使用することができます。そうしないと、アプリは同じ商品でも異なる商品IDを扱わなければならなくなります。</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="generate-android-apk">Generate Android APK<a href="#generate-android-apk" class="hash-link" aria-label="Generate Android APK への直接リンク" title="Generate Android APK への直接リンク">​</a></h2>
<p>In order for in-app purchases to function properly on Android, we have to sign the Android version of the app and authenticate the requests to the Google Play store API. First launch Android Studio and navigate to the menu bar under <strong>ビルド &gt; 署名付きAPKの生成...</strong>:</p>
<figure><img src="https://docs.juce.com/master/tutorial_in_app_purchases_screenshot7.png" alt="Generate signed APK from menu bar"><figcaption><b>Generate signed APK from menu bar</b></figcaption></figure>
<p>その後、キーストア・ファイルの場所、エイリアス、パスワードを入力するようプロンプトが表示されるので、以下のように入力する：</p>
<figure><img src="https://docs.juce.com/master/tutorial_in_app_purchases_screenshot8.png" alt="Enter aliases and passwords for keystore file"><figcaption><b>Enter aliases and passwords for keystore file</b></figcaption></figure>
<p>次に、リリースビルドタイプの &quot;release_&quot;フレーバーを選択し、V1とV2の両方の署名がチェックされていることを確認する。</p>
<figure><img src="https://docs.juce.com/master/tutorial_in_app_purchases_screenshot9.png" alt="Build type, flavours and signature versions"><figcaption><b>Build type, flavours and signature versions</b></figcaption></figure>
<p>This will generate the keystore file that you can now refer to in the Projucer. Under the Android release settings, enter the relative path, alias and passwords to the keystore file in the <strong>キー・サイン</strong> fields:</p>
<figure><img src="https://docs.juce.com/master/tutorial_in_app_purchases_screenshot10.png" alt="Path for keystore file in release settings"><figcaption><b>Path for keystore file in release settings</b></figcaption></figure>
<p>アプリ内購入のセットアップはもう完了しているはずで、ようやくアプリにこれらの機能を実装し始めることができる。</p>
<h1>Purchase Types</h1>
<p>アプリ内課金は、アプリ内で直接顧客に追加コンテンツや機能を提供するのに便利です。プレミアム機能、限定アイテム、あるいはサブスクリプションなどがあります。一般的に、すべての関連プラットフォームで4つの主要なタイプの購入があります：</p>
<ul>
<li>消耗品：複数回使用・購入可能なアイテム。</li>
<li>非消耗品：アプリの機能を永続的にアンロックする1回限りの購入。</li>
<li>自動更新サブスクリプション：定期的に更新されるコンテンツを、解約するまで定期的にお届けします。</li>
<li>更新されないサブスクリプション：手動更新が必要な期間限定コンテンツ。</li>
</ul>
<p>このチュートリアルでは、非消費型のアプリ内課金を実装します。</p>
<h1>Project structure</h1>
<p>プロジェクトは、アプリケーションのさまざまな  部分を処理するために、以下のクラスを使用して構成されています：</p>
<ul>
<li>MainContentComponent：画面上にGUIコンポーネントをレイアウトし、再生/停止ボタンクリック時のサウンドファイルの再生を処理する。</li>
<li>PhraseModel: <a href="https://docs.juce.com/master/classListBoxModel" target="_blank" rel="noopener noreferrer" title="A subclass of this is used to drive a ListBox.">リストボックスモデル</a> to describe available phrases to play using purchased voices.</li>
<li>VoiceModel: <a href="https://docs.juce.com/master/classListBoxModel" target="_blank" rel="noopener noreferrer" title="A subclass of this is used to drive a ListBox.">リストボックスモデル</a> to describe available voices that can be purchased to play phrases with.</li>
<li>VoiceRow: Custom row <a href="https://docs.juce.com/master/classComponent" target="_blank" rel="noopener noreferrer" title="The base class for all JUCE user-interface objects.">コンポーネント</a> for the VoiceModel class to display pictures and information for specific voice entries.</li>
<li>VoicePurchases: Class to manage VoiceProduct purchases that handles purchases and encapsulates the <a href="https://docs.juce.com/master/classInAppPurchases" target="_blank" rel="noopener noreferrer" title="Provides in-app purchase functionality.">アプリ内課金</a> instance.</li>
<li>VoiceProduct：価格、名前、以前に購入したかどうかなどの情報を含む、単一の購入可能な製品を記述するための構造。</li>
</ul>
<p>As we can see, it roughly follows an <a href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller" target="_blank" rel="noopener noreferrer">車々間通信</a> design pattern to separate application functionalities into separate classes.</p>
<p>VoiceProduct 構造体には、消耗品以外の製品に役立つ情報、つまり以下の変数が含まれています：</p>
<ul>
<li>const char* identifier：iTunes ConnectやGoogle Playから参照される一意の識別子。</li>
<li>const char* humanReadable：アプリに表示する、人間が読めるバージョンの識別子。</li>
<li>bool isPurchased：ログインしているユーザがそのアイテムを購入したことがあるかどうか。</li>
<li>bool priceIsKnown：価格が読み込まれ、表示されるように取得されているかどうか。</li>
<li>bool purchaseInProgress：ユーザーが現在進行中の購入を開始したかどうか。</li>
<li><a href="https://docs.juce.com/master/classString" target="_blank" rel="noopener noreferrer" title="The JUCE String class!">ストリング</a> purchasePrice: A localised string that displays the product price in the local currency.</li>
</ul>
<p>消耗品の購入にはどのような情報が必要だろうか？定期購入についてはどうだろう？何が追加されるべきか、何が削除されるべきかを考えよう。</p>
<h1>Displaying products</h1>
<p>Let&#x27;s start by displaying the IAP products that we want to sell in the user interface. In the VoicePurchases constructor of the <code>ボイス購入</code> class, we have initialised the VoiceProduct objects using the structure described above like so:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    VoicePurchases()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        voiceProducts = juce::Array(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        {VoiceProduct {&quot;robot&quot;, &quot;Robot&quot;, true, true, false, &quot;Free&quot; }、</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          VoiceProduct {&quot;jules&quot;, &quot;Jules&quot;, false, false, false, &quot;価格を取得しています。&quot;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          VoiceProduct {&quot;fabian&quot;, &quot;Fabian&quot;, false, false, false, &quot;価格検索中...&quot; }, VoiceProduct {&quot;fabian&quot;, &quot;Fabian&quot;, false, false, false, &quot;価格検索中...&quot;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          VoiceProduct {&quot;ed&quot;, &quot;Ed&quot;, false, false, false, &quot;価格検索中...&quot;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          VoiceProduct {&quot;lukasz&quot;, &quot;Lukasz&quot;, false, false, false, &quot;価格検索中...&quot; }, VoiceProduct {&quot;lukasz&quot;, &quot;Lukasz&quot;, false, false, false, &quot;価格検索中...&quot;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          VoiceProduct {&quot;jb&quot;, &quot;JB&quot;, false, false, false, &quot;価格検索中...&quot; }, VoiceProduct {&quot;jb&quot;, &quot;JB&quot;, false, false, false, &quot;価格検索中...&quot;}});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>警告</div><div class="admonitionContent_BuS1"><p>これらのプロダクトIDは、iTunes ConnectやGoogle Play Consoleの値と正確に一致しなければ正しく動作しません。</p></div></div>
<p>In order to easily retrieve human-readable versions of all our products, we have implemented a helper function that returns a <a href="https://docs.juce.com/master/classStringArray" target="_blank" rel="noopener noreferrer" title="A special array for holding a list of strings.">文字列配列</a> of all capitalised names:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">juce::StringArray getVoiceNames() const</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        juce::StringArray names；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (auto&amp; voiceProduct : voiceProducts)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            names.add (voiceProduct.humanReadable)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        names を返します；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Let&#x27;s create another helper function in the same class called <code>findVoiceIndexFromIdentifier()</code> to get the index of a VoiceProduct when passed an identifier. This private function will be helpful later on when dealing with callbacks from the <a href="https://docs.juce.com/master/classInAppPurchases" target="_blank" rel="noopener noreferrer" title="Provides in-app purchase functionality.">アプリ内課金</a> object:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">int findVoiceIndexFromIdentifier (juce::String identifier) const</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        identifier = identifier.toLowerCase()；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (auto i = 0; i &lt; voiceProducts.size(); ++i)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (juce::String (voiceProducts.getReference (i).identifier) == identifier)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return i；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return -1；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <a href="https://docs.juce.com/master/classInAppPurchases" target="_blank" rel="noopener noreferrer" title="Provides in-app purchase functionality.">アプリ内課金</a> class works as a broadcaster so let&#x27;s inherit from <a href="https://docs.juce.com/master/structInAppPurchases_1_1Listener" target="_blank" rel="noopener noreferrer" title="Represents an object that gets notified about events such as product info returned or product purchas...">InAppPurchases::リスナー</a> to become a listener for this class and receive callbacks from the IAP server [1]:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class VoicePurchases : private juce::InAppPurchases::Listener // [1].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public：</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We can now start overriding the <a href="https://docs.juce.com/master/classInAppPurchases" target="_blank" rel="noopener noreferrer" title="Provides in-app purchase functionality.">アプリ内課金</a> callback functions in our VoicePurchases class. First, implement the <code>productsInfoReturned()</code> function. This function gets called to return product information after a call to <a title="Asynchronously requests information for products with given ids." href="/juce-tutorial-ja/mobile/tutorial_in_app_purchases/classInAppPurchases.html/#aad53d0d034c19ad6cce54ec9e39e69b8">InAppPurchases::getProductsInformation()</a>.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    void productsInfoReturned (const juce::Array製品）オーバーライド</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (! juce::InAppPurchases::getInstance()-&gt;isInAppPurchasesSupported()) // [2].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            for (auto idx = 1; idx &lt; voiceProducts.size(); ++idx) // [3].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                auto&amp; voiceProduct = voiceProducts.getReference (idx)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                voiceProduct.isPurchased = false；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                voiceProduct.priceIsKnown = false；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                voiceProduct.purchasePrice = &quot;アプリ内購入は利用できません；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            juce::AlertWindow::showMessageBoxAsync (juce::AlertWindow::WarningIcon, // [4])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                    &quot;In-app purchase is unavailable!&quot;、</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                    &quot;アプリ内課金は利用できません。これは、&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                    &quot;これは、IAPをサポートしていないプラットフォームでIAPを使用しようとしているか、IAPで動作するようにアプリを正しくセットアップ&quot; &quot;していないことを意味します。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                    &quot;これは、IAPをサポートしていないプラットフォームでIAPを使用しようとしているか、IAPで動作するようにアプリを正しく設定&quot; &quot;していないかのどちらかです、</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                    &quot;OK&quot;)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            for (auto product : products)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                auto idx = findVoiceIndexFromIdentifier (product.identifier); // [5].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (juce::isPositiveAndBelow (idx, voiceProducts.size()))               // [6]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    auto&amp; voiceProduct = voiceProducts.getReference (idx)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    voiceProduct.priceIsKnown = true；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    voiceProduct.purchasePrice = product.price；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            juce::AlertWindow::showMessageBoxAsync (juce::AlertWindow::WarningIcon, // [7].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                    &quot;Your credit card will be charged!&quot;、</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                    &quot;You are running the sample code for JUCE In-App purchases.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                    &quot;これはサンプルコードに過ぎませんが、クレジットカードに課金されます！&quot;、</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                    &quot;わかりました！&quot;)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        guiUpdater.triggerAsyncUpdate()；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>[2]: First, check whether in-app purchases are supported on your platform and that setup was correctly performed.</li>
<li>[3]: For all VoiceProduct objects except the first free one, set their variables to reflect unavailability of products.</li>
<li>[4]: Optionally show a message box asynchronously to explain the issue to the user.</li>
<li>[5]: For all VoiceProduct objects if in-app purchases are available, retrieve the index from the identifier with the previously implemented helper function.</li>
<li>[6]: If the index is valid, set the product variables to reflect availability of the product.</li>
<li>[7]: Optionally show a message box asynchronously explaining that users will be charged.</li>
</ul>
<h1>Retrieving purchases</h1>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>警告</div><div class="admonitionContent_BuS1"><p>このセクションは物理的なデバイス上でのみ機能します。シミュレーターでは正しく機能しませんので、試さないでください。</p></div></div>
<p>アプリ内課金を扱う場合、アプリケーションが最初にチェックすべきなのは、ユーザーがサインインしたときに過去の購入履歴があるかどうかです。顧客として最もイライラすることの1つは、別のデバイスや同じアプリの以前のバージョンで購入したものを失うことです。そこで、アプリ起動時にできるだけ早く、ユーザーが商品ページの最新ビューを取得できるようにしましょう。</p>
<p>First, create additional private variables in the <code>ボイス購入</code> class to store temporary states of the app [1]:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    bool havePurchasesBeenRestored = false, havePricesBeenFetched = false, purchaseInProgress = false; // [1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    juce::Arrayボイスプロダクト</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    JUCE_DECLARE_NON_COPYABLE_WITH_LEAK_DETECTOR (VoicePurchases)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We also need a new helper function called <code>ゲットパーチェス()</code> to retrieve a VoiceProduct from an index. In this function, we also insert initialisation code for when this function is first called:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">VoiceProduct getPurchase (int voiceIndex)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (! havePurchasesBeenRestored)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            havePurchasesBeenRestored = true; // [2].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            juce::InAppPurchases::getInstance()-&gt;addListener (this); // [3].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            juce::InAppPurchases::getInstance()-&gt;restoreProductsBoughtList (true); // [4].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return voiceProducts[voiceIndex]; // [5].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>[2]: If this is the first time this function is called, make sure this code segment does not get called again.</li>
<li>[3]: Add this class as a listener to the <a href="https://docs.juce.com/master/classInAppPurchases" target="_blank" rel="noopener noreferrer" title="Provides in-app purchase functionality.">アプリ内課金</a> instance to receive callbacks.</li>
<li>[4]: We can then call the <code>restoreProductsBoughtList()</code> function to trigger the restoration process and wait for the subsequent callback.</li>
<li>[5]: Finally, return the VoiceProduct at the specified index. This will get called every time as normal behaviour for this function.</li>
</ul>
<p>Since the VoicePurchases class gets registered as a listener when the above function gets initially called, we need to make sure we unregister when this class gets destroyed. Remove the class as an <a href="https://docs.juce.com/master/classInAppPurchases" target="_blank" rel="noopener noreferrer" title="Provides in-app purchase functionality.">アプリ内課金</a> listener in the class destructor:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">~VoicePurchases() オーバーライド</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        juce::InAppPurchases::getInstance()-&gt;removeListener (this)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the previously defined <code>ゲットパーチェス()</code> function, we called the <code>restoreProductsBoughtList()</code> function to trigger a callback to restore our purchases. Now let&#x27;s implement that callback function called <code>購入リスト復元()</code>:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    void purchasesListRestored (const juce::Array&amp; infos, bool success, const juce::String&amp;) override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (success)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            for (auto&amp; info : infos)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                for (const auto&amp; productId : info.purchase.productIds)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    auto idx = findVoiceIndexFromIdentifier (productId); // [6].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    if (juce::isPositiveAndBelow (idx, voiceProducts.size()))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        auto&amp; voiceProduct = voiceProducts.getReference (idx); // [7].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        voiceProduct.isPurchased = true；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            guiUpdater.triggerAsyncUpdate()；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (! havePricesBeenFetched)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            havePricesBeenFetched = true; // [8].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            juce::StringArray識別子；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            for (auto&amp; voiceProduct : voiceProducts)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                identifiers.add (voiceProduct.identifier)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            juce::InAppPurchases::getInstance()-&gt;getProductsInformation (identifiers); // [9].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>[6]: If the response from the server is successful, we can update our purchase list. Using the helper function, find the index of the voice from the identifier.</li>
<li>[7]: If the index is valid, set the appropriate variables of the VoiceProduct object to reflect its purchase state.</li>
<li>[8]: When this callback function gets called the first time around, we need to initialise the purchase prices. Make sure this code segment does not get called a second time.</li>
<li>[9]: Initiate the request to retrieve product prices on the <a href="https://docs.juce.com/master/classInAppPurchases" target="_blank" rel="noopener noreferrer" title="Provides in-app purchase functionality.">アプリ内課金</a> instance by calling the <code>取得製品情報()</code> function.</li>
</ul>
<p>In order to update the GUI for these in-app purchases products, it would be useful to have temporary variables to store purchase states. Let&#x27;s declare these as private member variables in the VoiceRow subclass of the <code>ボイスモデル</code> class:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">bool isSelected = false, hasBeenPurchased = false, purchaseInProgress = false；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int rowSelected = -1；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        juce::画像アバター；</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>At the moment, all the in-app purchases products look visually the same and do not clearly indicate their availability in a visually-striking manner. Let&#x27;s apply a different look and feel to purchasable products. In the <code>ペイント</code> function, modify the code to apply a white background to the product image when available [10] and a white semi-transparent overlay when unavailable [11]:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">void paint (juce::Graphics&amp; g) override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            auto r = getLocalBounds().reduced (4)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                auto voiceIconBounds = r.removeFromLeft (r.getHeight())；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                g.setColour (juce::Colours::black)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                g.drawRect (voiceIconBounds)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                voiceIconBounds.reduce (1, 1)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                g.setColour (hasBeenPurchased ? juce::Colours::white : juce::Colours::grey); // [10].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                g.fillRect (voiceIconBounds)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                g.drawImage (avatar, voiceIconBounds.toFloat())；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (! hasBeenPurchased)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    g.setColour (juce::Colours::white.withAlpha (0.8f)); // [11].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    g.fillRect (voiceIconBounds)；</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Also modify the code in the <code>更新()</code> function to reflect purchase status on the name and price labels. Use the previously defined helper function to retrieve the VoiceProduct from the row index first [12] and set the temporary variable to indicate whether the item was purchased [13]. Then update the GUI accordingly as follows:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">void update (int rowNumber, bool rowIsSelected)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            isSelected = rowIsSelected；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            rowSelected = rowNumber；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (juce::isPositiveAndBelow (rowNumber, voices.size()))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                auto imageResourceName = voices[rowNumber] + &quot;.png&quot;；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                nameLabel.setText (voices[rowNumber], juce::NotificationType::dontSendNotification)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                auto purchase = purchases.getPurchase (rowNumber); // [12].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                hasBeenPurchased = purchase.isPurchased; // [13].</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if (rowNumber == 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    purchaseButton.setButtonText (&quot;Internal&quot;)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    purchaseButton.setEnabled (false)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    purchaseButton.setButtonText (hasBeenPurchased ? &quot;Purchased&quot; : &quot;Purchase&quot;)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    purchaseButton.setEnabled (! hasBeenPurchased &amp;&amp; purchase.priceIsKnown)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                setInterceptsMouseClicks (! hasBeenPurchased, ! hasBeenPurchased); // [14].</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this piece of code, we mainly update the font styles of the name and price labels to remain as default when the item is purchased and change its colour to white. In addition, we enable the purchase buttons if the corresponding product is available for purchase. We also need to disable mouse clicks on these buttons after purchase to avoid errors when charging the customer [14].</p>
<h1>Purchasing products</h1>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>警告</div><div class="admonitionContent_BuS1"><p>このセクションは物理的なデバイス上でのみ機能します。シミュレーターでは正しく機能しませんので、試さないでください。</p></div></div>
<p>We have yet to implement purchasing behaviour in our app so let&#x27;s do that. Implement a <code>purchaseVoice()</code> public function in the <code>ボイス購入</code> class that transfers the request to the <a href="https://docs.juce.com/master/classInAppPurchases" target="_blank" rel="noopener noreferrer" title="Provides in-app purchase functionality.">アプリ内課金</a> instance:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">void purchaseVoice (int voiceIndex)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (havePricesBeenFetched &amp;&amp; juce::isPositiveAndBelow (voiceIndex, voiceProducts.size()))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            auto&amp; product = voiceProducts.getReference (voiceIndex); // [1].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (! product.isPurchased)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                purchaseInProgress = true；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                product.purchaseInProgress = true; // [2].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                juce::InAppPurchases::getInstance()-&gt;purchaseProduct (product.identifier); // [3].</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>[1]: First check whether the prices were fetched before retrieving the VoiceProduct using the index.</li>
<li>[2]: If the product was not previously purchased, enter purchasing state by setting the appropriate variable.</li>
<li>[3]: We can now safely request the <a href="https://docs.juce.com/master/classInAppPurchases" target="_blank" rel="noopener noreferrer" title="Provides in-app purchase functionality.">アプリ内課金</a> instance to purchase the product by specifying the correct identifier.</li>
</ul>
<p>This will trigger a callback from the server when the purchasing has ended and a response was received. We implement this <code>商品購入完了()</code> callback here:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">void productPurchaseFinished (const PurchaseInfo&amp; info, bool success, const juce::String&amp;) override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        purchaseInProgress = false；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (const auto&amp; productId : info.purchase.productIds)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            auto idx = findVoiceIndexFromIdentifier (productId); // [4].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (juce::isPositiveAndBelow (idx, voiceProducts.size()))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                auto&amp; voiceProduct = voiceProducts.getReference (idx); // [5].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                voiceProduct.isPurchased = success；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                voiceProduct.purchaseInProgress = false；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 失敗した場合、Playストアはどの購入が失敗したかを教えてくれません。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                for (auto&amp; voiceProduct : voiceProducts)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    voiceProduct.purchaseInProgress = false；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        guiUpdater.triggerAsyncUpdate()；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Using the same helper function as before, retrieve the VoiceProduct index from its identifier [4] and set appropriate variables on the object in question depending on whether the purchase was successful and exit purchasing state [5].</p>
<p>To indicate the purchasing state to the user while waiting for the response from the server, display a spinning animation in the <code>ペイント</code> function of the <code>ボイスモデル</code> class [6]:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if (! hasBeenPurchased)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    g.setColour (juce::Colours::white.withAlpha (0.8f)); // [11].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    g.fillRect (voiceIconBounds)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    if (purchaseInProgress) // [6].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        getLookAndFeel().drawSpinningWaitAnimation (g, juce::Colours::darkgrey、</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                                    voiceIconBounds.getX()、</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                                    voiceIconBounds.getY()、</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                                    voiceIconBounds.getWidth()、</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                                    voiceIconBounds.getHeight())；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>ユーザーがUIとインタラクトしたときに購入プロセスを開始するために、clickPurchase()関数を実装してみましょう：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">void clickPurchase()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (rowSelected &gt;= 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (! hasBeenPurchased)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    purchases.purchaseVoice (rowSelected); // [7].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    purchaseInProgress = true；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    startTimer (1000 / 50); // [8].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        void timerCallback() override { repaint(); }.          // [9]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>[7]: If the row index is valid and the item was not purchased before, call the <code>purchaseVoice()</code> function and enter purchasing state.</li>
<li>[8]: Start a timer to update the spinning wheel animation while the purchase is in progress.</li>
<li>[9]: Implement the timer callback to repaint the screen for the animation.</li>
</ul>
<p>Lastly in the <code>更新()</code> function, retrieve the purchasing state for the row-specific product [10] and stop the spinning animation if the purchase is finished by calling the <code>stopTimer()</code> function [11]:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">purchaseInProgress = purchase.purchaseInProgress; // [10].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (purchaseInProgress)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    startTimer (1000 / 50)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    stopTimer(); // 【11</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>チュートリアルのこの時点で、商品の購入と商品情報の取得を処理する仕組みはすべて実装されていますが、GUIに更新のタイミングを指示する必要があります。</p>
<h1>Handling async updates</h1>
<p>Since purchases and synchronisation with the IAP server are performed on a separate thread, we need to handle responses in an asynchronous manner. In the <code>メインコンテンツコンポーネント</code> class, let&#x27;s inherit from the <a href="https://docs.juce.com/master/classAsyncUpdater" target="_blank" rel="noopener noreferrer" title="Has a callback method that is triggered asynchronously.">非同期アップデーター</a> class [1] and pass a reference of this class to the VoicePurchases instance [2]:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class MainContentComponent : public juce::Component、</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                             private juce::AsyncUpdater // [1].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">juce::SoundPlayer player；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    VoicePurchases purchases { *this }; // [2].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    juce::AudioDeviceManager dm；</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the VoicePurchases constructor and member initialisation list, assign a reference to the <a href="https://docs.juce.com/master/classAsyncUpdater" target="_blank" rel="noopener noreferrer" title="Has a callback method that is triggered asynchronously.">非同期アップデーター</a> instance in a private variable [3]:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">VoicePurchases (juce::AsyncUpdater&amp; asyncUpdater) // [3].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         : guiUpdater (asyncUpdater)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Declare that variable as a private member to be able to refer to the <a href="https://docs.juce.com/master/classAsyncUpdater" target="_blank" rel="noopener noreferrer" title="Has a callback method that is triggered asynchronously.">非同期アップデーター</a> later on [4]:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//==============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    juce::AsyncUpdater&amp; guiUpdater; // [4］</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now in the <code>purchaseVoice()</code> function and all the callback functions of the <a href="https://docs.juce.com/master/classInAppPurchases" target="_blank" rel="noopener noreferrer" title="Provides in-app purchase functionality.">アプリ内課金</a> instance namely <code>productsInfoReturned()</code>, <code>購入リスト復元()</code> and <code>商品購入完了()</code>, trigger an asynchronous update to the GUI as a last step to the corresponding code segments [5]:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">void purchaseVoice (int voiceIndex)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (havePricesBeenFetched &amp;&amp; juce::isPositiveAndBelow (voiceIndex, voiceProducts.size()))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (! product.isPurchased)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            guiUpdater.triggerAsyncUpdate();   // [5.1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void productsInfoReturned (const juce::Array&amp; products) override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    guiUpdater.triggerAsyncUpdate();           // [5.2]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void productPurchaseFinished (const PurchaseInfo&amp; info, bool success, const juce::String&amp;) override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    guiUpdater.triggerAsyncUpdate();           // [5.3]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void purchasesListRestored (const juce::Array&amp; infos, bool success, const juce::String&amp;) override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (success)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        guiUpdater.triggerAsyncUpdate(); // [5.4].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now whenever the <code>triggerAsyncUpdate()</code> function is called on the <a href="https://docs.juce.com/master/classAsyncUpdater" target="_blank" rel="noopener noreferrer" title="Has a callback method that is triggered asynchronously.">非同期アップデーター</a> instance in the VoicePurchases class, we can handle the callback in the <code>handleAsyncUpdate()</code> function to update any outdated GUI components [6]:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">void handleAsyncUpdate() オーバーライド</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        voiceListBox.updateContent()；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        voiceListBox.setEnabled (! purchases.isPurchaseInProgress())；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        voiceListBox.repaint()；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Add the following getter in the <code>ボイス購入</code> class as a public helper function:</p>
<p>これにより、購入が行われたり取得されたりするたびにGUIが更新されるようになります。アプリを再度起動すると、以前に購入したアプリ内課金が表示されるようになります。</p>
<p>ユーザーが特定の音声でフレーズを再生するたびにトークンを消費することで、これらのIAP製品の消費可能バージョンを実装します。</p>
<h1>Playing sounds</h1>
<p>When the user clicks on the play button, we need to trigger the correct audio file to play using the right voice and phrase. The audio files are stored as binary resources using the name of the voice and an index relating to the phrase number as a naming convention. In the <code>メインコンテンツコンポーネント</code> class, we handle the behaviour as follows:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">void playStopPhrase()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        juce::MemoryOutputStream resourceName；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auto idx = voiceListBox.getSelectedRow(); // [1].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (juce::isPositiveAndBelow (idx, soundNames.size()))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            resourceName &lt;&lt; soundNames[idx] &lt;&lt; phraseListBox.getSelectedRow() &lt;&lt; &quot;.ogg&quot;; // [2].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            auto dir = juce::File::getCurrentWorkingDirectory()；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            int numTries = 0；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            while (! dir.getChildFile (&quot;Resources&quot;).exists() &amp;&amp; numTries++ &lt; 15)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                dir = dir.getParentDirectory()；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            auto file = dir.getChildFile (&quot;Resources&quot;).getChildFile (&quot;Sounds&quot;).getChildFile (resourceName.toString().toRawUTF8())；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (file.exists())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                player.play (file); // [3].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>[1]: First, retrieve the index for the selected row in the voice table and check if the index is valid against the array of audio files.</li>
<li>[2]: Next, construct the correct file name using a <a href="https://docs.juce.com/master/classMemoryOutputStream" target="_blank" rel="noopener noreferrer" title="Writes data to an internal memory buffer, which grows as required.">メモリー出力ストリーム</a> object and the naming convention as described above.</li>
<li>[3]: Finally, check whether the audio file can be loaded based on the file name constructed previously and call the <code>プレイ()</code> function of the <a href="https://docs.juce.com/master/classSoundPlayer" target="_blank" rel="noopener noreferrer" title="A simple sound player that you can add to the AudioDeviceManager to play simple sounds.">サウンドプレーヤー</a> with the corresponding file.</li>
</ul>
<p>これで、再生ボタンを押すと、対応する音声とともに話し言葉が聞こえるはずです。</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>注記</div><div class="admonitionContent_BuS1"><p>The source code for this modified version of the code can be found in the <code>InAppPurchaseチュートリアル_02.h</code> file of the demo project.</p></div></div>
<h1>Summary</h1>
<p>このチュートリアルでは、モバイルとデスクトップでアプリ内課金を処理する方法を学びました。特に</p>
<ul>
<li>さまざまな配備プラットフォームの予備セットアップをカバー。</li>
<li>様々なIAP製品情報をユーザーインターフェースに表示。</li>
<li>過去のユーザーの購入履 歴を取得し、それに応じてGUIを非同期に更新。</li>
<li>アプリ内で消耗品以外の商品の購入に対応。</li>
</ul>
<h1>See also</h1>
<ul>
<li><a href="/juce-tutorial-ja/mobile/tutorial_android_studio/">チュートリアルアンドロイドを始めよう</a></li>
<li><a href="/juce-tutorial-ja/mobile/tutorial_android_screen_sizes/">チュートリアルAndroidの画面サイズを管理する</a></li>
<li><a href="/juce-tutorial-ja/mobile/tutorial_analytics_collection/">チュートリアルアプリ分析の収集</a></li>
<li><a href="/juce-tutorial-ja/mobile/tutorial_push_notifications/">チュートリアルデスクトップとモバイルデバイスでのプッシュ通知</a></li>
<li><a href="/juce-tutorial-ja/mobile/tutorial_app_plugin_packaging/">チュートリアルアプリやプラグインを配布用にパッケージ化する</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/m1m0zzz/juce-tutorial-ja/tree/main/docs/mobile/tutorial_in_app_purchases.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>このページを編集</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="ドキュメントページ"><a class="pagination-nav__link pagination-nav__link--prev" href="/juce-tutorial-ja/mobile/tutorial_new_projucer_project/"><div class="pagination-nav__sublabel">前へ</div><div class="pagination-nav__label">デスクトップおよびモバイルデバイスでのアプリ内課金</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/juce-tutorial-ja/category/utility-classes/"><div class="pagination-nav__sublabel">次へ</div><div class="pagination-nav__label">Utility Classes</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#apple-developer" class="table-of-contents__link toc-highlight">Apple Developer</a></li><li><a href="#itunes-connect" class="table-of-contents__link toc-highlight">iTunes Connect</a></li><li><a href="#google-play-developer" class="table-of-contents__link toc-highlight">Google Play Developer</a></li><li><a href="#generate-android-apk" class="table-of-contents__link toc-highlight">Generate Android APK</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Tutorial</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/juce-tutorial-ja/category/getting-started/">Getting Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">JUCE</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://juce.com/learn/tutorials/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Tutorials<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://juce.com/learn/documentation/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Documentation<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://forum.juce.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/m1m0zzz/juce-tutorial-ja" target="_blank" rel="noopener noreferrer" class="footer__link-item">repo<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/juce-framework/JUCE" target="_blank" rel="noopener noreferrer" class="footer__link-item">JUCE GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">© 2024 Raw Material Software Limited. translation: mimoz</div></div></div></footer></div>
</body>
</html>