"use strict";(self.webpackChunkjuce_tutorial_ja=self.webpackChunkjuce_tutorial_ja||[]).push([[950],{6369:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>i,metadata:()=>o,toc:()=>d});var t=s(4848),r=s(8453);const i={title:"\u30c7\u30b9\u30af\u30c8\u30c3\u30d7\u304a\u3088\u3073\u30e2\u30d0\u30a4\u30eb\u30c7\u30d0\u30a4\u30b9\u3067\u306e\u30a2\u30d7\u30ea\u5185\u8ab2\u91d1",sidebar_position:4},c="\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u30c7\u30b9\u30af\u30c8\u30c3\u30d7\u3068\u30e2\u30d0\u30a4\u30eb\u30c7\u30d0\u30a4\u30b9\u3067\u306e\u30a2\u30d7\u30ea\u5185\u8ab2\u91d1",o={id:"mobile/tutorial_in_app_purchases",title:"\u30c7\u30b9\u30af\u30c8\u30c3\u30d7\u304a\u3088\u3073\u30e2\u30d0\u30a4\u30eb\u30c7\u30d0\u30a4\u30b9\u3067\u306e\u30a2\u30d7\u30ea\u5185\u8ab2\u91d1",description:"\u30c7\u30b9\u30af\u30c8\u30c3\u30d7\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3068\u30e2\u30d0\u30a4\u30eb\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3067\u3001\u6d88\u8017\u54c1\u3068\u975e\u6d88\u8017\u54c1\u306e\u30a2\u30d7\u30ea\u5185\u8ab2\u91d1\u3092\u8ca9\u58f2\u3067\u304d\u307e\u3059\u3002macOS/iOS\u3068Android\u30c7\u30d0\u30a4\u30b9\u306e\u4e21\u65b9\u3067\u3001IAP\u88fd\u54c1\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3068\u652f\u6255\u3044\u51e6\u7406\u65b9\u6cd5\u3092\u3054\u7d39\u4ecb\u3057\u307e\u3059\u3002",source:"@site/docs/mobile/tutorial_in_app_purchases.mdx",sourceDirName:"mobile",slug:"/mobile/tutorial_in_app_purchases",permalink:"/juce-tutorial-ja/mobile/tutorial_in_app_purchases",draft:!1,unlisted:!1,editUrl:"https://github.com/m1m0zzz/juce-tutorial-ja/tree/main/docs/mobile/tutorial_in_app_purchases.mdx",tags:[],version:"current",sidebarPosition:4,frontMatter:{title:"\u30c7\u30b9\u30af\u30c8\u30c3\u30d7\u304a\u3088\u3073\u30e2\u30d0\u30a4\u30eb\u30c7\u30d0\u30a4\u30b9\u3067\u306e\u30a2\u30d7\u30ea\u5185\u8ab2\u91d1",sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"\u30c7\u30b9\u30af\u30c8\u30c3\u30d7\u304a\u3088\u3073\u30e2\u30d0\u30a4\u30eb\u30c7\u30d0\u30a4\u30b9\u3067\u306e\u30a2\u30d7\u30ea\u5185\u8ab2\u91d1",permalink:"/juce-tutorial-ja/mobile/tutorial_new_projucer_project"},next:{title:"Utility Classes",permalink:"/juce-tutorial-ja/category/utility-classes"}},a={},d=[{value:"\u306f\u3058\u3081\u308b",id:"\u306f\u3058\u3081\u308b",level:2},{value:"Apple Developer",id:"apple-developer",level:2},{value:"iTunes Connect",id:"itunes-connect",level:2},{value:"Google Play Developer",id:"google-play-developer",level:2},{value:"Generate Android APK",id:"generate-android-apk",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components},{CaptionImage:s}=n;return s||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("CaptionImage",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u30c7\u30b9\u30af\u30c8\u30c3\u30d7\u3068\u30e2\u30d0\u30a4\u30eb\u30c7\u30d0\u30a4\u30b9\u3067\u306e\u30a2\u30d7\u30ea\u5185\u8ab2\u91d1",children:"\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u30c7\u30b9\u30af\u30c8\u30c3\u30d7\u3068\u30e2\u30d0\u30a4\u30eb\u30c7\u30d0\u30a4\u30b9\u3067\u306e\u30a2\u30d7\u30ea\u5185\u8ab2\u91d1"})}),"\n",(0,t.jsx)(n.p,{children:"\u30c7\u30b9\u30af\u30c8\u30c3\u30d7\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3068\u30e2\u30d0\u30a4\u30eb\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3067\u3001\u6d88\u8017\u54c1\u3068\u975e\u6d88\u8017\u54c1\u306e\u30a2\u30d7\u30ea\u5185\u8ab2\u91d1\u3092\u8ca9\u58f2\u3067\u304d\u307e\u3059\u3002macOS/iOS\u3068Android\u30c7\u30d0\u30a4\u30b9\u306e\u4e21\u65b9\u3067\u3001IAP\u88fd\u54c1\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3068\u652f\u6255\u3044\u51e6\u7406\u65b9\u6cd5\u3092\u3054\u7d39\u4ecb\u3057\u307e\u3059\u3002"}),"\n",(0,t.jsx)(n.p,{children:"\u30ec\u30d9\u30eb\uff1aAdvanced"}),"\n",(0,t.jsx)(n.p,{children:"\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\uff1amacOS, iOS, Android"}),"\n",(0,t.jsxs)(n.p,{children:["\u30af\u30e9\u30b9\uff1a ",(0,t.jsx)(n.a,{href:"https://docs.juce.com/master/structInAppPurchases_1_1Listener",title:"Represents an object that gets notified about events such as product info returned or product purchas...",children:"InAppPurchases::\u30ea\u30b9\u30ca\u30fc"}),", ",(0,t.jsx)(n.a,{href:"https://docs.juce.com/master/classSoundPlayer",title:"A simple sound player that you can add to the AudioDeviceManager to play simple sounds.",children:"\u30b5\u30a6\u30f3\u30c9\u30d7\u30ec\u30fc\u30e4\u30fc"}),", ",(0,t.jsx)(n.a,{href:"https://docs.juce.com/master/classAsyncUpdater",title:"Has a callback method that is triggered asynchronously.",children:"\u975e\u540c\u671f\u30a2\u30c3\u30d7\u30c7\u30fc\u30bf\u30fc"}),", ",(0,t.jsx)(n.a,{href:"https://docs.juce.com/master/classListBoxModel",title:"A subclass of this is used to drive a ListBox.",children:"\u30ea\u30b9\u30c8\u30dc\u30c3\u30af\u30b9\u30e2\u30c7\u30eb"})]}),"\n",(0,t.jsxs)(n.admonition,{type:"warning",children:[(0,t.jsxs)(n.p,{children:["This project requires Apple Developer and iTunes Connect accounts on macOS/iOS and a Google Play Developer account on Android. If you need help with this, follow the instructions on the ",(0,t.jsx)(n.a,{href:"https://developer.apple.com/account/",children:"\u30a2\u30c3\u30d7\u30eb\u958b\u767a\u8005"}),", ",(0,t.jsx)(n.a,{href:"https://itunesconnect.apple.com",children:"iTunes Connect"})," and ",(0,t.jsx)(n.a,{href:"https://play.google.com/apps/publish/",children:"Google Play\u30c7\u30d9\u30ed\u30c3\u30d1\u30fc"})," websites to open up these accounts."]}),(0,t.jsx)(n.p,{children:"\u30b7\u30df\u30e5\u30ec\u30fc\u30bf\u30fc\u306fIAP\u30c6\u30b9\u30c8\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u306a\u3044\u305f\u3081\u3001\u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u306f\u30a2\u30d7\u30ea\u5185\u8ab2\u91d1\u3092\u30c6\u30b9\u30c8\u3059\u308b\u305f\u3081\u306b\u7269\u7406\u7684\u306a\u30c7\u30d0\u30a4\u30b9\u304c\u5fc5\u8981\u3067\u3059\u3002\u3053\u306e\u305f\u3081\u306b\u30c7\u30d0\u30a4\u30b9\u3092\u7528\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002"})]}),"\n",(0,t.jsx)(n.h2,{id:"\u306f\u3058\u3081\u308b",children:"\u306f\u3058\u3081\u308b"}),"\n",(0,t.jsxs)(n.p,{children:["Download the demo project for this tutorial here: ",(0,t.jsx)(n.a,{href:"/tutorials/PIPs/InAppPurchaseTutorial.zip",children:"\u30d4\u30c3\u30d7"})," | ",(0,t.jsx)(n.a,{href:"/tutorials/ZIPs/InAppPurchaseTutorial.zip",children:"\u30b8\u30c3\u30d7"}),". Unzip the project and open the first header file in the Projucer."]}),"\n",(0,t.jsx)(n.admonition,{type:"warning",children:(0,t.jsxs)(n.p,{children:["If using the PIP version of this project, please make sure to copy the ",(0,t.jsx)(n.code,{children:"\u30ea\u30bd\u30fc\u30b9"})," folder into the generated Projucer project."]})}),"\n",(0,t.jsxs)(n.p,{children:["If you need help with this step, see ",(0,t.jsx)(n.a,{href:"../tutorial_new_projucer_project/",children:"\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30ebProjucer\u30d1\u30fc\u30c81\uff1aProjucer\u3092\u59cb\u3081\u308b"}),"."]}),"\n",(0,t.jsx)(n.h1,{id:"the-demo-project",children:"The demo project"}),"\n",(0,t.jsx)(n.p,{children:"\u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u306f\u3001\u97f3\u58f0\u30c7\u30a3\u30af\u30c6\u30fc\u30b7\u30e7\u30f3\u3092\u4f7f\u7528\u3057\u3066\u30d5\u30ec\u30fc\u30ba\u3092\u518d\u751f\u3059\u308b\u969b\u306b\u3001\u3044\u304f\u3064\u304b\u306e\u8074\u899a\u7684\u306a\u30d5\u30ec\u30fc\u30d0\u30fc\u3092\u63d0\u4f9b\u3059\u308b\u305f\u3081\u306b\u3001\u30a2\u30d7\u30ea\u5185\u8ab2\u91d1\u3067\u53d6\u5f97\u3067\u304d\u308b\u3055\u307e\u3056\u307e\u306a\u97f3\u58f0\u3092\u63d0\u4f9b\u3057\u3066\u3044\u307e\u3059\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u3001\u30e6\u30fc\u30b6\u30fc\u306f\u4e00\u822c\u7684\u306a\u30ed\u30dc\u30c3\u30c8\u97f3\u58f0\u3092\u5229\u7528\u3067\u304d\u307e\u3059\u304c\u3001\u5fc5\u7136\u7684\u306bJUCE\u958b\u767a\u8005\u306e\u97f3\u58f0\u3092\u8a66\u3057\u305f\u304f\u306a\u308a\u307e\u3059\u3002iOS\u30b7\u30df\u30e5\u30ec\u30fc\u30bf\u3067\u30e2\u30d0\u30a4\u30eb\u30fb\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001\u30a6\u30a3\u30f3\u30c9\u30a6\u306f\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\uff1a"}),"\n",(0,t.jsx)(s,{src:"https://docs.juce.com/master/tutorial_in_app_purchases_screenshot1.png",caption:"The demo project app window on iOS"}),"\n",(0,t.jsxs)(n.admonition,{type:"note",children:[(0,t.jsx)(n.p,{children:"\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306f\u30b7\u30df\u30e5\u30ec\u30fc\u30bf\u3067\u5b9f\u884c\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u5546\u54c1\u304c\u30b0\u30ec\u30fc\u30a2\u30a6\u30c8\u3057\u3001\u4fa1\u683c\u304c\u7121\u671f\u9650\u306b\u30d5\u30a7\u30c3\u30c1\u3055\u308c\u308b\u306e\u306f\u4e88\u60f3\u3055\u308c\u305f\u52d5\u4f5c\u3067\u3059\u3002"}),(0,t.jsxs)(n.admonition,{type:"warning",children:[(0,t.jsx)(n.p,{children:"\u3053\u308c\u306f\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u30fb\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u3059\u304c\u3001\u30b5\u30f3\u30c9\u30dc\u30c3\u30af\u30b9\u30fb\u30e2\u30fc\u30c9\u304b\u30c6\u30b9\u30c8\u30fb\u30e6\u30fc\u30b6\u30fc\u3068\u3057\u3066\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u3044\u306a\u3044\u9650\u308a\u3001\u5546\u54c1\u3092\u8cfc\u5165\u3057\u3088\u3046\u3068\u3059\u308b\u3068\u30af\u30ec\u30b8\u30c3\u30c8\u30ab\u30fc\u30c9\u306b\u8ab2\u91d1\u3055\u308c\u307e\u3059\uff01"}),(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.p,{children:["The code presented here is broadly similar to the ",(0,t.jsx)(n.strong,{children:"\u30a2\u30d7\u30ea\u5185\u8cfc\u5165"})," from the JUCE Examples."]})})]})]}),"\n",(0,t.jsx)(n.h1,{id:"initial-setup",children:"Initial Setup"}),"\n",(0,t.jsxs)(n.p,{children:["In order for this project to function properly, we have to perform some initial setup procedures with appropriate developer consoles for specific deployment platform. Let's first allow appropriate permissions for in-app purchases in the Projucer. Under macOS/iOS, make sure that the ",(0,t.jsx)(n.strong,{children:"\u30a2\u30d7\u30ea\u5185\u8ab2\u91d1\u6a5f\u80fd"})," checkbox is ticked. Under Android, make sure that the ",(0,t.jsx)(n.strong,{children:"\u30a2\u30d7\u30ea\u5185\u8ab2\u91d1"})," checkbox is ticked."]}),"\n",(0,t.jsx)(s,{src:"https://docs.juce.com/master/tutorial_in_app_purchases_screenshot2_android.png",caption:"Project settings window on iOS](tutorial_in_app_purchases_screenshot2_ios.png) ![Project settings window on Android"}),"\n",(0,t.jsx)(n.p,{children:"\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u4fdd\u5b58\u3057\u3066\u304a\u6c17\u306b\u5165\u308a\u306eIDE\u3067\u958b\u304f\u3068\u3001Projucer\u304c\u81ea\u52d5\u7684\u306b\u5fc5\u8981\u306a\u30a8\u30f3\u30bf\u30a4\u30c8\u30eb\u30e1\u30f3\u30c8\u3092\u30c7\u30d7\u30ed\u30a4\u30e1\u30f3\u30c8\u30fb\u30bf\u30fc\u30b2\u30c3\u30c8\u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002"}),"\n",(0,t.jsx)(n.h2,{id:"apple-developer",children:"Apple Developer"}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.p,{children:["If developing for Android, please skip to the next section ",(0,t.jsx)(n.a,{href:"#tutorial_in_app_purchases_initial_setup_google_play_developer",children:"Google Play\u30c7\u30d9\u30ed\u30c3\u30d1\u30fc"})," for instructions."]})}),"\n",(0,t.jsx)(n.p,{children:"macOS \u3068 iOS \u3067\u306f\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306b\u7f72\u540d\u3059\u308b\u305f\u3081\u306b\u3001Xcode \u5185\u306e Apple Developer \u30a2\u30ab\u30a6\u30f3\u30c8\u3067\u30b5\u30a4\u30f3\u30a4\u30f3\u3057\u3001\u958b\u767a\u30c1\u30fc\u30e0\u3092\u9078\u629e\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u3042\u306a\u305f\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u305f\u3081\u306e\u30e6\u30cb\u30fc\u30af\u306a\u30d0\u30f3\u30c9\u30eb ID \u3092\u9078\u629e\u3057\u307e\u3059\u3002\u4ee5\u4e0b\u306e\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u306e\u3088\u3046\u306b\u3001Xcode \u306f\u81ea\u52d5\u7684\u306b\u7f72\u540d\u8a3c\u660e\u66f8\u3068 Provisioning Profile \u3092\u63d0\u4f9b\u3057\u307e\u3059\uff1a"}),"\n",(0,t.jsx)(s,{src:"https://docs.juce.com/master/tutorial_in_app_purchases_screenshot3.png",caption:"General settings window in Xcode"}),"\n",(0,t.jsxs)(n.p,{children:["Also make sure that the correct app capabilities have been ticked and approved in the ",(0,t.jsx)(n.strong,{children:"\u80fd\u529b"})," settings window. You should see the same information as follows:"]}),"\n",(0,t.jsx)(s,{src:"https://docs.juce.com/master/tutorial_in_app_purchases_screenshot4.png",caption:"Capabilities settings window in Xcode"}),"\n",(0,t.jsx)(n.h2,{id:"itunes-connect",children:"iTunes Connect"}),"\n",(0,t.jsxs)(n.p,{children:["For the in-app purchases to display properly on iOS, we need to create IAP products in iTunes Connect. First, create a new app in your dashboard under ",(0,t.jsx)(n.strong,{children:"\u79c1\u306e\u30a2\u30d7\u30ea"}),". If you navigate to the ",(0,t.jsx)(n.strong,{children:"\u7279\u5fb4"})," tab of your app, you can access the ",(0,t.jsx)(n.strong,{children:"\u30a2\u30d7\u30ea\u5185\u8ab2\u91d1"})," feature on the following screen:"]}),"\n",(0,t.jsx)(s,{src:"https://docs.juce.com/master/tutorial_in_app_purchases_screenshot5.png",caption:"Create IAP products in iTunes Connect"}),"\n",(0,t.jsxs)(n.p,{children:["Click on the ",(0,t.jsx)(n.strong,{children:"+"})," sign to create six products that correspond with the options in the app with appropriate names and prices."]}),"\n",(0,t.jsx)(n.h2,{id:"google-play-developer",children:"Google Play Developer"}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.p,{children:["If developing for macOS/iOS, please jump to the previous section ",(0,t.jsx)(n.a,{href:"#tutorial_in_app_purchases_initial_setup_apple_developer",children:"\u30a2\u30c3\u30d7\u30eb\u958b\u767a\u8005"})," for instructions."]})}),"\n",(0,t.jsxs)(n.p,{children:["For the in-app purchases to display properly on Android, we need to create in-app billing products in the Google Play Console. First, navigate to your app page from the ",(0,t.jsx)(n.strong,{children:"\u3059\u3079\u3066\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3"})," panel and open up the ",(0,t.jsx)(n.strong,{children:"\u30a2\u30d7\u30ea\u5185\u5546\u54c1"})," page under ",(0,t.jsx)(n.strong,{children:"\u5e97\u8217\u30d7\u30ec\u30bc\u30f3\u30b9"}),". You can access the items under the ",(0,t.jsx)(n.strong,{children:"\u30de\u30cd\u30fc\u30b8\u30c9\u88fd\u54c1"})," tab as shown on the following screen:"]}),"\n",(0,t.jsx)(s,{src:"https://docs.juce.com/master/tutorial_in_app_purchases_screenshot6.png",caption:"Create IAB products in the Google Play Console"}),"\n",(0,t.jsxs)(n.p,{children:["Click on ",(0,t.jsx)(n.strong,{children:"\u30de\u30cd\u30fc\u30b8\u30c9\u88fd\u54c1\u3092\u4f5c\u308b"})," to create six products that correspond with the options in the app with appropriate names and prices."]}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsx)(n.p,{children:"Google Play\u306e\u30d7\u30ed\u30c0\u30af\u30c8ID\u306b\u95a2\u3059\u308b\u5236\u9650\u306b\u3088\u308a\u3001\u30d7\u30ed\u30c0\u30af\u30c8ID\u306b\u306f\u6570\u5b57\uff080\uff5e9\uff09\u3001\u5c0f\u6587\u5b57\uff08a\uff5ez\uff09\u3001\u30a2\u30f3\u30c0\u30fc\u30b9\u30b3\u30a2\uff08_\uff09\u3001\u307e\u305f\u306f\u30d5\u30eb\u30b9\u30c8\u30c3\u30d7\uff08.)\u306e\u307f\u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u3092\u304a\u52e7\u3081\u3057\u307e\u3059\u3002\u3053\u3046\u3059\u308b\u3053\u3068\u3067\u3001AppStore\u3068PlayStore\u306e\u4e21\u65b9\u3067\u540c\u3058\u30d7\u30ed\u30c0\u30af\u30c8ID\u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u305d\u3046\u3057\u306a\u3044\u3068\u3001\u30a2\u30d7\u30ea\u306f\u540c\u3058\u5546\u54c1\u3067\u3082\u7570\u306a\u308b\u5546\u54c1ID\u3092\u6271\u308f\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u304f\u306a\u308a\u307e\u3059\u3002"})}),"\n",(0,t.jsx)(n.h2,{id:"generate-android-apk",children:"Generate Android APK"}),"\n",(0,t.jsxs)(n.p,{children:["In order for in-app purchases to function properly on Android, we have to sign the Android version of the app and authenticate the requests to the Google Play store API. First launch Android Studio and navigate to the menu bar under ",(0,t.jsx)(n.strong,{children:"\u30d3\u30eb\u30c9 > \u7f72\u540d\u4ed8\u304dAPK\u306e\u751f\u6210..."}),":"]}),"\n",(0,t.jsx)(s,{src:"https://docs.juce.com/master/tutorial_in_app_purchases_screenshot7.png",caption:"Generate signed APK from menu bar"}),"\n",(0,t.jsx)(n.p,{children:"\u305d\u306e\u5f8c\u3001\u30ad\u30fc\u30b9\u30c8\u30a2\u30fb\u30d5\u30a1\u30a4\u30eb\u306e\u5834\u6240\u3001\u30a8\u30a4\u30ea\u30a2\u30b9\u3001\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3059\u308b\u3088\u3046\u30d7\u30ed\u30f3\u30d7\u30c8\u304c\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5165\u529b\u3059\u308b\uff1a"}),"\n",(0,t.jsx)(s,{src:"https://docs.juce.com/master/tutorial_in_app_purchases_screenshot8.png",caption:"Enter aliases and passwords for keystore file"}),"\n",(0,t.jsx)(n.p,{children:'\u6b21\u306b\u3001\u30ea\u30ea\u30fc\u30b9\u30d3\u30eb\u30c9\u30bf\u30a4\u30d7\u306e "release_"\u30d5\u30ec\u30fc\u30d0\u30fc\u3092\u9078\u629e\u3057\u3001V1\u3068V2\u306e\u4e21\u65b9\u306e\u7f72\u540d\u304c\u30c1\u30a7\u30c3\u30af\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002'}),"\n",(0,t.jsx)(s,{src:"https://docs.juce.com/master/tutorial_in_app_purchases_screenshot9.png",caption:"Build type, flavours and signature versions"}),"\n",(0,t.jsxs)(n.p,{children:["This will generate the keystore file that you can now refer to in the Projucer. Under the Android release settings, enter the relative path, alias and passwords to the keystore file in the ",(0,t.jsx)(n.strong,{children:"\u30ad\u30fc\u30fb\u30b5\u30a4\u30f3"})," fields:"]}),"\n",(0,t.jsx)(s,{src:"https://docs.juce.com/master/tutorial_in_app_purchases_screenshot10.png",caption:"Path for keystore file in release settings"}),"\n",(0,t.jsx)(n.p,{children:"\u30a2\u30d7\u30ea\u5185\u8cfc\u5165\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u306f\u3082\u3046\u5b8c\u4e86\u3057\u3066\u3044\u308b\u306f\u305a\u3067\u3001\u3088\u3046\u3084\u304f\u30a2\u30d7\u30ea\u306b\u3053\u308c\u3089\u306e\u6a5f\u80fd\u3092\u5b9f\u88c5\u3057\u59cb\u3081\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002"}),"\n",(0,t.jsx)(n.h1,{id:"purchase-types",children:"Purchase Types"}),"\n",(0,t.jsx)(n.p,{children:"\u30a2\u30d7\u30ea\u5185\u8ab2\u91d1\u306f\u3001\u30a2\u30d7\u30ea\u5185\u3067\u76f4\u63a5\u9867\u5ba2\u306b\u8ffd\u52a0\u30b3\u30f3\u30c6\u30f3\u30c4\u3084\u6a5f\u80fd\u3092\u63d0\u4f9b\u3059\u308b\u306e\u306b\u4fbf\u5229\u3067\u3059\u3002\u30d7\u30ec\u30df\u30a2\u30e0\u6a5f\u80fd\u3001\u9650\u5b9a\u30a2\u30a4\u30c6\u30e0\u3001\u3042\u308b\u3044\u306f\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u306a\u3069\u304c\u3042\u308a\u307e\u3059\u3002\u4e00\u822c\u7684\u306b\u3001\u3059\u3079\u3066\u306e\u95a2\u9023\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u30674\u3064\u306e\u4e3b\u8981\u306a\u30bf\u30a4\u30d7\u306e\u8cfc\u5165\u304c\u3042\u308a\u307e\u3059\uff1a"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u6d88\u8017\u54c1\uff1a\u8907\u6570\u56de\u4f7f\u7528\u30fb\u8cfc\u5165\u53ef\u80fd\u306a\u30a2\u30a4\u30c6\u30e0\u3002"}),"\n",(0,t.jsx)(n.li,{children:"\u975e\u6d88\u8017\u54c1\uff1a\u30a2\u30d7\u30ea\u306e\u6a5f\u80fd\u3092\u6c38\u7d9a\u7684\u306b\u30a2\u30f3\u30ed\u30c3\u30af\u3059\u308b1\u56de\u9650\u308a\u306e\u8cfc\u5165\u3002"}),"\n",(0,t.jsx)(n.li,{children:"\u81ea\u52d5\u66f4\u65b0\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\uff1a\u5b9a\u671f\u7684\u306b\u66f4\u65b0\u3055\u308c\u308b\u30b3\u30f3\u30c6\u30f3\u30c4\u3092\u3001\u89e3\u7d04\u3059\u308b\u307e\u3067\u5b9a\u671f\u7684\u306b\u304a\u5c4a\u3051\u3057\u307e\u3059\u3002"}),"\n",(0,t.jsx)(n.li,{children:"\u66f4\u65b0\u3055\u308c\u306a\u3044\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\uff1a\u624b\u52d5\u66f4\u65b0\u304c\u5fc5\u8981\u306a\u671f\u9593\u9650\u5b9a\u30b3\u30f3\u30c6\u30f3\u30c4\u3002"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"\u3053\u306e\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u3067\u306f\u3001\u975e\u6d88\u8cbb\u578b\u306e\u30a2\u30d7\u30ea\u5185\u8ab2\u91d1\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002"}),"\n",(0,t.jsx)(n.h1,{id:"project-structure",children:"Project structure"}),"\n",(0,t.jsx)(n.p,{children:"\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306f\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u3055\u307e\u3056\u307e\u306a\u90e8\u5206\u3092\u51e6\u7406\u3059\u308b\u305f\u3081\u306b\u3001\u4ee5\u4e0b\u306e\u30af\u30e9\u30b9\u3092\u4f7f\u7528\u3057\u3066\u69cb\u6210\u3055\u308c\u3066\u3044\u307e\u3059\uff1a"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"MainContentComponent\uff1a\u753b\u9762\u4e0a\u306bGUI\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092\u30ec\u30a4\u30a2\u30a6\u30c8\u3057\u3001\u518d\u751f/\u505c\u6b62\u30dc\u30bf\u30f3\u30af\u30ea\u30c3\u30af\u6642\u306e\u30b5\u30a6\u30f3\u30c9\u30d5\u30a1\u30a4\u30eb\u306e\u518d\u751f\u3092\u51e6\u7406\u3059\u308b\u3002"}),"\n",(0,t.jsxs)(n.li,{children:["PhraseModel: ",(0,t.jsx)(n.a,{href:"https://docs.juce.com/master/classListBoxModel",title:"A subclass of this is used to drive a ListBox.",children:"\u30ea\u30b9\u30c8\u30dc\u30c3\u30af\u30b9\u30e2\u30c7\u30eb"})," to describe available phrases to play using purchased voices."]}),"\n",(0,t.jsxs)(n.li,{children:["VoiceModel: ",(0,t.jsx)(n.a,{href:"https://docs.juce.com/master/classListBoxModel",title:"A subclass of this is used to drive a ListBox.",children:"\u30ea\u30b9\u30c8\u30dc\u30c3\u30af\u30b9\u30e2\u30c7\u30eb"})," to describe available voices that can be purchased to play phrases with."]}),"\n",(0,t.jsxs)(n.li,{children:["VoiceRow: Custom row ",(0,t.jsx)(n.a,{href:"https://docs.juce.com/master/classComponent",title:"The base class for all JUCE user-interface objects.",children:"\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8"})," for the VoiceModel class to display pictures and information for specific voice entries."]}),"\n",(0,t.jsxs)(n.li,{children:["VoicePurchases: Class to manage VoiceProduct purchases that handles purchases and encapsulates the ",(0,t.jsx)(n.a,{href:"https://docs.juce.com/master/classInAppPurchases",title:"Provides in-app purchase functionality.",children:"\u30a2\u30d7\u30ea\u5185\u8ab2\u91d1"})," instance."]}),"\n",(0,t.jsx)(n.li,{children:"VoiceProduct\uff1a\u4fa1\u683c\u3001\u540d\u524d\u3001\u4ee5\u524d\u306b\u8cfc\u5165\u3057\u305f\u304b\u3069\u3046\u304b\u306a\u3069\u306e\u60c5\u5831\u3092\u542b\u3080\u3001\u5358\u4e00\u306e\u8cfc\u5165\u53ef\u80fd\u306a\u88fd\u54c1\u3092\u8a18\u8ff0\u3059\u308b\u305f\u3081\u306e\u69cb\u9020\u3002"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["As we can see, it roughly follows an ",(0,t.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller",children:"\u8eca\u3005\u9593\u901a\u4fe1"})," design pattern to separate application functionalities into separate classes."]}),"\n",(0,t.jsx)(n.p,{children:"VoiceProduct \u69cb\u9020\u4f53\u306b\u306f\u3001\u6d88\u8017\u54c1\u4ee5\u5916\u306e\u88fd\u54c1\u306b\u5f79\u7acb\u3064\u60c5\u5831\u3001\u3064\u307e\u308a\u4ee5\u4e0b\u306e\u5909\u6570\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u3059\uff1a"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"const char* identifier\uff1aiTunes Connect\u3084Google Play\u304b\u3089\u53c2\u7167\u3055\u308c\u308b\u4e00\u610f\u306e\u8b58\u5225\u5b50\u3002"}),"\n",(0,t.jsx)(n.li,{children:"const char* humanReadable\uff1a\u30a2\u30d7\u30ea\u306b\u8868\u793a\u3059\u308b\u3001\u4eba\u9593\u304c\u8aad\u3081\u308b\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u8b58\u5225\u5b50\u3002"}),"\n",(0,t.jsx)(n.li,{children:"bool isPurchased\uff1a\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u3044\u308b\u30e6\u30fc\u30b6\u304c\u305d\u306e\u30a2\u30a4\u30c6\u30e0\u3092\u8cfc\u5165\u3057\u305f\u3053\u3068\u304c\u3042\u308b\u304b\u3069\u3046\u304b\u3002"}),"\n",(0,t.jsx)(n.li,{children:"bool priceIsKnown\uff1a\u4fa1\u683c\u304c\u8aad\u307f\u8fbc\u307e\u308c\u3001\u8868\u793a\u3055\u308c\u308b\u3088\u3046\u306b\u53d6\u5f97\u3055\u308c\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u3002"}),"\n",(0,t.jsx)(n.li,{children:"bool purchaseInProgress\uff1a\u30e6\u30fc\u30b6\u30fc\u304c\u73fe\u5728\u9032\u884c\u4e2d\u306e\u8cfc\u5165\u3092\u958b\u59cb\u3057\u305f\u304b\u3069\u3046\u304b\u3002"}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://docs.juce.com/master/classString",title:"The JUCE String class!",children:"\u30b9\u30c8\u30ea\u30f3\u30b0"})," purchasePrice: A localised string that displays the product price in the local currency."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"\u6d88\u8017\u54c1\u306e\u8cfc\u5165\u306b\u306f\u3069\u306e\u3088\u3046\u306a\u60c5\u5831\u304c\u5fc5\u8981\u3060\u308d\u3046\u304b\uff1f\u5b9a\u671f\u8cfc\u5165\u306b\u3064\u3044\u3066\u306f\u3069\u3046\u3060\u308d\u3046\uff1f\u4f55\u304c\u8ffd\u52a0\u3055\u308c\u308b\u3079\u304d\u304b\u3001\u4f55\u304c\u524a\u9664\u3055\u308c\u308b\u3079\u304d\u304b\u3092\u8003\u3048\u3088\u3046\u3002"}),"\n",(0,t.jsx)(n.h1,{id:"displaying-products",children:"Displaying products"}),"\n",(0,t.jsxs)(n.p,{children:["Let's start by displaying the IAP products that we want to sell in the user interface. In the VoicePurchases constructor of the ",(0,t.jsx)(n.code,{children:"\u30dc\u30a4\u30b9\u8cfc\u5165"})," class, we have initialised the VoiceProduct objects using the structure described above like so:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'    VoicePurchases()\n    {\n        voiceProducts = juce::Array(\n                        {VoiceProduct {"robot", "Robot", true, true, false, "Free" }\u3001\n                          VoiceProduct {"jules", "Jules", false, false, false, "\u4fa1\u683c\u3092\u53d6\u5f97\u3057\u3066\u3044\u307e\u3059\u3002"},\n                          VoiceProduct {"fabian", "Fabian", false, false, false, "\u4fa1\u683c\u691c\u7d22\u4e2d..." }, VoiceProduct {"fabian", "Fabian", false, false, false, "\u4fa1\u683c\u691c\u7d22\u4e2d..."},\n                          VoiceProduct {"ed", "Ed", false, false, false, "\u4fa1\u683c\u691c\u7d22\u4e2d..."},\n                          VoiceProduct {"lukasz", "Lukasz", false, false, false, "\u4fa1\u683c\u691c\u7d22\u4e2d..." }, VoiceProduct {"lukasz", "Lukasz", false, false, false, "\u4fa1\u683c\u691c\u7d22\u4e2d..."},\n                          VoiceProduct {"jb", "JB", false, false, false, "\u4fa1\u683c\u691c\u7d22\u4e2d..." }, VoiceProduct {"jb", "JB", false, false, false, "\u4fa1\u683c\u691c\u7d22\u4e2d..."}});\n    }\n'})}),"\n",(0,t.jsx)(n.admonition,{type:"warning",children:(0,t.jsx)(n.p,{children:"\u3053\u308c\u3089\u306e\u30d7\u30ed\u30c0\u30af\u30c8ID\u306f\u3001iTunes Connect\u3084Google Play Console\u306e\u5024\u3068\u6b63\u78ba\u306b\u4e00\u81f4\u3057\u306a\u3051\u308c\u3070\u6b63\u3057\u304f\u52d5\u4f5c\u3057\u307e\u305b\u3093\u3002"})}),"\n",(0,t.jsxs)(n.p,{children:["In order to easily retrieve human-readable versions of all our products, we have implemented a helper function that returns a ",(0,t.jsx)(n.a,{href:"https://docs.juce.com/master/classStringArray",title:"A special array for holding a list of strings.",children:"\u6587\u5b57\u5217\u914d\u5217"})," of all capitalised names:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"juce::StringArray getVoiceNames() const\n    {\n        juce::StringArray names\uff1b\n \n        for (auto& voiceProduct : voiceProducts)\n            names.add (voiceProduct.humanReadable)\uff1b\n \n        names \u3092\u8fd4\u3057\u307e\u3059\uff1b\n    }\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Let's create another helper function in the same class called ",(0,t.jsx)(n.code,{children:"findVoiceIndexFromIdentifier()"})," to get the index of a VoiceProduct when passed an identifier. This private function will be helpful later on when dealing with callbacks from the ",(0,t.jsx)(n.a,{href:"https://docs.juce.com/master/classInAppPurchases",title:"Provides in-app purchase functionality.",children:"\u30a2\u30d7\u30ea\u5185\u8ab2\u91d1"})," object:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"int findVoiceIndexFromIdentifier (juce::String identifier) const\n    {\n        identifier = identifier.toLowerCase()\uff1b\n \n        for (auto i = 0; i < voiceProducts.size(); ++i)\n            if (juce::String (voiceProducts.getReference (i).identifier) == identifier)\n                return i\uff1b\n \n        return -1\uff1b\n    }\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.a,{href:"https://docs.juce.com/master/classInAppPurchases",title:"Provides in-app purchase functionality.",children:"\u30a2\u30d7\u30ea\u5185\u8ab2\u91d1"})," class works as a broadcaster so let's inherit from ",(0,t.jsx)(n.a,{href:"https://docs.juce.com/master/structInAppPurchases_1_1Listener",title:"Represents an object that gets notified about events such as product info returned or product purchas...",children:"InAppPurchases::\u30ea\u30b9\u30ca\u30fc"})," to become a listener for this class and receive callbacks from the IAP server [1]:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"class VoicePurchases : private juce::InAppPurchases::Listener // [1].\n{\npublic\uff1a\n"})}),"\n",(0,t.jsxs)(n.p,{children:["We can now start overriding the ",(0,t.jsx)(n.a,{href:"https://docs.juce.com/master/classInAppPurchases",title:"Provides in-app purchase functionality.",children:"\u30a2\u30d7\u30ea\u5185\u8ab2\u91d1"})," callback functions in our VoicePurchases class. First, implement the ",(0,t.jsx)(n.code,{children:"productsInfoReturned()"})," function. This function gets called to return product information after a call to ",(0,t.jsx)(n.a,{href:"classInAppPurchases.html#aad53d0d034c19ad6cce54ec9e39e69b8",title:"Asynchronously requests information for products with given ids.",children:"InAppPurchases::getProductsInformation()"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'    void productsInfoReturned (const juce::Array\u88fd\u54c1\uff09\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\n    {\n        if (! juce::InAppPurchases::getInstance()->isInAppPurchasesSupported()) // [2].\n        {\n            for (auto idx = 1; idx < voiceProducts.size(); ++idx) // [3].\n            {\n                auto& voiceProduct = voiceProducts.getReference (idx)\uff1b\n \n                voiceProduct.isPurchased = false\uff1b\n                voiceProduct.priceIsKnown = false\uff1b\n                voiceProduct.purchasePrice = "\u30a2\u30d7\u30ea\u5185\u8cfc\u5165\u306f\u5229\u7528\u3067\u304d\u307e\u305b\u3093\uff1b\n            }\n \n            juce::AlertWindow::showMessageBoxAsync (juce::AlertWindow::WarningIcon, // [4])\n                                                    "In-app purchase is unavailable!"\u3001\n                                                    "\u30a2\u30d7\u30ea\u5185\u8ab2\u91d1\u306f\u5229\u7528\u3067\u304d\u307e\u305b\u3093\u3002\u3053\u308c\u306f\u3001"\n                                                    "\u3053\u308c\u306f\u3001IAP\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u306a\u3044\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u3067IAP\u3092\u4f7f\u7528\u3057\u3088\u3046\u3068\u3057\u3066\u3044\u308b\u304b\u3001IAP\u3067\u52d5\u4f5c\u3059\u308b\u3088\u3046\u306b\u30a2\u30d7\u30ea\u3092\u6b63\u3057\u304f\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7" "\u3057\u3066\u3044\u306a\u3044\u3053\u3068\u3092\u610f\u5473\u3057\u307e\u3059\u3002\n                                                    "\u3053\u308c\u306f\u3001IAP\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u306a\u3044\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u3067IAP\u3092\u4f7f\u7528\u3057\u3088\u3046\u3068\u3057\u3066\u3044\u308b\u304b\u3001IAP\u3067\u52d5\u4f5c\u3059\u308b\u3088\u3046\u306b\u30a2\u30d7\u30ea\u3092\u6b63\u3057\u304f\u8a2d\u5b9a" "\u3057\u3066\u3044\u306a\u3044\u304b\u306e\u3069\u3061\u3089\u304b\u3067\u3059\u3001\n                                                    "OK")\uff1b\n        }\n        else\n        {\n            for (auto product : products)\n            {\n                auto idx = findVoiceIndexFromIdentifier (product.identifier); // [5].\n \n                if (juce::isPositiveAndBelow (idx, voiceProducts.size()))               // [6]\n                {\n                    auto& voiceProduct = voiceProducts.getReference (idx)\uff1b\n \n                    voiceProduct.priceIsKnown = true\uff1b\n                    voiceProduct.purchasePrice = product.price\uff1b\n                }\n            }\n \n            juce::AlertWindow::showMessageBoxAsync (juce::AlertWindow::WarningIcon, // [7].\n                                                    "Your credit card will be charged!"\u3001\n                                                    "You are running the sample code for JUCE In-App purchases."\n                                                    "\u3053\u308c\u306f\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u306b\u904e\u304e\u307e\u305b\u3093\u304c\u3001\u30af\u30ec\u30b8\u30c3\u30c8\u30ab\u30fc\u30c9\u306b\u8ab2\u91d1\u3055\u308c\u307e\u3059\uff01"\u3001\n                                                    "\u308f\u304b\u308a\u307e\u3057\u305f\uff01")\uff1b\n        }\n \n        guiUpdater.triggerAsyncUpdate()\uff1b\n    }\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"[2]: First, check whether in-app purchases are supported on your platform and that setup was correctly performed."}),"\n",(0,t.jsx)(n.li,{children:"[3]: For all VoiceProduct objects except the first free one, set their variables to reflect unavailability of products."}),"\n",(0,t.jsx)(n.li,{children:"[4]: Optionally show a message box asynchronously to explain the issue to the user."}),"\n",(0,t.jsx)(n.li,{children:"[5]: For all VoiceProduct objects if in-app purchases are available, retrieve the index from the identifier with the previously implemented helper function."}),"\n",(0,t.jsx)(n.li,{children:"[6]: If the index is valid, set the product variables to reflect availability of the product."}),"\n",(0,t.jsx)(n.li,{children:"[7]: Optionally show a message box asynchronously explaining that users will be charged."}),"\n"]}),"\n",(0,t.jsx)(n.h1,{id:"retrieving-purchases",children:"Retrieving purchases"}),"\n",(0,t.jsx)(n.admonition,{type:"warning",children:(0,t.jsx)(n.p,{children:"\u3053\u306e\u30bb\u30af\u30b7\u30e7\u30f3\u306f\u7269\u7406\u7684\u306a\u30c7\u30d0\u30a4\u30b9\u4e0a\u3067\u306e\u307f\u6a5f\u80fd\u3057\u307e\u3059\u3002\u30b7\u30df\u30e5\u30ec\u30fc\u30bf\u30fc\u3067\u306f\u6b63\u3057\u304f\u6a5f\u80fd\u3057\u307e\u305b\u3093\u306e\u3067\u3001\u8a66\u3055\u306a\u3044\u3067\u304f\u3060\u3055\u3044\u3002"})}),"\n",(0,t.jsx)(n.p,{children:"\u30a2\u30d7\u30ea\u5185\u8ab2\u91d1\u3092\u6271\u3046\u5834\u5408\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u6700\u521d\u306b\u30c1\u30a7\u30c3\u30af\u3059\u3079\u304d\u306a\u306e\u306f\u3001\u30e6\u30fc\u30b6\u30fc\u304c\u30b5\u30a4\u30f3\u30a4\u30f3\u3057\u305f\u3068\u304d\u306b\u904e\u53bb\u306e\u8cfc\u5165\u5c65\u6b74\u304c\u3042\u308b\u304b\u3069\u3046\u304b\u3067\u3059\u3002\u9867\u5ba2\u3068\u3057\u3066\u6700\u3082\u30a4\u30e9\u30a4\u30e9\u3059\u308b\u3053\u3068\u306e1\u3064\u306f\u3001\u5225\u306e\u30c7\u30d0\u30a4\u30b9\u3084\u540c\u3058\u30a2\u30d7\u30ea\u306e\u4ee5\u524d\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u8cfc\u5165\u3057\u305f\u3082\u306e\u3092\u5931\u3046\u3053\u3068\u3067\u3059\u3002\u305d\u3053\u3067\u3001\u30a2\u30d7\u30ea\u8d77\u52d5\u6642\u306b\u3067\u304d\u308b\u3060\u3051\u65e9\u304f\u3001\u30e6\u30fc\u30b6\u30fc\u304c\u5546\u54c1\u30da\u30fc\u30b8\u306e\u6700\u65b0\u30d3\u30e5\u30fc\u3092\u53d6\u5f97\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u3087\u3046\u3002"}),"\n",(0,t.jsxs)(n.p,{children:["First, create additional private variables in the ",(0,t.jsx)(n.code,{children:"\u30dc\u30a4\u30b9\u8cfc\u5165"})," class to store temporary states of the app [1]:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"    bool havePurchasesBeenRestored = false, havePricesBeenFetched = false, purchaseInProgress = false; // [1]\n    juce::Array\u30dc\u30a4\u30b9\u30d7\u30ed\u30c0\u30af\u30c8\n \n    JUCE_DECLARE_NON_COPYABLE_WITH_LEAK_DETECTOR (VoicePurchases)\n};\n"})}),"\n",(0,t.jsxs)(n.p,{children:["We also need a new helper function called ",(0,t.jsx)(n.code,{children:"\u30b2\u30c3\u30c8\u30d1\u30fc\u30c1\u30a7\u30b9()"})," to retrieve a VoiceProduct from an index. In this function, we also insert initialisation code for when this function is first called:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"VoiceProduct getPurchase (int voiceIndex)\n    {\n        if (! havePurchasesBeenRestored)\n        {\n            havePurchasesBeenRestored = true; // [2].\n            juce::InAppPurchases::getInstance()->addListener (this); // [3].\n \n            juce::InAppPurchases::getInstance()->restoreProductsBoughtList (true); // [4].\n        }\n \n        return voiceProducts[voiceIndex]; // [5].\n    }\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"[2]: If this is the first time this function is called, make sure this code segment does not get called again."}),"\n",(0,t.jsxs)(n.li,{children:["[3]: Add this class as a listener to the ",(0,t.jsx)(n.a,{href:"https://docs.juce.com/master/classInAppPurchases",title:"Provides in-app purchase functionality.",children:"\u30a2\u30d7\u30ea\u5185\u8ab2\u91d1"})," instance to receive callbacks."]}),"\n",(0,t.jsxs)(n.li,{children:["[4]: We can then call the ",(0,t.jsx)(n.code,{children:"restoreProductsBoughtList()"})," function to trigger the restoration process and wait for the subsequent callback."]}),"\n",(0,t.jsx)(n.li,{children:"[5]: Finally, return the VoiceProduct at the specified index. This will get called every time as normal behaviour for this function."}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Since the VoicePurchases class gets registered as a listener when the above function gets initially called, we need to make sure we unregister when this class gets destroyed. Remove the class as an ",(0,t.jsx)(n.a,{href:"https://docs.juce.com/master/classInAppPurchases",title:"Provides in-app purchase functionality.",children:"\u30a2\u30d7\u30ea\u5185\u8ab2\u91d1"})," listener in the class destructor:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"~VoicePurchases() \u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\n    {\n        juce::InAppPurchases::getInstance()->removeListener (this)\uff1b\n    }\n"})}),"\n",(0,t.jsxs)(n.p,{children:["In the previously defined ",(0,t.jsx)(n.code,{children:"\u30b2\u30c3\u30c8\u30d1\u30fc\u30c1\u30a7\u30b9()"})," function, we called the ",(0,t.jsx)(n.code,{children:"restoreProductsBoughtList()"})," function to trigger a callback to restore our purchases. Now let's implement that callback function called ",(0,t.jsx)(n.code,{children:"\u8cfc\u5165\u30ea\u30b9\u30c8\u5fa9\u5143()"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"    void purchasesListRestored (const juce::Array& infos, bool success, const juce::String&) override\n    {\n        if (success)\n        {\n            for (auto& info : infos)\n            {\n                for (const auto& productId : info.purchase.productIds)\n                {\n                    auto idx = findVoiceIndexFromIdentifier (productId); // [6].\n \n                    if (juce::isPositiveAndBelow (idx, voiceProducts.size()))\n                    {\n                        auto& voiceProduct = voiceProducts.getReference (idx); // [7].\n \n                        voiceProduct.isPurchased = true\uff1b\n                    }\n                }\n            }\n \n            guiUpdater.triggerAsyncUpdate()\uff1b\n        }\n \n        if (! havePricesBeenFetched)\n        {\n            havePricesBeenFetched = true; // [8].\n            juce::StringArray\u8b58\u5225\u5b50\uff1b\n \n            for (auto& voiceProduct : voiceProducts)\n                identifiers.add (voiceProduct.identifier)\uff1b\n \n            juce::InAppPurchases::getInstance()->getProductsInformation (identifiers); // [9].\n        }\n    }\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"[6]: If the response from the server is successful, we can update our purchase list. Using the helper function, find the index of the voice from the identifier."}),"\n",(0,t.jsx)(n.li,{children:"[7]: If the index is valid, set the appropriate variables of the VoiceProduct object to reflect its purchase state."}),"\n",(0,t.jsx)(n.li,{children:"[8]: When this callback function gets called the first time around, we need to initialise the purchase prices. Make sure this code segment does not get called a second time."}),"\n",(0,t.jsxs)(n.li,{children:["[9]: Initiate the request to retrieve product prices on the ",(0,t.jsx)(n.a,{href:"https://docs.juce.com/master/classInAppPurchases",title:"Provides in-app purchase functionality.",children:"\u30a2\u30d7\u30ea\u5185\u8ab2\u91d1"})," instance by calling the ",(0,t.jsx)(n.code,{children:"\u53d6\u5f97\u88fd\u54c1\u60c5\u5831()"})," function."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["In order to update the GUI for these in-app purchases products, it would be useful to have temporary variables to store purchase states. Let's declare these as private member variables in the VoiceRow subclass of the ",(0,t.jsx)(n.code,{children:"\u30dc\u30a4\u30b9\u30e2\u30c7\u30eb"})," class:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"bool isSelected = false, hasBeenPurchased = false, purchaseInProgress = false\uff1b\n        int rowSelected = -1\uff1b\n        juce::\u753b\u50cf\u30a2\u30d0\u30bf\u30fc\uff1b\n"})}),"\n",(0,t.jsxs)(n.p,{children:["At the moment, all the in-app purchases products look visually the same and do not clearly indicate their availability in a visually-striking manner. Let's apply a different look and feel to purchasable products. In the ",(0,t.jsx)(n.code,{children:"\u30da\u30a4\u30f3\u30c8"})," function, modify the code to apply a white background to the product image when available [10] and a white semi-transparent overlay when unavailable [11]:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"void paint (juce::Graphics& g) override\n        {\n            auto r = getLocalBounds().reduced (4)\uff1b\n            {\n                auto voiceIconBounds = r.removeFromLeft (r.getHeight())\uff1b\n                g.setColour (juce::Colours::black)\uff1b\n                g.drawRect (voiceIconBounds)\uff1b\n \n                voiceIconBounds.reduce (1, 1)\uff1b\n                g.setColour (hasBeenPurchased ? juce::Colours::white : juce::Colours::grey); // [10].\n                g.fillRect (voiceIconBounds)\uff1b\n \n                g.drawImage (avatar, voiceIconBounds.toFloat())\uff1b\n \n                if (! hasBeenPurchased)\n                {\n                    g.setColour (juce::Colours::white.withAlpha (0.8f)); // [11].\n                    g.fillRect (voiceIconBounds)\uff1b\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Also modify the code in the ",(0,t.jsx)(n.code,{children:"\u66f4\u65b0()"})," function to reflect purchase status on the name and price labels. Use the previously defined helper function to retrieve the VoiceProduct from the row index first [12] and set the temporary variable to indicate whether the item was purchased [13]. Then update the GUI accordingly as follows:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'void update (int rowNumber, bool rowIsSelected)\n        {\n            isSelected = rowIsSelected\uff1b\n            rowSelected = rowNumber\uff1b\n \n            if (juce::isPositiveAndBelow (rowNumber, voices.size()))\n            {\n                auto imageResourceName = voices[rowNumber] + ".png"\uff1b\n \n                nameLabel.setText (voices[rowNumber], juce::NotificationType::dontSendNotification)\uff1b\n \n                auto purchase = purchases.getPurchase (rowNumber); // [12].\n                hasBeenPurchased = purchase.isPurchased; // [13].\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'if (rowNumber == 0)\n                {\n                    purchaseButton.setButtonText ("Internal")\uff1b\n                    purchaseButton.setEnabled (false)\uff1b\n                }\n                else\n                {\n                    purchaseButton.setButtonText (hasBeenPurchased ? "Purchased" : "Purchase")\uff1b\n                    purchaseButton.setEnabled (! hasBeenPurchased && purchase.priceIsKnown)\uff1b\n                }\n \n                setInterceptsMouseClicks (! hasBeenPurchased, ! hasBeenPurchased); // [14].\n'})}),"\n",(0,t.jsx)(n.p,{children:"In this piece of code, we mainly update the font styles of the name and price labels to remain as default when the item is purchased and change its colour to white. In addition, we enable the purchase buttons if the corresponding product is available for purchase. We also need to disable mouse clicks on these buttons after purchase to avoid errors when charging the customer [14]."}),"\n",(0,t.jsx)(n.h1,{id:"purchasing-products",children:"Purchasing products"}),"\n",(0,t.jsx)(n.admonition,{type:"warning",children:(0,t.jsx)(n.p,{children:"\u3053\u306e\u30bb\u30af\u30b7\u30e7\u30f3\u306f\u7269\u7406\u7684\u306a\u30c7\u30d0\u30a4\u30b9\u4e0a\u3067\u306e\u307f\u6a5f\u80fd\u3057\u307e\u3059\u3002\u30b7\u30df\u30e5\u30ec\u30fc\u30bf\u30fc\u3067\u306f\u6b63\u3057\u304f\u6a5f\u80fd\u3057\u307e\u305b\u3093\u306e\u3067\u3001\u8a66\u3055\u306a\u3044\u3067\u304f\u3060\u3055\u3044\u3002"})}),"\n",(0,t.jsxs)(n.p,{children:["We have yet to implement purchasing behaviour in our app so let's do that. Implement a ",(0,t.jsx)(n.code,{children:"purchaseVoice()"})," public function in the ",(0,t.jsx)(n.code,{children:"\u30dc\u30a4\u30b9\u8cfc\u5165"})," class that transfers the request to the ",(0,t.jsx)(n.a,{href:"https://docs.juce.com/master/classInAppPurchases",title:"Provides in-app purchase functionality.",children:"\u30a2\u30d7\u30ea\u5185\u8ab2\u91d1"})," instance:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"void purchaseVoice (int voiceIndex)\n    {\n        if (havePricesBeenFetched && juce::isPositiveAndBelow (voiceIndex, voiceProducts.size()))\n        {\n            auto& product = voiceProducts.getReference (voiceIndex); // [1].\n \n            if (! product.isPurchased)\n            {\n                purchaseInProgress = true\uff1b\n \n                product.purchaseInProgress = true; // [2].\n                juce::InAppPurchases::getInstance()->purchaseProduct (product.identifier); // [3].\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"[1]: First check whether the prices were fetched before retrieving the VoiceProduct using the index."}),"\n",(0,t.jsx)(n.li,{children:"[2]: If the product was not previously purchased, enter purchasing state by setting the appropriate variable."}),"\n",(0,t.jsxs)(n.li,{children:["[3]: We can now safely request the ",(0,t.jsx)(n.a,{href:"https://docs.juce.com/master/classInAppPurchases",title:"Provides in-app purchase functionality.",children:"\u30a2\u30d7\u30ea\u5185\u8ab2\u91d1"})," instance to purchase the product by specifying the correct identifier."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["This will trigger a callback from the server when the purchasing has ended and a response was received. We implement this ",(0,t.jsx)(n.code,{children:"\u5546\u54c1\u8cfc\u5165\u5b8c\u4e86()"})," callback here:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"void productPurchaseFinished (const PurchaseInfo& info, bool success, const juce::String&) override\n    {\n        purchaseInProgress = false\uff1b\n \n        for (const auto& productId : info.purchase.productIds)\n        {\n            auto idx = findVoiceIndexFromIdentifier (productId); // [4].\n \n            if (juce::isPositiveAndBelow (idx, voiceProducts.size()))\n            {\n                auto& voiceProduct = voiceProducts.getReference (idx); // [5].\n \n                voiceProduct.isPurchased = success\uff1b\n                voiceProduct.purchaseInProgress = false\uff1b\n            }\n            else\n            {\n                // \u5931\u6557\u3057\u305f\u5834\u5408\u3001Play\u30b9\u30c8\u30a2\u306f\u3069\u306e\u8cfc\u5165\u304c\u5931\u6557\u3057\u305f\u304b\u3092\u6559\u3048\u3066\u304f\u308c\u307e\u305b\u3093\u3002\n                for (auto& voiceProduct : voiceProducts)\n                    voiceProduct.purchaseInProgress = false\uff1b\n            }\n        }\n \n        guiUpdater.triggerAsyncUpdate()\uff1b\n    }\n"})}),"\n",(0,t.jsx)(n.p,{children:"Using the same helper function as before, retrieve the VoiceProduct index from its identifier [4] and set appropriate variables on the object in question depending on whether the purchase was successful and exit purchasing state [5]."}),"\n",(0,t.jsxs)(n.p,{children:["To indicate the purchasing state to the user while waiting for the response from the server, display a spinning animation in the ",(0,t.jsx)(n.code,{children:"\u30da\u30a4\u30f3\u30c8"})," function of the ",(0,t.jsx)(n.code,{children:"\u30dc\u30a4\u30b9\u30e2\u30c7\u30eb"})," class [6]:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"if (! hasBeenPurchased)\n                {\n                    g.setColour (juce::Colours::white.withAlpha (0.8f)); // [11].\n                    g.fillRect (voiceIconBounds)\uff1b\n \n                    if (purchaseInProgress) // [6].\n                        getLookAndFeel().drawSpinningWaitAnimation (g, juce::Colours::darkgrey\u3001\n                                                                    voiceIconBounds.getX()\u3001\n                                                                    voiceIconBounds.getY()\u3001\n                                                                    voiceIconBounds.getWidth()\u3001\n                                                                    voiceIconBounds.getHeight())\uff1b\n                }\n            }\n        }\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u30e6\u30fc\u30b6\u30fc\u304cUI\u3068\u30a4\u30f3\u30bf\u30e9\u30af\u30c8\u3057\u305f\u3068\u304d\u306b\u8cfc\u5165\u30d7\u30ed\u30bb\u30b9\u3092\u958b\u59cb\u3059\u308b\u305f\u3081\u306b\u3001clickPurchase()\u95a2\u6570\u3092\u5b9f\u88c5\u3057\u3066\u307f\u307e\u3057\u3087\u3046\uff1a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"void clickPurchase()\n        {\n            if (rowSelected >= 0)\n            {\n                if (! hasBeenPurchased)\n                {\n                    purchases.purchaseVoice (rowSelected); // [7].\n                    purchaseInProgress = true\uff1b\n                    startTimer (1000 / 50); // [8].\n                }\n            }\n        }\n \n        void timerCallback() override { repaint(); }.          // [9]\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["[7]: If the row index is valid and the item was not purchased before, call the ",(0,t.jsx)(n.code,{children:"purchaseVoice()"})," function and enter purchasing state."]}),"\n",(0,t.jsx)(n.li,{children:"[8]: Start a timer to update the spinning wheel animation while the purchase is in progress."}),"\n",(0,t.jsx)(n.li,{children:"[9]: Implement the timer callback to repaint the screen for the animation."}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Lastly in the ",(0,t.jsx)(n.code,{children:"\u66f4\u65b0()"})," function, retrieve the purchasing state for the row-specific product [10] and stop the spinning animation if the purchase is finished by calling the ",(0,t.jsx)(n.code,{children:"stopTimer()"})," function [11]:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"purchaseInProgress = purchase.purchaseInProgress; // [10].\n \n                if (purchaseInProgress)\n                    startTimer (1000 / 50)\uff1b\n                else\n                    stopTimer(); // \u301011\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u306e\u3053\u306e\u6642\u70b9\u3067\u3001\u5546\u54c1\u306e\u8cfc\u5165\u3068\u5546\u54c1\u60c5\u5831\u306e\u53d6\u5f97\u3092\u51e6\u7406\u3059\u308b\u4ed5\u7d44\u307f\u306f\u3059\u3079\u3066\u5b9f\u88c5\u3055\u308c\u3066\u3044\u307e\u3059\u304c\u3001GUI\u306b\u66f4\u65b0\u306e\u30bf\u30a4\u30df\u30f3\u30b0\u3092\u6307\u793a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002"}),"\n",(0,t.jsx)(n.h1,{id:"handling-async-updates",children:"Handling async updates"}),"\n",(0,t.jsxs)(n.p,{children:["Since purchases and synchronisation with the IAP server are performed on a separate thread, we need to handle responses in an asynchronous manner. In the ",(0,t.jsx)(n.code,{children:"\u30e1\u30a4\u30f3\u30b3\u30f3\u30c6\u30f3\u30c4\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8"})," class, let's inherit from the ",(0,t.jsx)(n.a,{href:"https://docs.juce.com/master/classAsyncUpdater",title:"Has a callback method that is triggered asynchronously.",children:"\u975e\u540c\u671f\u30a2\u30c3\u30d7\u30c7\u30fc\u30bf\u30fc"})," class [1] and pass a reference of this class to the VoicePurchases instance [2]:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"class MainContentComponent : public juce::Component\u3001\n                             private juce::AsyncUpdater // [1].\n{\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"juce::SoundPlayer player\uff1b\n    VoicePurchases purchases { *this }; // [2].\n    juce::AudioDeviceManager dm\uff1b\n"})}),"\n",(0,t.jsxs)(n.p,{children:["In the VoicePurchases constructor and member initialisation list, assign a reference to the ",(0,t.jsx)(n.a,{href:"https://docs.juce.com/master/classAsyncUpdater",title:"Has a callback method that is triggered asynchronously.",children:"\u975e\u540c\u671f\u30a2\u30c3\u30d7\u30c7\u30fc\u30bf\u30fc"})," instance in a private variable [3]:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"VoicePurchases (juce::AsyncUpdater& asyncUpdater) // [3].\n         : guiUpdater (asyncUpdater)\n    {\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Declare that variable as a private member to be able to refer to the ",(0,t.jsx)(n.a,{href:"https://docs.juce.com/master/classAsyncUpdater",title:"Has a callback method that is triggered asynchronously.",children:"\u975e\u540c\u671f\u30a2\u30c3\u30d7\u30c7\u30fc\u30bf\u30fc"})," later on [4]:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"//==============================================================================\n    juce::AsyncUpdater& guiUpdater; // [4\uff3d\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Now in the ",(0,t.jsx)(n.code,{children:"purchaseVoice()"})," function and all the callback functions of the ",(0,t.jsx)(n.a,{href:"https://docs.juce.com/master/classInAppPurchases",title:"Provides in-app purchase functionality.",children:"\u30a2\u30d7\u30ea\u5185\u8ab2\u91d1"})," instance namely ",(0,t.jsx)(n.code,{children:"productsInfoReturned()"}),", ",(0,t.jsx)(n.code,{children:"\u8cfc\u5165\u30ea\u30b9\u30c8\u5fa9\u5143()"})," and ",(0,t.jsx)(n.code,{children:"\u5546\u54c1\u8cfc\u5165\u5b8c\u4e86()"}),", trigger an asynchronous update to the GUI as a last step to the corresponding code segments [5]:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"void purchaseVoice (int voiceIndex)\n{\n    if (havePricesBeenFetched && juce::isPositiveAndBelow (voiceIndex, voiceProducts.size()))\n    {\n        //...\n \n        if (! product.isPurchased)\n        {\n            //...\n \n            guiUpdater.triggerAsyncUpdate();   // [5.1]\n        }\n    }\n}\n \n//...\n \nvoid productsInfoReturned (const juce::Array& products) override\n{\n    //...\n \n    guiUpdater.triggerAsyncUpdate();           // [5.2]\n}\n \n//...\n \nvoid productPurchaseFinished (const PurchaseInfo& info, bool success, const juce::String&) override\n{\n    //...\n \n    guiUpdater.triggerAsyncUpdate();           // [5.3]\n}\n \n//...\n \nvoid purchasesListRestored (const juce::Array& infos, bool success, const juce::String&) override\n{\n    if (success)\n    {\n        //...\n \n        guiUpdater.triggerAsyncUpdate(); // [5.4].\n    }\n \n    //...\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Now whenever the ",(0,t.jsx)(n.code,{children:"triggerAsyncUpdate()"})," function is called on the ",(0,t.jsx)(n.a,{href:"https://docs.juce.com/master/classAsyncUpdater",title:"Has a callback method that is triggered asynchronously.",children:"\u975e\u540c\u671f\u30a2\u30c3\u30d7\u30c7\u30fc\u30bf\u30fc"})," instance in the VoicePurchases class, we can handle the callback in the ",(0,t.jsx)(n.code,{children:"handleAsyncUpdate()"})," function to update any outdated GUI components [6]:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"void handleAsyncUpdate() \u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\n    {\n        voiceListBox.updateContent()\uff1b\n        voiceListBox.setEnabled (! purchases.isPurchaseInProgress())\uff1b\n        voiceListBox.repaint()\uff1b\n    }\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Add the following getter in the ",(0,t.jsx)(n.code,{children:"\u30dc\u30a4\u30b9\u8cfc\u5165"})," class as a public helper function:"]}),"\n",(0,t.jsx)(n.p,{children:"\u3053\u308c\u306b\u3088\u308a\u3001\u8cfc\u5165\u304c\u884c\u308f\u308c\u305f\u308a\u53d6\u5f97\u3055\u308c\u305f\u308a\u3059\u308b\u305f\u3073\u306bGUI\u304c\u66f4\u65b0\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\u30a2\u30d7\u30ea\u3092\u518d\u5ea6\u8d77\u52d5\u3059\u308b\u3068\u3001\u4ee5\u524d\u306b\u8cfc\u5165\u3057\u305f\u30a2\u30d7\u30ea\u5185\u8ab2\u91d1\u304c\u8868\u793a\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002"}),"\n",(0,t.jsx)(n.p,{children:"\u30e6\u30fc\u30b6\u30fc\u304c\u7279\u5b9a\u306e\u97f3\u58f0\u3067\u30d5\u30ec\u30fc\u30ba\u3092\u518d\u751f\u3059\u308b\u305f\u3073\u306b\u30c8\u30fc\u30af\u30f3\u3092\u6d88\u8cbb\u3059\u308b\u3053\u3068\u3067\u3001\u3053\u308c\u3089\u306eIAP\u88fd\u54c1\u306e\u6d88\u8cbb\u53ef\u80fd\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002"}),"\n",(0,t.jsx)(n.h1,{id:"playing-sounds",children:"Playing sounds"}),"\n",(0,t.jsxs)(n.p,{children:["When the user clicks on the play button, we need to trigger the correct audio file to play using the right voice and phrase. The audio files are stored as binary resources using the name of the voice and an index relating to the phrase number as a naming convention. In the ",(0,t.jsx)(n.code,{children:"\u30e1\u30a4\u30f3\u30b3\u30f3\u30c6\u30f3\u30c4\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8"})," class, we handle the behaviour as follows:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'void playStopPhrase()\n    {\n        juce::MemoryOutputStream resourceName\uff1b\n \n        auto idx = voiceListBox.getSelectedRow(); // [1].\n        if (juce::isPositiveAndBelow (idx, soundNames.size()))\n        {\n            resourceName << soundNames[idx] << phraseListBox.getSelectedRow() << ".ogg"; // [2].\n \n            auto dir = juce::File::getCurrentWorkingDirectory()\uff1b\n \n            int numTries = 0\uff1b\n \n            while (! dir.getChildFile ("Resources").exists() && numTries++ < 15)\n                dir = dir.getParentDirectory()\uff1b\n \n            auto file = dir.getChildFile ("Resources").getChildFile ("Sounds").getChildFile (resourceName.toString().toRawUTF8())\uff1b\n \n            if (file.exists())\n                player.play (file); // [3].\n        }\n    }\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"[1]: First, retrieve the index for the selected row in the voice table and check if the index is valid against the array of audio files."}),"\n",(0,t.jsxs)(n.li,{children:["[2]: Next, construct the correct file name using a ",(0,t.jsx)(n.a,{href:"https://docs.juce.com/master/classMemoryOutputStream",title:"Writes data to an internal memory buffer, which grows as required.",children:"\u30e1\u30e2\u30ea\u30fc\u51fa\u529b\u30b9\u30c8\u30ea\u30fc\u30e0"})," object and the naming convention as described above."]}),"\n",(0,t.jsxs)(n.li,{children:["[3]: Finally, check whether the audio file can be loaded based on the file name constructed previously and call the ",(0,t.jsx)(n.code,{children:"\u30d7\u30ec\u30a4()"})," function of the ",(0,t.jsx)(n.a,{href:"https://docs.juce.com/master/classSoundPlayer",title:"A simple sound player that you can add to the AudioDeviceManager to play simple sounds.",children:"\u30b5\u30a6\u30f3\u30c9\u30d7\u30ec\u30fc\u30e4\u30fc"})," with the corresponding file."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"\u3053\u308c\u3067\u3001\u518d\u751f\u30dc\u30bf\u30f3\u3092\u62bc\u3059\u3068\u3001\u5bfe\u5fdc\u3059\u308b\u97f3\u58f0\u3068\u3068\u3082\u306b\u8a71\u3057\u8a00\u8449\u304c\u805e\u3053\u3048\u308b\u306f\u305a\u3067\u3059\u3002"}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.p,{children:["The source code for this modified version of the code can be found in the ",(0,t.jsx)(n.code,{children:"InAppPurchase\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb_02.h"})," file of the demo project."]})}),"\n",(0,t.jsx)(n.h1,{id:"\u6982\u8981",children:"\u6982\u8981"}),"\n",(0,t.jsx)(n.p,{children:"\u3053\u306e\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u3067\u306f\u3001\u30e2\u30d0\u30a4\u30eb\u3068\u30c7\u30b9\u30af\u30c8\u30c3\u30d7\u3067\u30a2\u30d7\u30ea\u5185\u8ab2\u91d1\u3092\u51e6\u7406\u3059\u308b\u65b9\u6cd5\u3092\u5b66\u3073\u307e\u3057\u305f\u3002\u7279\u306b"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u3055\u307e\u3056\u307e\u306a\u914d\u5099\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u306e\u4e88\u5099\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3092\u30ab\u30d0\u30fc\u3002"}),"\n",(0,t.jsx)(n.li,{children:"\u69d8\u3005\u306aIAP\u88fd\u54c1\u60c5\u5831\u3092\u30e6\u30fc\u30b6\u30fc\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306b\u8868\u793a\u3002"}),"\n",(0,t.jsx)(n.li,{children:"\u904e\u53bb\u306e\u30e6\u30fc\u30b6\u30fc\u306e\u8cfc\u5165\u5c65\u6b74\u3092\u53d6\u5f97\u3057\u3001\u305d\u308c\u306b\u5fdc\u3058\u3066GUI\u3092\u975e\u540c\u671f\u306b\u66f4\u65b0\u3002"}),"\n",(0,t.jsx)(n.li,{children:"\u30a2\u30d7\u30ea\u5185\u3067\u6d88\u8017\u54c1\u4ee5\u5916\u306e\u5546\u54c1\u306e\u8cfc\u5165\u306b\u5bfe\u5fdc\u3002"}),"\n"]}),"\n",(0,t.jsx)(n.h1,{id:"\u95a2\u9023\u9805\u76ee",children:"\u95a2\u9023\u9805\u76ee"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"../tutorial_android_studio/",children:"\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u30a2\u30f3\u30c9\u30ed\u30a4\u30c9\u3092\u59cb\u3081\u3088\u3046"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"../tutorial_android_screen_sizes/",children:"\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30ebAndroid\u306e\u753b\u9762\u30b5\u30a4\u30ba\u3092\u7ba1\u7406\u3059\u308b"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"../tutorial_analytics_collection/",children:"\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u30a2\u30d7\u30ea\u5206\u6790\u306e\u53ce\u96c6"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"../tutorial_push_notifications/",children:"\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u30c7\u30b9\u30af\u30c8\u30c3\u30d7\u3068\u30e2\u30d0\u30a4\u30eb\u30c7\u30d0\u30a4\u30b9\u3067\u306e\u30d7\u30c3\u30b7\u30e5\u901a\u77e5"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"../tutorial_app_plugin_packaging/",children:"\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u30a2\u30d7\u30ea\u3084\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u914d\u5e03\u7528\u306b\u30d1\u30c3\u30b1\u30fc\u30b8\u5316\u3059\u308b"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>o});var t=s(6540);const r={},i=t.createContext(r);function c(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);