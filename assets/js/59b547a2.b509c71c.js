"use strict";(self.webpackChunkjuce_tutorial_ja=self.webpackChunkjuce_tutorial_ja||[]).push([[2720],{6464:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>f,frontMatter:()=>o,metadata:()=>l,toc:()=>d});var t=i(4848),r=i(8453),s=i(3449);i(6378);const o={title:"\u4fe1\u53f7\u306e\u5468\u6ce2\u6570\u3092\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u3067\u8996\u899a\u5316",sidebar_position:6},a="\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u4fe1\u53f7\u306e\u5468\u6ce2\u6570\u3092\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u3067\u53ef\u8996\u5316\u3059\u308b",l={id:"dsp/tutorial_spectrum_analyser",title:"\u4fe1\u53f7\u306e\u5468\u6ce2\u6570\u3092\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u3067\u8996\u899a\u5316",description:"DSP\u30e2\u30b8\u30e5\u30fc\u30eb\u306eFFT\u30af\u30e9\u30b9\u3092\u4f7f\u7528\u3057\u3066\u3001\u5165\u529b\u30aa\u30fc\u30c7\u30a3\u30aa\u30c7\u30fc\u30bf\u3092\u30b9\u30da\u30af\u30c8\u30e9\u30e0\u30a2\u30ca\u30e9\u30a4\u30b6\u30fc\u3068\u3057\u3066\u8868\u793a\u3059\u308b\u65b9\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002\u30a6\u30a3\u30f3\u30c9\u30a6\u95a2\u6570\u3092\u4f7f\u7528\u3059\u308b\u5229\u70b9\u3092\u7406\u89e3\u3057\u307e\u3059\u3002",source:"@site/docs/dsp/tutorial_spectrum_analyser.mdx",sourceDirName:"dsp",slug:"/dsp/tutorial_spectrum_analyser",permalink:"/juce-tutorial-ja/dsp/tutorial_spectrum_analyser",draft:!1,unlisted:!1,editUrl:"https://github.com/m1m0zzz/juce-tutorial-ja/tree/main/docs/dsp/tutorial_spectrum_analyser.mdx",tags:[],version:"current",sidebarPosition:6,frontMatter:{title:"\u4fe1\u53f7\u306e\u5468\u6ce2\u6570\u3092\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u3067\u8996\u899a\u5316",sidebar_position:6},sidebar:"tutorialSidebar",previous:{title:"\u9ad8\u901f\u30d5\u30fc\u30ea\u30a8\u5909\u63db",permalink:"/juce-tutorial-ja/dsp/tutorial_simple_fft"},next:{title:"Graphics",permalink:"/juce-tutorial-ja/category/graphics"}},c={},d=[{value:"\u306f\u3058\u3081\u308b",id:"\u306f\u3058\u3081\u308b",level:2},{value:"FFT Initialisation",id:"fft-initialisation",level:2},{value:"Displaying the analyser",id:"displaying-the-analyser",level:2}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u4fe1\u53f7\u306e\u5468\u6ce2\u6570\u3092\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u3067\u53ef\u8996\u5316\u3059\u308b",children:"\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u4fe1\u53f7\u306e\u5468\u6ce2\u6570\u3092\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u3067\u53ef\u8996\u5316\u3059\u308b"}),"\n",(0,t.jsx)(n.p,{children:"DSP\u30e2\u30b8\u30e5\u30fc\u30eb\u306eFFT\u30af\u30e9\u30b9\u3092\u4f7f\u7528\u3057\u3066\u3001\u5165\u529b\u30aa\u30fc\u30c7\u30a3\u30aa\u30c7\u30fc\u30bf\u3092\u30b9\u30da\u30af\u30c8\u30e9\u30e0\u30a2\u30ca\u30e9\u30a4\u30b6\u30fc\u3068\u3057\u3066\u8868\u793a\u3059\u308b\u65b9\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002\u30a6\u30a3\u30f3\u30c9\u30a6\u95a2\u6570\u3092\u4f7f\u7528\u3059\u308b\u5229\u70b9\u3092\u7406\u89e3\u3057\u307e\u3059\u3002"}),"\n",(0,t.jsx)(n.p,{children:"\u30ec\u30d9\u30eb Intermediate"}),"\n",(0,t.jsx)(n.p,{children:"\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0 Windows, macOS, Linux"}),"\n",(0,t.jsxs)(n.p,{children:["\u30af\u30e9\u30b9\uff1a ",(0,t.jsx)(n.a,{href:"https://docs.juce.com/master/classdsp_1_1FFT",title:"Performs a fast fourier transform.",children:"dsp::FFT"}),", ",(0,t.jsx)(n.a,{href:"https://docs.juce.com/master/classdsp_1_1WindowingFunction",title:"A class which provides multiple windowing functions useful for filter design and spectrum analyzers.",children:"dsp::WindowingFunction"}),", ",(0,t.jsx)(n.a,{href:"https://docs.juce.com/master/classDecibels",title:"This class contains some helpful static methods for dealing with decibel values.",children:"\u30c7\u30b7\u30d9\u30eb"})]}),"\n",(0,t.jsx)(n.h2,{id:"\u306f\u3058\u3081\u308b",children:"\u306f\u3058\u3081\u308b"}),"\n",(0,t.jsxs)(n.p,{children:["This tutorial leads on from ",(0,t.jsx)(n.a,{href:"../tutorial_simple_fft/",children:"\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u9ad8\u901f\u30d5\u30fc\u30ea\u30a8\u5909\u63db"}),". If you haven't done so already, you should read that tutorial first."]}),"\n",(0,t.jsxs)(n.p,{children:["Download the demo project for this tutorial here: ",(0,t.jsx)(n.a,{href:"/tutorials/PIPs/SpectrumAnalyserTutorial.zip",children:"\u30d4\u30c3\u30d7"})," | ",(0,t.jsx)(n.a,{href:"/tutorials/ZIPs/SpectrumAnalyserTutorial.zip",children:"\u30b8\u30c3\u30d7"}),". Unzip the project and open the first header file in the Projucer."]}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsx)(n.p,{children:"\u304a\u4f7f\u3044\u306e\u30aa\u30da\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u30b7\u30b9\u30c6\u30e0\u304c\u3001\u30de\u30a4\u30af\u3078\u306e\u30a2\u30af\u30bb\u30b9\u8a31\u53ef\u3092\u8981\u6c42\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u5834\u5408\uff08\u73fe\u5728\u3001iOS\u3001Android\u3001macOS Mojave\uff09\u3001Projucer\u306e\u95a2\u9023\u3059\u308b\u30a8\u30af\u30b9\u30dd\u30fc\u30bf\u30fc\u306e\u4e0b\u306b\u5bfe\u5fdc\u3059\u308b\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u8a2d\u5b9a\u3057\u3001\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u518d\u4fdd\u5b58\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002"})}),"\n",(0,t.jsxs)(n.p,{children:["If you need help with this step, see ",(0,t.jsx)(n.a,{href:"../tutorial_new_projucer_project/",children:"\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30ebProjucer\u30d1\u30fc\u30c81\uff1aProjucer\u3092\u59cb\u3081\u308b"}),"."]}),"\n",(0,t.jsx)(n.h1,{id:"the-demo-project",children:"The demo project"}),"\n",(0,t.jsx)(n.p,{children:"\u5b8c\u6210\u3059\u308b\u3068\u3001\u30c7\u30e2\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306f\u3001\u5165\u529b\u3055\u308c\u305f\u30aa\u30fc\u30c7\u30a3\u30aa\u30c7\u30fc\u30bf\u3092\u3001\u5468\u6ce2\u6570\uff08x\u8ef8\uff09\u3068\u632f\u5e45\uff08y\u8ef8\uff09\u306e2\u6b21\u5143\u30b9\u30da\u30af\u30c8 \u30eb\u30a2\u30ca\u30e9\u30a4\u30b6\u30fc\u3068\u3057\u3066\u8868\u793a\u3057\u307e\u3059\u3002\u753b\u9762\u306b\u8868\u793a\u3055\u308c\u308b\u5024\u306f1\u79d2\u9593\u306b30\u56de\u66f4\u65b0\u3055\u308c\u3001\u4efb\u610f\u306e\u6642\u9593\u67a0\u306e\u30a6\u30a3\u30f3\u30c9\u30a6\u306f\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\uff1a"}),"\n",(0,t.jsx)(s.A,{src:"https://docs.juce.com/master/tutorial_spectrum_analyser_screenshot1.png",caption:"The demo project window"}),"\n",(0,t.jsx)(n.h1,{id:"windowing-functions",children:"Windowing functions"}),"\n",(0,t.jsxs)(n.p,{children:["As seen in ",(0,t.jsx)(n.a,{href:"../tutorial_simple_fft/",children:"\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u9ad8\u901f\u30d5\u30fc\u30ea\u30a8\u5909\u63db"})," the Fast Fourier Transform allows us to convert a time domain signal to the frequency domain in order to process the individual frequency components of a certain signal."]}),"\n",(0,t.jsx)(n.p,{children:"\u3057\u304b\u3057\u3001\u30d5\u30fc\u30ea\u30a8\u5909\u63db\u306e\u9650\u754c\u306f\u3001\u30aa\u30fc\u30c7\u30a3\u30aa\u30fb\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30aa\u30fc\u30c7\u30a3\u30aa\u30fb\u30d0\u30c3\u30d5\u30a1\u30fb\u30d6\u30ed\u30c3\u30af\u306e\u3088\u3046\u306b\u3001\u6709\u9650\u306e\u6642\u9593\u9593\u9694\u306e\u9593\u306b\u9069\u7528\u3055\u308c\u308b\u5834\u5408\u3001\u5909\u63db\u306f\u3001\u554f\u984c\u306e\u5468\u6ce2\u6570\u306e\u4e21\u5074\u306b\u65b0\u3057\u3044\u5468\u6ce2\u6570\u6210\u5206\u304c\u51fa\u73fe\u3057\u59cb\u3081\u308b\u3001\u30b9\u30da\u30af\u30c8\u30eb\u30fb\u30ea\u30fc\u30af\u3068\u547c\u3070\u308c\u308b\u73fe\u8c61\u304c\u73fe\u308c\u308b\u3053\u3068\u3067\u3042\u308b\u3002\u3053\u308c\u306f\u3001\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\u3055\u308c\u305f\u4fe1\u53f7\u90e8\u5206\u304c\u6ce2\u5f62\u306e\u81ea\u7136\u306a\u5468\u671f\u306b\u53ce\u307e\u3089\u306a\u3044\u3053\u3068\u304c\u3042\u308a\u3001\u672c\u8cea\u7684\u306b\u4fe1\u53f7\u304c\u5207\u308a\u6368\u3066\u3089\u308c\u308b\u305f\u3081\u3067\u3059\u3002"}),"\n",(0,t.jsx)(n.p,{children:"\u30b9\u30da\u30af\u30c8\u30eb\u6f0f\u308c\u306f\u3001\u4f3c\u305f\u3088\u3046\u306a\u5468\u6ce2\u6570\u3068\u4f3c\u305f\u3088\u3046\u306a\u632f\u5e45\u3092\u6301\u30642\u3064\u306e\u6b63\u5f26\u6ce2\u3084\u3001\u4f3c\u305f\u3088\u3046\u306a\u5468\u6ce2\u6570\u3068\u4f3c\u305f\u3088\u3046\u306a\u632f\u5e45\u3092\u6301\u30642\u3064\u306e\u6b63\u5f26\u6ce2\u3092\u5206\u6790\u3059\u308b\u3068\u304d\u306b\u7279\u306b\u554f\u984c\u3068\u306a\u308b\u3002\u6b63\u5f26\u6ce2\u306e\u5468\u6ce2\u6570\u3068\u632f\u5e45\u304c\u8fd1\u3044\u5834\u5408\u3001\u6f0f\u308c\u306b\u3088\u3063\u3066\u4e92\u3044\u306b\u533a\u5225\u304c\u3064\u304b\u306a\u304f\u306a\u308b\u3053\u3068\u304c\u3042\u308b\u3002\u4e00\u65b9\u3001\u6b63\u5f26\u6ce2\u306e\u5468\u6ce2\u6570\u3068\u632f\u5e45\u304c\u9060\u3044\u5834\u5408\u3001\u6700\u3082\u5f37\u3044\u6210\u5206\u304b\u3089\u306e\u6f0f\u308c\u306f\u3001\u6700\u3082\u5f31\u3044\u6210\u5206\u306e\u5b58\u5728\u3092\u8986\u3044\u96a0\u3057\u3066\u3057\u307e\u3046\u3002"}),"\n",(0,t.jsx)(n.p,{children:"\u30b9\u30da\u30af\u30c8\u30eb\u6f0f\u6d29\u306e\u5f71\u97ff\u3092\u6e1b\u3089\u3059\u305f\u3081\u306b\u3001\u30d5\u30fc\u30ea\u30a8\u5909\u63db\u3092\u884c\u3046\u524d\u306b\u4fe1\u53f7\u306b\u7a93\u95a2\u6570\u3092\u9069\u7528\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u3001\u7a93\u95a2\u6570\u306e\u7a2e\u985e\u306b\u3088\u3063\u3066\u51fa\u529b\u3078\u306e\u5f71\u97ff\u304c\u7570\u306a\u308a\u307e\u3059\u3002\u4ee5\u4e0b\u306b\u3001JUCE DSP\u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u5229\u7528\u53ef\u80fd\u306a\u3044\u304f\u3064\u304b\u306e\u7a93\u3068\u305d\u306e\u7279\u5fb4\u3092\u793a\u3057\u307e\u3059\uff1a"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u9577\u65b9\u5f62\uff1a\u6700\u3082\u4f4e\u3044\u30c0\u30a4\u30ca\u30df\u30c3\u30af\u30ec\u30f3\u30b8\u3001\u6700\u3082\u9ad8\u3044\u89e3\u50cf\u5ea6\u3002\u30a6\u30a3\u30f3\u30c9\u30a6\u306a\u3057\u3068\u540c\u7b49\u3002"}),"\n",(0,t.jsx)(n.li,{children:"\u30cf\u30df\u30f3\u30b0\u826f\u597d\u306a\u30c0\u30a4\u30ca\u30df\u30c3\u30af\u30fb\u30ec\u30f3\u30b8\u3001\u826f\u597d\u306a\u5206\u89e3\u80fd\u3002\u901a\u5e38\u3001\u72ed\u5e2f\u57df\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3067\u4f7f\u7528\u3055\u308c\u308b\u3002"}),"\n",(0,t.jsx)(n.li,{children:"Hann\uff1a\u826f\u597d\u306a\u30c0\u30a4\u30ca\u30df\u30c3\u30af\u30fb\u30ec\u30f3\u30b8\u3001\u307e\u305a\u307e\u305a\u306e\u89e3\u50cf\u5ea6\u3002\u901a\u5e38\u3001\u72ed\u5e2f\u57df\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3067\u4f7f\u7528\u3055\u308c\u308b\u3002"}),"\n",(0,t.jsx)(n.li,{children:"\u30d6\u30e9\u30c3\u30af\u30de\u30f3\uff1a\u6700\u9ad8\u306e\u30c0\u30a4\u30ca\u30df\u30c3\u30af\u30ec\u30f3\u30b8\u3001\u6700\u4f4e\u306e\u89e3\u50cf\u5ea6\u3002\u901a\u5e38\u3001\u5e83\u5e2f\u57df\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3067\u4f7f\u7528\u3055\u308c\u308b\u3002"}),"\n"]}),"\n",(0,t.jsx)(n.h1,{id:"processing-audio-data",children:"Processing Audio Data"}),"\n",(0,t.jsx)(n.p,{children:"\u73fe\u5728\u3001\u79c1\u305f\u3061\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306f\u3001\u5165\u529b\u3055\u308c\u308b\u30aa\u30fc\u30c7\u30a3\u30aa\u4fe1\u53f7\u3092\u8868\u793a\u3082\u51e6\u7406\u3082\u3057\u306a\u3044\u306e\u3067\u3001FFT\u3092\u5b9f\u88c5\u3059\u308b\u3053\u3068\u304b\u3089\u59cb\u3081\u307e\u3057\u3087\u3046\u3002"}),"\n",(0,t.jsx)(n.h2,{id:"fft-initialisation",children:"FFT Initialisation"}),"\n",(0,t.jsxs)(n.p,{children:["In the ",(0,t.jsx)(n.code,{children:"\u30a2\u30ca\u30e9\u30a4\u30b6\u30fc\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8"})," class, start by declaring an enum as a public member to define useful constants for the FFT implementation:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"\u5217\u6319\n    {\n        fftOrder = 11, // [1\uff3d\n        fftSize = 1 << fftOrder, // [2\uff3d\n        \u30b9\u30b3\u30fc\u30d7\u30b5\u30a4\u30ba = 512 // [3\uff3d\n    };\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"[1]: The FFT order designates the size of the FFT window and the number of points on which it will operate corresponds to 2 to the power of the order. In this case, let's use an order of 11 which will produce an FFT with 2 ^ 11 = 2048 points."}),"\n",(0,t.jsx)(n.li,{children:"[2]: To calculate the corresponding FFT size, we use the left bit shift operator which produces 2048 as binary number 100000000000."}),"\n",(0,t.jsx)(n.li,{children:"[3]: We also set the number of points in the visual representation of the spectrum as a scope size of 512."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"\u6b21\u306b\u3001FFT\u5b9f\u88c5\u306b\u5fc5\u8981\u306a\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30fb\u30e1\u30f3\u30d0\u30fc\u5909\u6570\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5ba3\u8a00\u3059\u308b\uff1a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"private:\n    juce::dsp::FFT forwardFFT;                      // [4]\n    juce::dsp::WindowingFunction\u30a6\u30a3\u30f3\u30c9\u30a6; // [5\uff3d\n \n    float fifo [fftSize]; // [6\uff3d\n    float fftData [2 * fftSize]; // [7].\n    int fifoIndex = 0; // [8].\n    bool nextFFTBlockReady = false; // [9] \u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n    float scopeData [scopeSize]; // [10] \u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3059\u308b\u3002\n \n    JUCE_DECLARE_NON_COPYABLE_WITH_LEAK_DETECTOR (AnalyserComponent)\n};\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["[4]: Declare a ",(0,t.jsx)(n.a,{href:"https://docs.juce.com/master/classdsp_1_1FFT",title:"Performs a fast fourier transform.",children:"dsp::FFT"})," object to perform the forward FFT on."]}),"\n",(0,t.jsxs)(n.li,{children:["[5]: Also declare a ",(0,t.jsx)(n.a,{href:"https://docs.juce.com/master/classdsp_1_1WindowingFunction",title:"A class which provides multiple windowing functions useful for filter design and spectrum analyzers.",children:"dsp::WindowingFunction"})," object to apply the windowing function on the signal."]}),"\n",(0,t.jsx)(n.li,{children:"[6]: The fifo float array of size 2048 will contain our incoming audio data in samples."}),"\n",(0,t.jsx)(n.li,{children:"[7]: The fftData float array of size 4096 will contain the results of our FFT calculations."}),"\n",(0,t.jsx)(n.li,{children:"[8]: This temporary index keeps count of the amount of samples in the fifo."}),"\n",(0,t.jsx)(n.li,{children:"[9]: This temporary boolean tells us whether the next FFT block is ready to be rendered."}),"\n",(0,t.jsx)(n.li,{children:"[10]: The scopeData float array of size 512 will contain the points to display on the screen."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"\u3067\u306f\u3001\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u306e\u30e1\u30f3\u30d0\u521d\u671f\u5316\u30ea\u30b9\u30c8\u3067\u3053\u308c\u3089\u306e\u5909\u6570\u3092\u521d\u671f\u5316\u3057\u3066\u307f\u3088\u3046\uff1a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"    AnalyserComponent()\n        : forwardFFT (fftOrder),\n          window (fftSize, juce::dsp::WindowingFunction::hann)\n    {\n"})}),"\n",(0,t.jsx)(n.p,{children:"FFT\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f\u3053\u306e\u6642\u70b9\u3067\u6b63\u3057\u3044\u6b21\u6570\u3067\u660e\u793a\u7684\u306b\u521d\u671f\u5316\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u3001\u30a6\u30a3\u30f3\u30c9\u30a6\u95a2\u6570\u3092\u9078\u629e\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u3053\u306e\u5834\u5408\u3001Hann\u95a2\u6570\u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u306b\u3057\u307e\u3059\u304c\u3001\u4ed6\u306e\u95a2\u6570\u3092\u9078\u629e\u3057\u3066\u3082\u304b\u307e\u3044\u307e\u305b\u3093\u3002"}),"\n",(0,t.jsxs)(n.p,{children:["In the overriden ",(0,t.jsx)(n.code,{children:"getNextAudioBlock()"})," function, we simply push all the samples contained in our current audio buffer block to the fifo to be processed at a later time:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"void getNextAudioBlock (const juce::AudioSourceChannelInfo& bufferToFill) override\n    {\n        if (bufferToFill.buffer->getNumChannels() > 0)\n        {\n            auto* channelData = bufferToFill.buffer->getReadPointer (0, bufferToFill.startSample)\uff1b\n \n            for (auto i = 0; i < bufferToFill.numSamples; ++i)\n                pushNextSampleIntoFifo (channelData[i])\uff1b\n        }\n    }\n"})}),"\n",(0,t.jsxs)(n.p,{children:["To push the sample into the fifo, implement the ",(0,t.jsx)(n.code,{children:"pushNextSampleIntoFifo()"})," function as described below:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"void pushNextSampleIntoFifo (float sample) noexcept\n    {\n        // fifo\u306b\u5341\u5206\u306a\u30c7\u30fc\u30bf\u304c\u3042\u308b\u5834\u5408\u3001\u6b21\u306e\u30d5\u30ec\u30fc\u30e0\u3092\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3059\u308b\u30d5\u30e9\u30b0\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n        // \u6b21\u306e\u30d5\u30ec\u30fc\u30e0\u3092\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3057\u307e\u3059\u3002\n        if (fifoIndex == fftSize) // [11].\n        {\n            if (! nextFFTBlockReady) // [12] { \u6b21\u306e\u30d5\u30ec\u30fc\u30e0\u3092\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3057\u307e\u3059\u3002\n            {\n                juce::zeromem (fftData, sizeof (fftData))\uff1b\n                memcpy (fftData, fifo, sizeof (fifo))\uff1b\n                nextFFTBlockReady = true\uff1b\n            }\n \n            fifoIndex = 0\uff1b\n        }\n \n        fifo[fifoIndex++] = sample; // [12].\n    }\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"[11]: If the fifo contains enough data in this case 2048 samples, we are ready to copy the data to the fftData array for it to be processed by the FFT. We also set a flag to say that the next frame should now be rendered and always reset the index to 0 to start filling the fifo again."}),"\n",(0,t.jsx)(n.li,{children:"[12]: Every time this function gets called, a sample is stored in the fifo and the index is incremented."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"\u3053\u308c\u3067FIFO\u30c7\u30fc\u30bf\u304cFFT\u5165\u529b\u914d\u5217\u306e\u524d\u534a\u3092\u5360\u3081\u3001\u51e6\u7406\u3068\u8868\u793a\u306e\u6e96\u5099\u304c\u6574\u3063\u305f\u3002"}),"\n",(0,t.jsx)(n.h2,{id:"displaying-the-analyser",children:"Displaying the analyser"}),"\n",(0,t.jsxs)(n.p,{children:["In the ",(0,t.jsx)(n.code,{children:"DrawNextFrameOfSpectrum()"})," function, insert the frame drawing implementation as explained below:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"void drawNextFrameOfSpectrum()\n    {\n        // \u307e\u305a\u3001\u30c7\u30fc\u30bf\u306b\u30a6\u30a3\u30f3\u30c9\u30a6\u95a2\u6570\u3092\u9069\u7528\u3057\u307e\u3059\u3002\n        window.multiplyWithWindowingTable (fftData, fftSize); // [1].\n \n        // \u6b21\u306b FFT \u30c7\u30fc\u30bf\u3092\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3057\u307e\u3059\u3002\n        forwardFFT.performFrequencyOnlyForwardTransform (fftData); // [2].\n \n        auto mindB = -100.0f\uff1b\n        auto maxdB = 0.0f\uff1b\n \n        for (int i = 0; i < scopeSize; ++i) // [3].\n        {\n            auto skewedProportionX = 1.0f - std::exp (std::log (1.0f - (float) i / (float) scopeSize)) * 0.2f.* 0.2f);\n            auto fftDataIndex = juce::jlimit (0, fftSize / 2, (int) (skewedProportionX * (float) fftSize * 0.5f))\uff1b\n            auto level = juce::jmap (juce::jlimit (mindB, maxdB, juce::Decibels::gainToDecibels (fftData[fftDataIndex])))\n                                                               - juce::Decibels::gainToDecibels ((float) fftSize))\u3001\n                                     mindB, maxdB, 0.0f, 1.0f)\uff1b\n \n            scopeData[i] = level; // [4].\n        }\n    }\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["[1]: First, apply the windowing function to the incoming data by calling the ",(0,t.jsx)(n.code,{children:"multiplyWithWindowingTable()"})," function on the window object and passing the data as an argument."]}),"\n",(0,t.jsxs)(n.li,{children:["[2]: Then, render the FFT data using the ",(0,t.jsx)(n.code,{children:"performFrequencyOnlyForwardTransform()"})," function on the FFT object with the fftData array as an argument."]}),"\n",(0,t.jsx)(n.li,{children:"[3]: Now in the for loop for every point in the scope width, calculate the level proportionally to the desired minimum and maximum decibels. To do this, we first need to skew the x-axis to use a logarithmic scale to better represent our frequencies. We can then feed this scaling factor to retrieve the correct array index and use the amplitude value to map it to a range between 0.0 .. 1.0."}),"\n",(0,t.jsx)(n.li,{children:"[4]: Finally set the appropriate point with the correct amplitude to prepare the drawing process."}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Update the analyser using the timer callback function by calling the ",(0,t.jsx)(n.code,{children:"DrawNextFrameOfSpectrum()"})," only when the next FFT block is ready, reset the flag and update the GUI using the ",(0,t.jsx)(n.code,{children:"\u518d\u5857\u88c5()"})," function:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"void timerCallback() override\n    {\n        if (nextFFTBlockReady)\n        {\n            drawNextFrameOfSpectrum()\uff1b\n            nextFFTBlockReady = false\uff1b\n            repaint()\uff1b\n        }\n    }\n"})}),"\n",(0,t.jsxs)(n.p,{children:["As a final step, the ",(0,t.jsx)(n.code,{children:"\u30da\u30a4\u30f3\u30c8"})," callback will call our helper function ",(0,t.jsx)(n.code,{children:"drawFrame()"})," whenever a ",(0,t.jsx)(n.code,{children:"\u518d\u5857\u88c5()"})," request has been initiated and the frame can be drawn as follows:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"void drawFrame (juce::Graphics& g)\n    {\n        for (int i = 1; i < scopeSize; ++i)\n        {\n            auto width = getLocalBounds().getWidth()\uff1b\n            auto height = getLocalBounds().getHeight()\uff1b\n \n            g.drawLine ({ (float) juce::jmap (i - 1, 0, scopeSize - 1, 0, width)\u3001\n                                  juce::jmap (scopeData[i - 1], 0.0f, 1.0f, (float) height, 0.0f)\u3001\n                          (float) juce::jmap (i, 0, scopeSize - 1, 0, width)\u3001\n                                  juce::jmap (scopeData[i], 0.0f, 1.0f, (float) height, 0.0f) })\uff1b\n        }\n    }\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u3053\u3053\u3067\u306f\u3001\u914d\u5217\u304b\u3089\u6700\u521d\u306e\u70b9\u3092\u9664\u3044\u305f\u3059\u3079\u3066\u306e\u70b9\u306b\u5bfe\u3057\u3066\u3001\u30b9\u30b3\u30fc\u30d7\u306e\u30b5\u30a4\u30ba\u3092\u30b9\u30af\u30ea\u30fc\u30f3\u5883\u754c\u306e\u30b5\u30a4\u30ba\u306b\u30de\u30c3\u30d4\u30f3\u30b0\u3059\u308b\u3053\u3068\u306b\u3088\u3063\u3066\u3001\u524d\u306e\u70b9\u3068\u73fe\u5728\u306e\u70b9\u306e\u9593\u306b\u7dda\u3092\u5f15\u304f\u3002"}),"\n",(0,t.jsx)(n.p,{children:"FFT\u3067\u4f7f\u7528\u3059\u308b\u30a6\u30a3\u30f3\u30c9\u30a6\u95a2\u6570\u3092\u5909\u66f4\u3057\u3066\u307f\u3066\u3001\u30b9\u30da\u30af\u30c8\u30e9\u30e0\u30a2\u30ca\u30e9\u30a4\u30b6\u30fc\u306e\u53cd\u5fdc\u304c\u3069\u306e\u3088\u3046\u306b\u7570\u306a\u308b\u304b\u306b\u6ce8\u76ee\u3057\u3066\u304f\u3060\u3055\u3044\u3002"}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.p,{children:["The source code for this modified version of the code can be found in the ",(0,t.jsx)(n.code,{children:"\u30b9\u30da\u30af\u30c8\u30e9\u30e0\u30a2\u30ca\u30e9\u30a4\u30b6\u30fc\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb_02.h"})," file of the demo project."]})}),"\n",(0,t.jsx)(n.h1,{id:"\u6982\u8981",children:"\u6982\u8981"}),"\n",(0,t.jsx)(n.p,{children:"\u3053\u306e\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u3067\u306f\u3001\u30b9\u30da\u30af\u30c8\u30eb\u30a2\u30ca\u30e9\u30a4\u30b6\u3067\u30aa\u30fc\u30c7\u30a3\u30aa\u30c7\u30fc\u30bf\u3092\u8868\u793a\u3059\u308b\u305f\u3081\u306b\u3001\u30a6\u30a3\u30f3\u30c9\u30a6\u95a2\u6570\u3068FFT\u3092\u4f7f\u7528\u3059\u308b\u65b9\u6cd5\u3092\u5b66\u3073\u307e\u3057\u305f\u3002\u7279\u306b"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u30a6\u30a3\u30f3\u30c9\u30a6\u95a2\u6570\u306e\u57fa\u790e\u3092\u5b66\u3076\u3002"}),"\n",(0,t.jsx)(n.li,{children:"FIFO\u3092\u4f7f\u3063\u3066\u30aa\u30fc\u30c7\u30a3\u30aa\u3092\u30b5\u30f3\u30d7\u30eb\u3054\u3068\u306b\u51e6\u7406\u3002"}),"\n",(0,t.jsx)(n.li,{children:"\u30b5\u30f3\u30d7\u30eb\u30dd\u30a4\u30f3\u30c8\u9593\u306b\u7dda\u3092\u5f15\u3044\u3066\u30c7\u30fc\u30bf\u3092\u8868\u793a\u3002"}),"\n"]}),"\n",(0,t.jsx)(n.h1,{id:"\u95a2\u9023\u9805\u76ee",children:"\u95a2\u9023\u9805\u76ee"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"../tutorial_audio_thumbnail/",children:"\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u30aa\u30fc\u30c7\u30a3\u30aa\u6ce2\u5f62\u3092\u63cf\u304f"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"../tutorial_playing_sound_files/",children:"\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u30aa\u30fc\u30c7\u30a3\u30aa\u30d7\u30ec\u30fc\u30e4\u30fc\u306e\u69cb\u7bc9"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"../tutorial_processing_audio_input/",children:"\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u30aa\u30fc\u30c7\u30a3\u30aa\u5165\u529b\u3092\u51e6\u7406\u3059\u308b"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"../tutorial_dsp_introduction/",children:"\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30ebDSP\u5165\u9580"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"../tutorial_simple_fft/",children:"\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u9ad8\u901f\u30d5\u30fc\u30ea\u30a8\u5909\u63db"})}),"\n"]})]})}function f(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},3449:(e,n,i)=>{i.d(n,{A:()=>r});var t=i(4848);function r(e){let{src:n,caption:i,alt:r,width:s,height:o}=e;return(0,t.jsxs)("figure",{children:[(0,t.jsx)("img",{src:n,alt:r||i,width:s,height:o}),(0,t.jsx)("figcaption",{children:(0,t.jsx)("b",{children:i})})]})}},6378:(e,n,i)=>{i.d(n,{A:()=>r});var t=i(4848);function r(e){let{path:n}=e;return(0,t.jsx)("p",{children:(0,t.jsx)("a",{href:"https://docs.juce.com/master/"+n,children:"\ud83d\udcda Source Page"})})}},8453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>a});var t=i(6540);const r={},s=t.createContext(r);function o(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);